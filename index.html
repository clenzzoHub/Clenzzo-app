<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clenzzo - Car Cleaning Service</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#008080">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Clenzzo">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #000000;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card {
            background: #ffffff;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 20px 40px rgba(0, 128, 128, 0.1);
            width: 100%;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .card.slide-out {
            transform: translateX(-100%);
            opacity: 0;
        }

        .card.slide-in {
            transform: translateX(100%);
            opacity: 0;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            color: #008080;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .logo p {
            color: #666;
            font-size: 0.9rem;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
            background: #ffffff;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #008080;
            box-shadow: 0 0 0 3px rgba(0, 128, 128, 0.1);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: #008080;
            color: #ffffff;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .btn:hover {
            background: #006666;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 128, 128, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .link {
            text-align: center;
            margin-top: 20px;
        }

        .link a {
            color: #008080;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .link a:hover {
            color: #006666;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e1e5e9;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #008080;
            border-radius: 3px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: #ff4757;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            background: linear-gradient(135deg, #2ed573 0%, #17c0eb 100%);
        }

        .toast.warning {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        }

        .error-message {
            color: #ff4757;
            font-size: 12px;
            margin-top: 5px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            min-height: 16px;
        }

        .error-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .form-group.error input,
        .form-group.error select {
            border-color: #ff4757;
            box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.1);
        }

        .form-group.success input,
        .form-group.success select {
            border-color: #2ed573;
            box-shadow: 0 0 0 3px rgba(46, 213, 115, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #008080 0%, #20b2aa 100%);
            border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            width: 0%;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #008080 0%, #20b2aa 100%);
            color: #ffffff;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background: linear-gradient(135deg, #006666 0%, #1a9999 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 128, 128, 0.3);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(0, 128, 128, 0.2);
        }

        .btn.success {
            background: linear-gradient(135deg, #2ed573 0%, #17c0eb 100%);
            animation: successPulse 0.6s ease-out;
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .card {
            background: #ffffff;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 20px 40px rgba(0, 128, 128, 0.1);
            width: 100%;
            transform: translateY(0);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .card.slide-out-left {
            transform: translateX(-100%);
            opacity: 0;
        }

        .card.slide-out-right {
            transform: translateX(100%);
            opacity: 0;
        }

        .card.slide-in-left {
            transform: translateX(-100%);
            opacity: 0;
        }

        .card.slide-in-right {
            transform: translateX(100%);
            opacity: 0;
        }

        .signup-step, .trial-step, .onetime-step, .subscription-step {
            opacity: 0;
            transform: translateX(30px);
            transition: all 0.4s ease;
        }

        .signup-step:not(.hidden), .trial-step:not(.hidden), .onetime-step:not(.hidden), .subscription-step:not(.hidden) {
            opacity: 1;
            transform: translateX(0);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .help-icon {
            color: #008080;
            font-size: 14px;
            margin-left: 5px;
            cursor: help;
        }

        .recent-bookings {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #008080;
        }

        .recent-bookings h3 {
            color: #008080;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .booking-item {
            background: #ffffff;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #e1e5e9;
            transition: all 0.3s ease;
        }

        .booking-item:hover {
            border-color: #008080;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 128, 128, 0.1);
        }

        .booking-item:last-child {
            margin-bottom: 0;
        }

        .booking-date {
            color: #008080;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .booking-service {
            color: #333;
            font-size: 0.85rem;
            margin-top: 2px;
        }

        .time-slot:disabled,
        .time-slot.disabled {
            background: #f0f0f0;
            color: #999;
            cursor: not-allowed;
            border-color: #e0e0e0;
        }

        .time-slot:disabled:hover,
        .time-slot.disabled:hover {
            background: #f0f0f0;
            border-color: #e0e0e0;
            transform: none;
        }

        .date-input-wrapper {
            position: relative;
        }

        .date-input-wrapper input[type="date"] {
            position: relative;
        }

        .date-input-wrapper input[type="date"]::-webkit-calendar-picker-indicator {
            color: #008080;
            cursor: pointer;
        }

        .validation-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .form-group.success .validation-icon.success {
            opacity: 1;
            color: #2ed573;
        }

        .form-group.error .validation-icon.error {
            opacity: 1;
            color: #ff4757;
        }

        .input-wrapper {
            position: relative;
        }

        .floating-label {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 16px;
            pointer-events: none;
            transition: all 0.3s ease;
            background: #ffffff;
            padding: 0 5px;
        }

        .form-group input:focus + .floating-label,
        .form-group input:not(:placeholder-shown) + .floating-label {
            top: 0;
            font-size: 12px;
            color: #008080;
            font-weight: 500;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e1e5e9;
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background: #008080;
            transform: scale(1.2);
        }

        .step-dot.completed {
            background: #2ed573;
        }

        .bounce-in {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 128, 128, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(0, 128, 128, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 128, 128, 0);
            }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn-secondary {
            background: #e1e5e9;
            color: #333;
            width: auto;
            padding: 12px 25px;
            margin: 0;
        }

        .btn-secondary:hover {
            background: #d1d5d9;
            transform: translateY(-2px);
        }

        .review-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #008080;
        }

        .review-item h4 {
            color: #008080;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 600;
        }

        .review-item p {
            color: #333;
            font-size: 16px;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .greeting {
            text-align: center;
            margin-bottom: 30px;
        }

        .greeting h2 {
            color: #008080;
            margin-bottom: 10px;
        }

        .greeting p {
            color: #666;
        }

        .service-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .service-card:hover {
            border-color: #008080;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 128, 128, 0.1);
        }

        .service-card h3 {
            color: #008080;
            margin-bottom: 5px;
        }

        .service-card p {
            color: #666;
            font-size: 14px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-card {
            background: #ffffff;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option-card:hover {
            background: #008080;
            border-color: #008080;
            color: #ffffff;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 128, 128, 0.2);
        }

        .option-card:hover .option-icon {
            transform: scale(1.1);
        }

        .option-card:hover h3,
        .option-card:hover p {
            color: #ffffff;
        }

        .option-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .option-card h3 {
            color: #008080;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .option-card p {
            color: #666;
            font-size: 0.85rem;
            margin: 0;
            transition: color 0.3s ease;
        }

        .trial-info {
            background: #e8f8f8;
            color: #008080;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }

        .add-new-option {
            text-align: center;
            margin: 15px 0;
        }

        .add-new-option a {
            color: #008080;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .add-new-option a:hover {
            color: #006666;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .time-slot {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .time-slot:hover {
            border-color: #008080;
            background: #e8f8f8;
        }

        .time-slot.selected {
            background: #008080;
            border-color: #008080;
            color: #ffffff;
        }

        .summary-content {
            margin-bottom: 20px;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #008080;
        }

        .summary-item h4 {
            color: #008080;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 600;
        }

        .summary-item p {
            color: #333;
            font-size: 16px;
            margin: 0;
        }

        .payment-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .payment-info p {
            margin: 0;
            color: #856404;
            font-weight: 500;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #008080;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions .btn,
        .modal-actions .btn-secondary {
            flex: 1;
            margin: 0;
        }

        .service-info {
            background: #e8f8f8;
            color: #008080;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }

        .selected-service {
            background: linear-gradient(135deg, #008080 0%, #006666 100%);
            color: #ffffff;
            border: none;
            text-align: center;
            padding: 25px;
            margin-bottom: 20px;
        }

        .selected-service h3 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .selected-service p {
            color: #e0f0f0;
            margin-bottom: 15px;
        }

        .service-price {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
        }

        .amount-card {
            background: #f8f9fa;
            border: 2px solid #008080;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .amount-breakdown {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .amount-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .amount-row.total-row {
            border-top: 2px solid #008080;
            padding-top: 15px;
            margin-top: 10px;
            font-size: 1.1rem;
        }

        .amount-row.promo-row {
            color: #28a745;
        }

        .promo-message {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 500;
            text-align: center;
        }

        .promo-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .promo-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .payment-option {
            cursor: pointer;
        }

        .payment-option input[type="radio"] {
            display: none;
        }

        .payment-card {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .payment-option input[type="radio"]:checked + .payment-card {
            border-color: #008080;
            background: #e8f8f8;
        }

        .payment-card:hover {
            border-color: #008080;
            background: #e8f8f8;
        }

        .payment-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .payment-info h4 {
            color: #008080;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .payment-info p {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
        }

        .qr-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .qr-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .qr-content {
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }

        .qr-placeholder {
            width: 200px;
            height: 200px;
            background: #f0f0f0;
            border: 2px dashed #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            font-size: 14px;
            color: #666;
        }

        .plan-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .plan-card {
            background: #ffffff;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .plan-card:hover {
            border-color: #008080;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 128, 128, 0.2);
        }

        .plan-card.selected {
            border-color: #008080;
            background: #e8f8f8;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 128, 128, 0.2);
        }

        .plan-card.popular {
            border-color: #008080;
            background: linear-gradient(135deg, #e8f8f8 0%, #f0fafa 100%);
        }

        .popular-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #008080;
            color: #ffffff;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            transform: rotate(15deg);
        }

        .plan-card h3 {
            color: #008080;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .plan-price {
            font-size: 2rem;
            font-weight: 700;
            color: #008080;
            margin-bottom: 10px;
        }

        .plan-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .plan-features {
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: left;
        }

        .plan-features span {
            color: #333;
            font-size: 0.85rem;
            padding: 2px 0;
        }

        .subscription-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .subscription-slot {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .subscription-slot:hover {
            border-color: #008080;
            background: #e8f8f8;
        }

        .subscription-slot.selected {
            background: #008080;
            border-color: #008080;
            color: #ffffff;
        }

        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .profile-header {
            margin-bottom: 30px;
        }

        .profile-greeting h2 {
            color: #008080;
            margin-bottom: 5px;
            font-size: 1.8rem;
        }

        .profile-greeting p {
            color: #666;
            margin-bottom: 20px;
        }

        .profile-info-card {
            background: linear-gradient(135deg, #008080 0%, #006666 100%);
            color: #ffffff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .profile-info-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .profile-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-label {
            font-weight: 500;
            opacity: 0.9;
        }

        .profile-section {
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #008080;
        }

        .section-header h3 {
            color: #008080;
            margin: 0;
            font-size: 1.2rem;
        }

        .fab-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #008080;
            color: #ffffff;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-btn:hover {
            background: #006666;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 128, 128, 0.3);
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .item-card {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .item-card:hover {
            border-color: #008080;
            background: #e8f8f8;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .item-title {
            color: #008080;
            font-weight: 600;
            font-size: 1.1rem;
            margin: 0;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            padding: 5px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .action-btn.edit {
            color: #008080;
            background: #e8f8f8;
        }

        .action-btn.edit:hover {
            background: #008080;
            color: #ffffff;
        }

        .action-btn.delete {
            color: #dc3545;
            background: #f8d7da;
        }

        .action-btn.delete:hover {
            background: #dc3545;
            color: #ffffff;
        }

        .item-details {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .item-meta {
            color: #999;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .loading-item {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 30px 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px dashed #e1e5e9;
        }

        .empty-state h4 {
            color: #008080;
            margin-bottom: 10px;
        }

        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e1e5e9;
        }

        .profile-actions .btn,
        .profile-actions .btn-secondary {
            flex: 1;
            margin: 0;
        }

        .logout-btn {
            background: #dc3545 !important;
        }

        .logout-btn:hover {
            background: #c82333 !important;
        }

        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .form-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .form-modal-content {
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .form-modal.show .form-modal-content {
            transform: scale(1);
        }

        .form-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #008080;
        }

        .form-modal-header h3 {
            color: #008080;
            margin: 0;
        }

        .form-modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .form-modal-actions .btn,
        .form-modal-actions .btn-secondary {
            flex: 1;
            margin: 0;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 30px 20px;
            }
            
            .logo h1 {
                font-size: 2rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .option-card {
                padding: 15px;
            }
            
            .option-icon {
                font-size: 1.5rem;
            }
            
            .time-slots {
                grid-template-columns: 1fr;
            }

            .plan-options {
                grid-template-columns: 1fr;
            }

            .plan-card {
                padding: 15px;
            }

            .profile-info-content {
                gap: 8px;
            }

            .profile-info-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 2px;
            }

            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .profile-actions {
                flex-direction: column;
            }

            .step-navigation {
                flex-direction: column;
                gap: 10px;
            }

            .step-navigation .btn,
            .step-navigation .btn-secondary {
                width: 100%;
                margin: 0;
            }

            .modal-actions {
                flex-direction: column;
            }

            .form-modal-actions {
                flex-direction: column;
            }

            .payment-options {
                gap: 10px;
            }

            .amount-breakdown {
                gap: 8px;
            }

            .tooltip .tooltiptext {
                width: 150px;
                margin-left: -75px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="card">
            <div class="logo">
                <h1>Clenzzo</h1>
                <p>Premium Car Cleaning Service</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginPhone">Phone Number</label>
                    <div class="input-wrapper">
                        <input type="tel" id="loginPhone" placeholder="Enter 10-digit phone number" maxlength="10" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="loginPhoneError"></div>
                </div>
                
                <div class="form-group">
                    <label for="loginPin">PIN</label>
                    <div class="input-wrapper">
                        <input type="password" id="loginPin" placeholder="Enter 4-digit PIN" maxlength="4" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="loginPinError"></div>
                </div>
                
                <button type="submit" class="btn" id="loginBtn">Login</button>
            </form>
            
            <div class="link">
                <a href="#" id="showSignup">Don't have an account? Sign Up</a>
            </div>
        </div>

        <!-- Signup Screen -->
        <div id="signupScreen" class="card hidden">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Step 1 of 7</div>
            </div>

            <div class="step-indicator" id="stepIndicator">
                <div class="step-dot active"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
            </div>

            <!-- Step 1: Name -->
            <div id="step1" class="signup-step">
                <div class="logo">
                    <h2>What's your name?</h2>
                    <p>We'll use this to personalize your experience</p>
                </div>
                <div class="form-group">
                    <div class="input-wrapper">
                        <input type="text" id="userName" placeholder="Enter your full name" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="userNameError"></div>
                </div>
                <button type="button" class="btn" onclick="nextStep(2)">Continue</button>
            </div>

            <!-- Step 2: Phone -->
            <div id="step2" class="signup-step hidden">
                <div class="logo">
                    <h2>Your phone number</h2>
                </div>
                <div class="form-group">
                    <input type="tel" id="userPhone" placeholder="Enter 10-digit phone number" maxlength="10" required>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevStep(1)">Back</button>
                    <button type="button" class="btn" onclick="nextStep(3)">Continue</button>
                </div>
            </div>

            <!-- Step 3: PIN -->
            <div id="step3" class="signup-step hidden">
                <div class="logo">
                    <h2>Create a 4-digit PIN</h2>
                </div>
                <div class="form-group">
                    <input type="password" id="userPin" placeholder="Enter 4-digit PIN" maxlength="4" required>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevStep(2)">Back</button>
                    <button type="button" class="btn" onclick="nextStep(4)">Continue</button>
                </div>
            </div>

            <!-- Step 4: Address -->
            <div id="step4" class="signup-step hidden">
                <div class="logo">
                    <h2>Your address</h2>
                </div>
                <div class="form-group">
                    <label>Address Nickname</label>
                    <input type="text" id="addressNickname" placeholder="e.g., Home, Office" required>
                </div>
                <div class="form-group">
                    <label>Plot/House Number</label>
                    <input type="text" id="plot" placeholder="Plot/House number" required>
                </div>
                <div class="form-group">
                    <label>Street</label>
                    <input type="text" id="street" placeholder="Street name" required>
                </div>
                <div class="form-group">
                    <label>Area</label>
                    <input type="text" id="area" placeholder="Area/Locality" required>
                </div>
                <div class="form-group">
                    <label>Landmark</label>
                    <input type="text" id="landmark" placeholder="Nearby landmark" required>
                </div>
                <div class="form-group">
                    <label>Pincode</label>
                    <input type="text" id="pincode" placeholder="Pincode (starts with 62)" maxlength="6" required>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevStep(3)">Back</button>
                    <button type="button" class="btn" onclick="nextStep(5)">Continue</button>
                </div>
            </div>

            <!-- Step 5: Car Details -->
            <div id="step5" class="signup-step hidden">
                <div class="logo">
                    <h2>Your car details</h2>
                </div>
                <div class="form-group">
                    <label>Car Nickname</label>
                    <input type="text" id="carNickname" placeholder="e.g., Swift, Family SUV" required>
                </div>
                <div class="form-group">
                    <label>Car Type</label>
                    <select id="carType" required>
                        <option value="">Select car type</option>
                        <option value="Hatchback">Hatchback</option>
                        <option value="Sedan">Sedan</option>
                        <option value="SUV">SUV</option>
                        <option value="MPV">MPV</option>
                        <option value="Electric">Electric</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Car Brand</label>
                    <select id="carBrand" required disabled>
                        <option value="">Select car brand</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Car Model</label>
                    <select id="carModel" required disabled>
                        <option value="">Select car model</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>License Plate</label>
                    <input type="text" id="plateNumber" placeholder="e.g., TN-45-AB-1234" required>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevStep(4)">Back</button>
                    <button type="button" class="btn" onclick="nextStep(6)">Continue</button>
                </div>
            </div>

            <!-- Step 6: Review -->
            <div id="step6" class="signup-step hidden">
                <div class="logo">
                    <h2>Review your details</h2>
                </div>
                <div id="reviewContent"></div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevStep(5)">Back</button>
                    <button type="button" class="btn" onclick="nextStep(7)">Looks Good</button>
                </div>
            </div>

            <!-- Step 7: Submit -->
            <div id="step7" class="signup-step hidden">
                <div class="logo">
                    <h2>Creating your account...</h2>
                    <p>Please wait while we set up your Clenzzo account</p>
                </div>
                <button type="button" class="btn" id="submitBtn" onclick="submitSignup()">
                    <span class="loading"></span> Creating Account...
                </button>
            </div>

            <div class="link">
                <a href="#" id="showLogin">Already have an account? Login</a>
            </div>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen" class="card hidden">
            <div class="greeting" id="homeGreeting">
                <h2>Vanakkam Trichy!</h2>
                <p>Welcome to Clenzzo</p>
            </div>

            <!-- Recent Bookings Section -->
            <div class="recent-bookings" id="recentBookings" style="display: none;">
                <h3>📅 Recent Bookings</h3>
                <div id="recentBookingsList">
                    <!-- Recent bookings will be populated here -->
                </div>
            </div>

            <div class="options-grid">
                <div class="option-card" onclick="startTrialBooking()">
                    <div class="option-icon">🚗</div>
                    <h3>Trial Booking 
                        <span class="tooltip">
                            <span class="help-icon">?</span>
                            <span class="tooltiptext">5-day premium waterless car cleaning trial for new customers</span>
                        </span>
                    </h3>
                    <p>₹150 Premium Trial</p>
                </div>

                <div class="option-card" onclick="startOneTimeBooking()">
                    <div class="option-icon">🧽</div>
                    <h3>Book Us
                        <span class="tooltip">
                            <span class="help-icon">?</span>
                            <span class="tooltiptext">Complete exterior and interior waterless cleaning service</span>
                        </span>
                    </h3>
                    <p>One-Time Service</p>
                </div>

                <div class="option-card" onclick="startSubscriptionBooking()">
                    <div class="option-icon">📅</div>
                    <h3>Subscribe Us
                        <span class="tooltip">
                            <span class="help-icon">?</span>
                            <span class="tooltiptext">Weekly cleaning service with flexible monthly plans</span>
                        </span>
                    </h3>
                    <p>Monthly Plans</p>
                </div>

                <div class="option-card" onclick="showProfile()">
                    <div class="option-icon">👤</div>
                    <h3>Profile</h3>
                    <p>Manage Account</p>
                </div>

                <div class="option-card" onclick="logout()">
                    <div class="option-icon">🚪</div>
                    <h3>Logout</h3>
                    <p>Sign Out</p>
                </div>
            </div>
        </div>

        <!-- Subscription Booking Screen -->
        <div id="subscriptionBookingScreen" class="card hidden">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="subscriptionProgressFill"></div>
                </div>
                <div class="progress-text" id="subscriptionProgressText">Step 1 of 12</div>
            </div>

            <!-- Subscription Step 1: Name -->
            <div id="subscriptionStep1" class="subscription-step">
                <div class="logo">
                    <h2>Confirm your name</h2>
                    <p class="service-info">Choose your subscription plan in the next steps</p>
                </div>
                <div class="form-group">
                    <div class="input-wrapper">
                        <input type="text" id="subscriptionName" placeholder="Enter your full name" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="subscriptionNameError"></div>
                </div>
                <button type="button" class="btn" onclick="nextSubscriptionStep(2)">Continue</button>
                <button type="button" class="btn-secondary" onclick="backToHome()">Back to Home</button>
            </div>

            <!-- Subscription Step 2: Phone -->
            <div id="subscriptionStep2" class="subscription-step hidden">
                <div class="logo">
                    <h2>Your phone number</h2>
                </div>
                <div class="form-group">
                    <div class="input-wrapper">
                        <input type="tel" id="subscriptionPhone" placeholder="Enter 10-digit phone number" maxlength="10" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="subscriptionPhoneError"></div>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(1)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(3)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 3: Address Selection -->
            <div id="subscriptionStep3" class="subscription-step hidden">
                <div class="logo">
                    <h2>Select address</h2>
                </div>
                <div class="form-group">
                    <select id="subscriptionAddress" required>
                        <option value="">Select saved address</option>
                    </select>
                </div>
                <div class="add-new-option">
                    <a href="#" onclick="showAddNewAddressSubscription()">+ Add New Address</a>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(2)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(4)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 4: Car Selection -->
            <div id="subscriptionStep4" class="subscription-step hidden">
                <div class="logo">
                    <h2>Select your car</h2>
                </div>
                <div class="form-group">
                    <select id="subscriptionCar" required>
                        <option value="">Select saved car</option>
                    </select>
                </div>
                <div class="add-new-option">
                    <a href="#" onclick="showAddNewCarSubscription()">+ Add New Car</a>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(3)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(5)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 5: Plan Selection -->
            <div id="subscriptionStep5" class="subscription-step hidden">
                <div class="logo">
                    <h2>Choose your plan</h2>
                </div>
                <div class="plan-options">
                    <div class="plan-card" onclick="selectPlan('1month', 1200, this)">
                        <h3>1 Month</h3>
                        <div class="plan-price">₹1,200</div>
                        <p>4 cleanings per month</p>
                        <div class="plan-features">
                            <span>✓ Premium waterless cleaning</span>
                            <span>✓ Interior & exterior</span>
                            <span>✓ Weekly service</span>
                        </div>
                    </div>
                    <div class="plan-card popular" onclick="selectPlan('3months', 3600, this)">
                        <div class="popular-badge">Most Popular</div>
                        <h3>3 Months</h3>
                        <div class="plan-price">₹3,600</div>
                        <p>12 cleanings total</p>
                        <div class="plan-features">
                            <span>✓ Premium waterless cleaning</span>
                            <span>✓ Interior & exterior</span>
                            <span>✓ Weekly service</span>
                            <span>✓ Save ₹600</span>
                        </div>
                    </div>
                    <div class="plan-card" onclick="selectPlan('6months', 7200, this)">
                        <h3>6 Months</h3>
                        <div class="plan-price">₹7,200</div>
                        <p>24 cleanings total</p>
                        <div class="plan-features">
                            <span>✓ Premium waterless cleaning</span>
                            <span>✓ Interior & exterior</span>
                            <span>✓ Weekly service</span>
                            <span>✓ Save ₹1,200</span>
                        </div>
                    </div>
                    <div class="plan-card" onclick="selectPlan('12months', 14400, this)">
                        <h3>12 Months</h3>
                        <div class="plan-price">₹14,400</div>
                        <p>48 cleanings total</p>
                        <div class="plan-features">
                            <span>✓ Premium waterless cleaning</span>
                            <span>✓ Interior & exterior</span>
                            <span>✓ Weekly service</span>
                            <span>✓ Save ₹2,400</span>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(4)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(6)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 6: Start Date -->
            <div id="subscriptionStep6" class="subscription-step hidden">
                <div class="logo">
                    <h2>Choose start date</h2>
                </div>
                <div class="form-group">
                    <input type="date" id="subscriptionDate" required>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(5)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(7)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 7: Time Slot -->
            <div id="subscriptionStep7" class="subscription-step hidden">
                <div class="logo">
                    <h2>Preferred time slot</h2>
                    <p>Choose your preferred 1-hour window for weekly cleanings</p>
                </div>
                <div class="time-slots" id="subscriptionSlots">
                    <!-- Time slots will be populated by JavaScript -->
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(6)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(8)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 8: Promo Code -->
            <div id="subscriptionStep8" class="subscription-step hidden">
                <div class="logo">
                    <h2>Promo code (optional)</h2>
                </div>
                <div class="form-group">
                    <input type="text" id="subscriptionPromo" placeholder="Enter promo code" style="text-transform: lowercase;">
                    <button type="button" class="btn-secondary" onclick="applySubscriptionPromoCode()" style="margin-top: 10px; width: auto; padding: 10px 20px;">Apply Code</button>
                </div>
                <div id="subscriptionPromoMessage" class="promo-message hidden"></div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(7)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(9)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 9: Estimated Amount -->
            <div id="subscriptionStep9" class="subscription-step hidden">
                <div class="logo">
                    <h2>Estimated amount</h2>
                </div>
                <div class="amount-card">
                    <div class="amount-breakdown">
                        <div class="amount-row">
                            <span id="subscriptionPlanText">Plan Charge:</span>
                            <span id="subscriptionPlanAmount">₹0</span>
                        </div>
                        <div class="amount-row promo-row hidden" id="subscriptionPromoRow">
                            <span>Promo Discount:</span>
                            <span id="subscriptionPromoDiscount">-₹0</span>
                        </div>
                        <div class="amount-row total-row">
                            <span><strong>Total Amount:</strong></span>
                            <span><strong id="subscriptionTotalAmount">₹0</strong></span>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(8)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(10)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 10: Payment Option -->
            <div id="subscriptionStep10" class="subscription-step hidden">
                <div class="logo">
                    <h2>Payment method</h2>
                </div>
                <div class="payment-options">
                    <label class="payment-option">
                        <input type="radio" name="subscriptionPaymentMethod" value="cash" checked>
                        <div class="payment-card">
                            <div class="payment-icon">💵</div>
                            <div class="payment-info">
                                <h4>Cash</h4>
                                <p>Pay monthly after each service</p>
                            </div>
                        </div>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="subscriptionPaymentMethod" value="qr">
                        <div class="payment-card">
                            <div class="payment-icon">📱</div>
                            <div class="payment-info">
                                <h4>Scan QR</h4>
                                <p>UPI/Digital payment</p>
                            </div>
                        </div>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="subscriptionPaymentMethod" value="card">
                        <div class="payment-card">
                            <div class="payment-icon">💳</div>
                            <div class="payment-info">
                                <h4>Card</h4>
                                <p>Credit/Debit card payment</p>
                            </div>
                        </div>
                    </label>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(9)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(11)">Continue</button>
                </div>
            </div>

            <!-- Subscription Step 11: Summary -->
            <div id="subscriptionStep11" class="subscription-step hidden">
                <div class="logo">
                    <h2>Subscription Summary</h2>
                </div>
                <div id="subscriptionSummary" class="summary-content">
                    <!-- Summary will be populated by JavaScript -->
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevSubscriptionStep(10)">Back</button>
                    <button type="button" class="btn" onclick="nextSubscriptionStep(12)">Confirm Subscription</button>
                </div>
            </div>

            <!-- Subscription Step 12: Confirm -->
            <div id="subscriptionStep12" class="subscription-step hidden">
                <div class="logo">
                    <h2>Confirming your subscription...</h2>
                    <p>Please wait while we process your subscription</p>
                </div>
                <button type="button" class="btn" id="confirmSubscriptionBtn" onclick="confirmSubscriptionBooking()">
                    <span class="loading"></span> Confirming...
                </button>
            </div>
        </div>

        <!-- One-Time Booking Screen -->
        <div id="oneTimeBookingScreen" class="card hidden">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="oneTimeProgressFill"></div>
                </div>
                <div class="progress-text" id="oneTimeProgressText">Step 1 of 12</div>
            </div>

            <!-- One-Time Step 1: Name -->
            <div id="oneTimeStep1" class="onetime-step">
                <div class="logo">
                    <h2>Confirm your name</h2>
                    <p class="service-info">Premium Waterless Car Deep Cleaning - ₹600</p>
                </div>
                <div class="form-group">
                    <div class="input-wrapper">
                        <input type="text" id="oneTimeName" placeholder="Enter your full name" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="oneTimeNameError"></div>
                </div>
                <button type="button" class="btn" onclick="nextOneTimeStep(2)">Continue</button>
                <button type="button" class="btn-secondary" onclick="backToHome()">Back to Home</button>
            </div>

            <!-- One-Time Step 2: Phone -->
            <div id="oneTimeStep2" class="onetime-step hidden">
                <div class="logo">
                    <h2>Your phone number</h2>
                </div>
                <div class="form-group">
                    <div class="input-wrapper">
                        <input type="tel" id="oneTimePhone" placeholder="Enter 10-digit phone number" maxlength="10" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="oneTimePhoneError"></div>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(1)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(3)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 3: Address Selection -->
            <div id="oneTimeStep3" class="onetime-step hidden">
                <div class="logo">
                    <h2>Select address</h2>
                </div>
                <div class="form-group">
                    <select id="oneTimeAddress" required>
                        <option value="">Select saved address</option>
                    </select>
                </div>
                <div class="add-new-option">
                    <a href="#" onclick="showAddNewAddressOneTime()">+ Add New Address</a>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(2)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(4)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 4: Car Selection -->
            <div id="oneTimeStep4" class="onetime-step hidden">
                <div class="logo">
                    <h2>Select your car</h2>
                </div>
                <div class="form-group">
                    <select id="oneTimeCar" required>
                        <option value="">Select saved car</option>
                    </select>
                </div>
                <div class="add-new-option">
                    <a href="#" onclick="showAddNewCarOneTime()">+ Add New Car</a>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(3)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(5)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 5: Service Type -->
            <div id="oneTimeStep5" class="onetime-step hidden">
                <div class="logo">
                    <h2>Service selected</h2>
                </div>
                <div class="service-card selected-service">
                    <h3>Premium Waterless Car Deep Cleaning</h3>
                    <p>Complete exterior and interior cleaning with premium products</p>
                    <div class="service-price">₹600</div>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(4)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(6)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 6: Date Selection -->
            <div id="oneTimeStep6" class="onetime-step hidden">
                <div class="logo">
                    <h2>Choose date</h2>
                </div>
                <div class="form-group">
                    <input type="date" id="oneTimeDate" required>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(5)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(7)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 7: Time Slot -->
            <div id="oneTimeStep7" class="onetime-step hidden">
                <div class="logo">
                    <h2>Select time slot</h2>
                </div>
                <div class="time-slots" id="oneTimeSlots">
                    <!-- Time slots will be populated by JavaScript -->
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(6)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(8)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 8: Promo Code -->
            <div id="oneTimeStep8" class="onetime-step hidden">
                <div class="logo">
                    <h2>Promo code (optional)</h2>
                </div>
                <div class="form-group">
                    <input type="text" id="oneTimePromo" placeholder="Enter promo code" style="text-transform: lowercase;">
                    <button type="button" class="btn-secondary" onclick="applyPromoCode()" style="margin-top: 10px; width: auto; padding: 10px 20px;">Apply Code</button>
                </div>
                <div id="promoMessage" class="promo-message hidden"></div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(7)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(9)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 9: Estimated Amount -->
            <div id="oneTimeStep9" class="onetime-step hidden">
                <div class="logo">
                    <h2>Estimated amount</h2>
                </div>
                <div class="amount-card">
                    <div class="amount-breakdown">
                        <div class="amount-row">
                            <span>Service Charge:</span>
                            <span>₹600</span>
                        </div>
                        <div class="amount-row promo-row hidden" id="promoRow">
                            <span>Promo Discount:</span>
                            <span id="promoDiscount">-₹0</span>
                        </div>
                        <div class="amount-row total-row">
                            <span><strong>Total Amount:</strong></span>
                            <span><strong id="totalAmount">₹600</strong></span>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(8)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(10)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 10: Payment Option -->
            <div id="oneTimeStep10" class="onetime-step hidden">
                <div class="logo">
                    <h2>Payment method</h2>
                </div>
                <div class="payment-options">
                    <label class="payment-option">
                        <input type="radio" name="paymentMethod" value="cash" checked>
                        <div class="payment-card">
                            <div class="payment-icon">💵</div>
                            <div class="payment-info">
                                <h4>Cash</h4>
                                <p>Pay after service completion</p>
                            </div>
                        </div>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="paymentMethod" value="qr">
                        <div class="payment-card">
                            <div class="payment-icon">📱</div>
                            <div class="payment-info">
                                <h4>Scan QR</h4>
                                <p>UPI/Digital payment</p>
                            </div>
                        </div>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="paymentMethod" value="card">
                        <div class="payment-card">
                            <div class="payment-icon">💳</div>
                            <div class="payment-info">
                                <h4>Card</h4>
                                <p>Credit/Debit card payment</p>
                            </div>
                        </div>
                    </label>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(9)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(11)">Continue</button>
                </div>
            </div>

            <!-- One-Time Step 11: Summary -->
            <div id="oneTimeStep11" class="onetime-step hidden">
                <div class="logo">
                    <h2>Booking Summary</h2>
                </div>
                <div id="oneTimeSummary" class="summary-content">
                    <!-- Summary will be populated by JavaScript -->
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevOneTimeStep(10)">Back</button>
                    <button type="button" class="btn" onclick="nextOneTimeStep(12)">Confirm Booking</button>
                </div>
            </div>

            <!-- One-Time Step 12: Confirm -->
            <div id="oneTimeStep12" class="onetime-step hidden">
                <div class="logo">
                    <h2>Confirming your booking...</h2>
                    <p>Please wait while we process your booking</p>
                </div>
                <button type="button" class="btn" id="confirmOneTimeBtn" onclick="confirmOneTimeBooking()">
                    <span class="loading"></span> Confirming...
                </button>
            </div>
        </div>

        <!-- Trial Booking Screen -->
        <div id="trialBookingScreen" class="card hidden">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="trialProgressFill"></div>
                </div>
                <div class="progress-text" id="trialProgressText">Step 1 of 7</div>
            </div>

            <!-- Trial Step 1: Name -->
            <div id="trialStep1" class="trial-step">
                <div class="logo">
                    <h2>Confirm your name</h2>
                    <p class="trial-info">5-Day Premium Waterless Car Cleaning Trial - ₹150</p>
                </div>
                <div class="form-group">
                    <input type="text" id="trialName" placeholder="Enter your full name" required>
                </div>
                <button type="button" class="btn" onclick="nextTrialStep(2)">Continue</button>
                <button type="button" class="btn-secondary" onclick="backToHome()">Back to Home</button>
            </div>

            <!-- Trial Step 2: Address Selection -->
            <div id="trialStep2" class="trial-step hidden">
                <div class="logo">
                    <h2>Select address</h2>
                </div>
                <div class="form-group">
                    <select id="trialAddress" required>
                        <option value="">Select saved address</option>
                    </select>
                </div>
                <div class="add-new-option">
                    <a href="#" onclick="showAddNewAddress()">+ Add New Address</a>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevTrialStep(1)">Back</button>
                    <button type="button" class="btn" onclick="nextTrialStep(3)">Continue</button>
                </div>
            </div>

            <!-- Trial Step 3: Car Selection -->
            <div id="trialStep3" class="trial-step hidden">
                <div class="logo">
                    <h2>Select your car</h2>
                </div>
                <div class="form-group">
                    <select id="trialCar" required>
                        <option value="">Select saved car</option>
                    </select>
                </div>
                <div class="add-new-option">
                    <a href="#" onclick="showAddNewCar()">+ Add New Car</a>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevTrialStep(2)">Back</button>
                    <button type="button" class="btn" onclick="nextTrialStep(4)">Continue</button>
                </div>
            </div>

            <!-- Trial Step 4: Date Selection -->
            <div id="trialStep4" class="trial-step hidden">
                <div class="logo">
                    <h2>Choose date</h2>
                    <p>Select your preferred service date (from October 1st onwards)</p>
                </div>
                <div class="form-group">
                    <label for="trialDate">Service Date</label>
                    <div class="date-input-wrapper">
                        <input type="date" id="trialDate" required>
                        <span class="validation-icon success">✓</span>
                        <span class="validation-icon error">✗</span>
                    </div>
                    <div class="error-message" id="trialDateError"></div>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevTrialStep(3)">Back</button>
                    <button type="button" class="btn" onclick="nextTrialStep(5)">Continue</button>
                </div>
            </div>

            <!-- Trial Step 5: Time Slot -->
            <div id="trialStep5" class="trial-step hidden">
                <div class="logo">
                    <h2>Select time slot</h2>
                </div>
                <div class="time-slots" id="timeSlots">
                    <!-- Time slots will be populated by JavaScript -->
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevTrialStep(4)">Back</button>
                    <button type="button" class="btn" onclick="nextTrialStep(6)">Continue</button>
                </div>
            </div>

            <!-- Trial Step 6: Summary -->
            <div id="trialStep6" class="trial-step hidden">
                <div class="logo">
                    <h2>Booking Summary</h2>
                </div>
                <div id="trialSummary" class="summary-content">
                    <!-- Summary will be populated by JavaScript -->
                </div>
                <div class="payment-info">
                    <p><strong>Payment:</strong> ₹150 cash after service</p>
                </div>
                <div class="step-navigation">
                    <button type="button" class="btn-secondary" onclick="prevTrialStep(5)">Back</button>
                    <button type="button" class="btn" onclick="nextTrialStep(7)">Confirm Booking</button>
                </div>
            </div>

            <!-- Trial Step 7: Confirm -->
            <div id="trialStep7" class="trial-step hidden">
                <div class="logo">
                    <h2>Confirming your booking...</h2>
                    <p>Please wait while we process your trial booking</p>
                </div>
                <button type="button" class="btn" id="confirmTrialBtn" onclick="confirmTrialBooking()">
                    <span class="loading"></span> Confirming...
                </button>
            </div>
        </div>

        <!-- Add New Address Modal -->
        <div id="addAddressModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New Address</h3>
                    <button class="close-btn" onclick="closeAddressModal()">&times;</button>
                </div>
                <div class="form-group">
                    <label>Address Nickname</label>
                    <input type="text" id="newAddressNickname" placeholder="e.g., Office, Friend's Place">
                </div>
                <div class="form-group">
                    <label>Plot/House Number</label>
                    <input type="text" id="newPlot" placeholder="Plot/House number">
                </div>
                <div class="form-group">
                    <label>Street</label>
                    <input type="text" id="newStreet" placeholder="Street name">
                </div>
                <div class="form-group">
                    <label>Area</label>
                    <input type="text" id="newArea" placeholder="Area/Locality">
                </div>
                <div class="form-group">
                    <label>Landmark</label>
                    <input type="text" id="newLandmark" placeholder="Nearby landmark">
                </div>
                <div class="form-group">
                    <label>Pincode</label>
                    <input type="text" id="newPincode" placeholder="Pincode (starts with 62)" maxlength="6">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeAddressModal()">Cancel</button>
                    <button type="button" class="btn" onclick="saveNewAddress()">Save Address</button>
                </div>
            </div>
        </div>

        <!-- Add Car Form Modal -->
        <div id="addCarFormModal" class="form-modal hidden">
            <div class="form-modal-content">
                <div class="form-modal-header">
                    <h3>Add New Car</h3>
                    <button class="close-btn" onclick="closeAddCarForm()">&times;</button>
                </div>
                <div class="form-group">
                    <label>Car Nickname</label>
                    <input type="text" id="profileCarNickname" placeholder="e.g., Office Car, Weekend Ride">
                </div>
                <div class="form-group">
                    <label>Car Type</label>
                    <select id="profileCarType">
                        <option value="">Select car type</option>
                        <option value="Hatchback">Hatchback</option>
                        <option value="Sedan">Sedan</option>
                        <option value="SUV">SUV</option>
                        <option value="MPV">MPV</option>
                        <option value="Electric">Electric</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Car Brand</label>
                    <select id="profileCarBrand" disabled>
                        <option value="">Select car brand</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Car Model</label>
                    <select id="profileCarModel" disabled>
                        <option value="">Select car model</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>License Plate</label>
                    <input type="text" id="profilePlateNumber" placeholder="e.g., TN-45-AB-1234">
                </div>
                <div class="form-modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeAddCarForm()">Cancel</button>
                    <button type="button" class="btn" onclick="saveProfileCar()">Save Car</button>
                </div>
            </div>
        </div>

        <!-- Add Address Form Modal -->
        <div id="addAddressFormModal" class="form-modal hidden">
            <div class="form-modal-content">
                <div class="form-modal-header">
                    <h3>Add New Address</h3>
                    <button class="close-btn" onclick="closeAddAddressForm()">&times;</button>
                </div>
                <div class="form-group">
                    <label>Address Nickname</label>
                    <input type="text" id="profileAddressNickname" placeholder="e.g., Office, Friend's Place">
                </div>
                <div class="form-group">
                    <label>Plot/House Number</label>
                    <input type="text" id="profilePlot" placeholder="Plot/House number">
                </div>
                <div class="form-group">
                    <label>Street</label>
                    <input type="text" id="profileStreet" placeholder="Street name">
                </div>
                <div class="form-group">
                    <label>Area</label>
                    <input type="text" id="profileArea" placeholder="Area/Locality">
                </div>
                <div class="form-group">
                    <label>Landmark</label>
                    <input type="text" id="profileLandmark" placeholder="Nearby landmark">
                </div>
                <div class="form-group">
                    <label>Pincode</label>
                    <input type="text" id="profilePincode" placeholder="Pincode (starts with 62)" maxlength="6">
                </div>
                <div class="form-group">
                    <label>City</label>
                    <input type="text" value="Trichy" disabled>
                </div>
                <div class="form-modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeAddAddressForm()">Cancel</button>
                    <button type="button" class="btn" onclick="saveProfileAddress()">Save Address</button>
                </div>
            </div>
        </div>

        <!-- Edit Car Form Modal -->
        <div id="editCarFormModal" class="form-modal hidden">
            <div class="form-modal-content">
                <div class="form-modal-header">
                    <h3>Edit Car</h3>
                    <button class="close-btn" onclick="closeEditCarForm()">&times;</button>
                </div>
                <div class="form-group">
                    <label>Car Nickname</label>
                    <input type="text" id="editCarNickname" placeholder="e.g., Office Car, Weekend Ride">
                </div>
                <div class="form-group">
                    <label>License Plate</label>
                    <input type="text" id="editPlateNumber" placeholder="e.g., TN-45-AB-1234">
                </div>
                <div class="form-modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeEditCarForm()">Cancel</button>
                    <button type="button" class="btn" onclick="updateProfileCar()">Update Car</button>
                </div>
            </div>
        </div>

        <!-- Edit Address Form Modal -->
        <div id="editAddressFormModal" class="form-modal hidden">
            <div class="form-modal-content">
                <div class="form-modal-header">
                    <h3>Edit Address</h3>
                    <button class="close-btn" onclick="closeEditAddressForm()">&times;</button>
                </div>
                <div class="form-group">
                    <label>Address Nickname</label>
                    <input type="text" id="editAddressNickname" placeholder="e.g., Office, Friend's Place">
                </div>
                <div class="form-group">
                    <label>Plot/House Number</label>
                    <input type="text" id="editPlot" placeholder="Plot/House number">
                </div>
                <div class="form-group">
                    <label>Street</label>
                    <input type="text" id="editStreet" placeholder="Street name">
                </div>
                <div class="form-group">
                    <label>Area</label>
                    <input type="text" id="editArea" placeholder="Area/Locality">
                </div>
                <div class="form-group">
                    <label>Landmark</label>
                    <input type="text" id="editLandmark" placeholder="Nearby landmark">
                </div>
                <div class="form-group">
                    <label>Pincode</label>
                    <input type="text" id="editPincode" placeholder="Pincode (starts with 62)" maxlength="6">
                </div>
                <div class="form-group">
                    <label>City</label>
                    <input type="text" value="Trichy" disabled>
                </div>
                <div class="form-modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeEditAddressForm()">Cancel</button>
                    <button type="button" class="btn" onclick="updateProfileAddress()">Update Address</button>
                </div>
            </div>
        </div>

        <!-- QR Payment Modal -->
        <div id="qrModal" class="qr-modal hidden">
            <div class="qr-content">
                <h3 style="color: #008080; margin-bottom: 20px;">Scan QR to Pay</h3>
                <div class="qr-placeholder">
                    QR Code will appear here
                </div>
                <p style="color: #666; margin-bottom: 20px;">Scan this QR code with any UPI app to make payment</p>
                <button type="button" class="btn" onclick="closeQRModal()">Close</button>
            </div>
        </div>

        <!-- Profile Screen -->
        <div id="profileScreen" class="card hidden">
            <div class="profile-header">
                <div class="profile-greeting">
                    <h2 id="profileGreeting">Hello, User 👋</h2>
                    <p>Here are your details with Clenzzo</p>
                </div>
                <div class="profile-info-card">
                    <div class="profile-info-content">
                        <div class="profile-info-item">
                            <span class="profile-label">Name:</span>
                            <span id="profileName">Loading...</span>
                        </div>
                        <div class="profile-info-item">
                            <span class="profile-label">Phone:</span>
                            <span id="profilePhone">Loading...</span>
                        </div>
                        <div class="profile-info-item">
                            <span class="profile-label">Total Bookings:</span>
                            <span id="profileBookings">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Saved Cars Section -->
            <div class="profile-section">
                <div class="section-header">
                    <h3>🚗 Saved Cars</h3>
                    <button class="fab-btn" onclick="showAddCarForm()">+</button>
                </div>
                <div id="carsList" class="items-list">
                    <div class="loading-item">Loading cars...</div>
                </div>
            </div>

            <!-- Saved Addresses Section -->
            <div class="profile-section">
                <div class="section-header">
                    <h3>🏠 Saved Addresses</h3>
                    <button class="fab-btn" onclick="showAddAddressForm()">+</button>
                </div>
                <div id="addressesList" class="items-list">
                    <div class="loading-item">Loading addresses...</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="profile-actions">
                <button type="button" class="btn-secondary" onclick="backToHome()">Back to Home</button>
                <button type="button" class="btn logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Add New Car Modal -->
        <div id="addCarModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New Car</h3>
                    <button class="close-btn" onclick="closeCarModal()">&times;</button>
                </div>
                <div class="form-group">
                    <label>Car Nickname</label>
                    <input type="text" id="newCarNickname" placeholder="e.g., Office Car, Weekend Ride">
                </div>
                <div class="form-group">
                    <label>Car Type</label>
                    <select id="newCarType">
                        <option value="">Select car type</option>
                        <option value="Hatchback">Hatchback</option>
                        <option value="Sedan">Sedan</option>
                        <option value="SUV">SUV</option>
                        <option value="MPV">MPV</option>
                        <option value="Electric">Electric</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Car Brand</label>
                    <select id="newCarBrand" disabled>
                        <option value="">Select car brand</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Car Model</label>
                    <select id="newCarModel" disabled>
                        <option value="">Select car model</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>License Plate</label>
                    <input type="text" id="newPlateNumber" placeholder="e.g., TN-45-AB-1234">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeCarModal()">Cancel</button>
                    <button type="button" class="btn" onclick="saveNewCar()">Save Car</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Car data for dynamic dropdowns
        const carData = {
            'Hatchback': {
                'Maruti Suzuki': ['Swift', 'Baleno', 'WagonR', 'Alto', 'Celerio'],
                'Hyundai': ['i20', 'Grand i10', 'Santro'],
                'Tata': ['Altroz', 'Tiago', 'Tigor'],
                'Honda': ['Jazz', 'Amaze'],
                'Ford': ['Figo', 'Freestyle']
            },
            'Sedan': {
                'Maruti Suzuki': ['Dzire', 'Ciaz'],
                'Hyundai': ['Verna', 'Aura'],
                'Honda': ['City', 'Amaze'],
                'Tata': ['Tigor'],
                'Skoda': ['Rapid', 'Octavia']
            },
            'SUV': {
                'Maruti Suzuki': ['Vitara Brezza', 'S-Cross', 'XL6'],
                'Hyundai': ['Creta', 'Venue', 'Tucson'],
                'Tata': ['Nexon', 'Harrier', 'Safari'],
                'Mahindra': ['XUV300', 'XUV500', 'Scorpio'],
                'Kia': ['Seltos', 'Sonet']
            },
            'MPV': {
                'Maruti Suzuki': ['Ertiga', 'XL6'],
                'Toyota': ['Innova Crysta'],
                'Mahindra': ['Marazzo'],
                'Renault': ['Triber']
            },
            'Electric': {
                'Tata': ['Nexon EV', 'Tigor EV'],
                'Hyundai': ['Kona Electric'],
                'MG': ['ZS EV'],
                'Mahindra': ['eVerito', 'e2o Plus']
            }
        };

        let currentStep = 1;
        let userData = {};
        let currentTrialStep = 1;
        let trialData = {};
        let currentOneTimeStep = 1;
        let oneTimeData = {};
        let currentSubscriptionStep = 1;
        let subscriptionData = {};
        let selectedTimeSlot = null;
        let selectedOneTimeSlot = null;
        let selectedSubscriptionSlot = null;
        let selectedPlan = null;
        let userAddresses = [];
        let userCars = [];
        let appliedPromo = null;
        let appliedSubscriptionPromo = null;
        let baseAmount = 600;
        let finalAmount = 600;
        let subscriptionBaseAmount = 0;
        let subscriptionFinalAmount = 0;

        // Validation system
        const ValidationRules = {
            name: {
                pattern: /^[a-zA-Z\s]{2,30}$/,
                message: 'Name must be 2-30 characters, letters only'
            },
            phone: {
                pattern: /^\d{10}$/,
                message: 'Phone must be exactly 10 digits'
            },
            pin: {
                pattern: /^\d{4}$/,
                message: 'PIN must be exactly 4 digits'
            },
            pincode: {
                pattern: /^62\d{4}$/,
                message: 'Pincode must start with 62 and be 6 digits'
            },
            plateNumber: {
                pattern: /^[A-Z]{2}[-\s]?\d{2}[-\s]?[A-Z]{1,2}[-\s]?\d{4}$/,
                message: 'Invalid plate format (e.g., TN-45-AB-1234)'
            }
        };

        const PromoRules = {
            'launch25': {
                discount: 0.25,
                description: '25% Launch Discount'
            }
        };

        // Validation helper functions
        function validateNameString(name) {
            return ValidationRules.name.pattern.test(name.trim());
        }

        function validatePhoneNumber(phone) {
            return ValidationRules.phone.pattern.test(phone.trim());
        }

        function validatePinNumber(pin) {
            return ValidationRules.pin.pattern.test(pin.trim());
        }

        function validatePincodeNumber(pincode) {
            return ValidationRules.pincode.pattern.test(pincode.trim());
        }

        function validatePlateNumber(plate) {
            return ValidationRules.plateNumber.pattern.test(plate.trim());
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkSession();
            setupEventListeners();
            initializeValidation();
        });

        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Navigation links
            document.getElementById('showSignup').addEventListener('click', (e) => {
                e.preventDefault();
                showScreen('signupScreen');
                resetSignup();
            });
            
            document.getElementById('showLogin').addEventListener('click', (e) => {
                e.preventDefault();
                showScreen('loginScreen');
            });

            // Car type change handler
            document.getElementById('carType').addEventListener('change', updateCarBrands);
            document.getElementById('carBrand').addEventListener('change', updateCarModels);
        }

        function initializeValidation() {
            // Real-time validation for all inputs
            const inputs = [
                { id: 'loginPhone', rule: 'phone' },
                { id: 'loginPin', rule: 'pin' },
                { id: 'userName', rule: 'name' },
                { id: 'userPhone', rule: 'phone' },
                { id: 'userPin', rule: 'pin' },
                { id: 'pincode', rule: 'pincode' },
                { id: 'plateNumber', rule: 'plateNumber' },
                { id: 'oneTimeName', rule: 'name' },
                { id: 'oneTimePhone', rule: 'phone' },
                { id: 'subscriptionName', rule: 'name' },
                { id: 'subscriptionPhone', rule: 'phone' }
            ];

            inputs.forEach(({ id, rule }) => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', (e) => validateField(e.target, rule));
                    element.addEventListener('blur', (e) => validateField(e.target, rule));
                }
            });

            // Date validation
            const dateInputs = ['trialDate', 'oneTimeDate', 'subscriptionDate'];
            dateInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', validateDateField);
                    element.addEventListener('blur', validateDateField);
                }
            });
        }

        function validateField(input, rule) {
            const formGroup = input.closest('.form-group');
            const errorElement = formGroup.querySelector('.error-message');
            const validationRule = ValidationRules[rule];
            
            if (!validationRule) return true;

            let value = input.value.trim();
            
            // Special processing for different field types
            if (rule === 'name') {
                value = capitalizeWords(value);
                input.value = value;
            } else if (rule === 'phone' || rule === 'pin') {
                value = value.replace(/\D/g, '');
                input.value = value;
            } else if (rule === 'pincode') {
                value = value.replace(/\D/g, '');
                input.value = value;
            } else if (rule === 'plateNumber') {
                value = value.toUpperCase().replace(/[^A-Z0-9-\s]/g, '');
                input.value = value;
            }

            const isValid = validationRule.pattern.test(value);
            
            if (value === '') {
                // Empty field - neutral state
                formGroup.classList.remove('error', 'success');
                hideError(errorElement);
                return false;
            } else if (isValid) {
                // Valid field
                formGroup.classList.remove('error');
                formGroup.classList.add('success');
                hideError(errorElement);
                return true;
            } else {
                // Invalid field
                formGroup.classList.remove('success');
                formGroup.classList.add('error');
                showError(errorElement, validationRule.message);
                return false;
            }
        }

        function validateDateField(e) {
            const input = e.target;
            const formGroup = input.closest('.form-group');
            const errorElement = formGroup.querySelector('.error-message');
            const selectedDate = new Date(input.value);
            const minDate = new Date(new Date().getFullYear(), 9, 1); // October 1st
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (!input.value) {
                formGroup.classList.remove('error', 'success');
                hideError(errorElement);
                return false;
            }

            if (selectedDate < minDate) {
                formGroup.classList.remove('success');
                formGroup.classList.add('error');
                showError(errorElement, 'Please select a date from October 1st onwards');
                return false;
            }

            if (selectedDate < today) {
                formGroup.classList.remove('success');
                formGroup.classList.add('error');
                showError(errorElement, 'Please select a future date');
                return false;
            }

            formGroup.classList.remove('error');
            formGroup.classList.add('success');
            hideError(errorElement);
            return true;
        }

        function showError(errorElement, message) {
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
        }

        function hideError(errorElement) {
            if (errorElement) {
                errorElement.classList.remove('show');
                setTimeout(() => {
                    errorElement.textContent = '';
                }, 300);
            }
        }

        function capitalizeWords(str) {
            return str.replace(/\b\w/g, l => l.toUpperCase());
        }

        function addBounceAnimation(element) {
            element.classList.add('bounce-in');
            setTimeout(() => {
                element.classList.remove('bounce-in');
            }, 600);
        }

        function addShakeAnimation(element) {
            element.classList.add('shake');
            setTimeout(() => {
                element.classList.remove('shake');
            }, 500);
        }

        function checkSession() {
            const session = localStorage.getItem('clenzzoSession');
            if (session) {
                const userData = JSON.parse(session);
                showHomeScreen(userData);
            } else {
                showScreen('loginScreen');
            }
        }

        function showScreen(screenId) {
            const screens = ['loginScreen', 'signupScreen', 'homeScreen', 'trialBookingScreen', 'oneTimeBookingScreen', 'subscriptionBookingScreen', 'profileScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function nextTrialStep(step) {
            if (!validateCurrentTrialStep()) return;
            
            // Store current step data
            storeTrialStepData();
            
            // Hide current step
            document.getElementById(`trialStep${currentTrialStep}`).classList.add('hidden');
            
            // Show next step
            currentTrialStep = step;
            document.getElementById(`trialStep${currentTrialStep}`).classList.remove('hidden');
            
            // Update progress
            updateTrialProgress();
            
            // Special handling for summary step
            if (step === 6) {
                populateTrialSummary();
            }
        }

        function prevTrialStep(step) {
            document.getElementById(`trialStep${currentTrialStep}`).classList.add('hidden');
            currentTrialStep = step;
            document.getElementById(`trialStep${currentTrialStep}`).classList.remove('hidden');
            updateTrialProgress();
        }

        function validateCurrentTrialStep() {
            switch(currentTrialStep) {
                case 1:
                    const name = document.getElementById('trialName').value;
                    if (!name || !validateNameString(name)) {
                        showToast('Please enter a valid name', 'error');
                        return false;
                    }
                    break;
                case 2:
                    const address = document.getElementById('trialAddress').value;
                    if (!address) {
                        showToast('Please select an address', 'error');
                        return false;
                    }
                    break;
                case 3:
                    const car = document.getElementById('trialCar').value;
                    if (!car) {
                        showToast('Please select a car', 'error');
                        return false;
                    }
                    break;
                case 4:
                    const date = document.getElementById('trialDate').value;
                    if (!date) {
                        showToast('Please select a date', 'error');
                        return false;
                    }
                    const selectedDate = new Date(date);
                    const minDate = new Date(new Date().getFullYear(), 9, 1); // October 1st
                    if (selectedDate < minDate) {
                        showToast('Please select a date from October 1st onwards', 'error');
                        return false;
                    }
                    break;
                case 5:
                    if (!selectedTimeSlot) {
                        showToast('Please select a time slot', 'error');
                        return false;
                    }
                    break;
            }
            return true;
        }

        function storeTrialStepData() {
            switch(currentTrialStep) {
                case 1:
                    trialData.name = document.getElementById('trialName').value;
                    break;
                case 2:
                    const addressId = document.getElementById('trialAddress').value;
                    const selectedAddress = userAddresses.find(addr => addr.id == addressId);
                    trialData.address = selectedAddress;
                    break;
                case 3:
                    const carId = document.getElementById('trialCar').value;
                    const selectedCar = userCars.find(car => car.id == carId);
                    trialData.car = selectedCar;
                    break;
                case 4:
                    trialData.date = document.getElementById('trialDate').value;
                    break;
                case 5:
                    trialData.timeSlot = selectedTimeSlot;
                    break;
            }
        }

        function updateTrialProgress() {
            const progress = (currentTrialStep / 7) * 100;
            document.getElementById('trialProgressFill').style.width = progress + '%';
            document.getElementById('trialProgressText').textContent = `Step ${currentTrialStep} of 7`;
        }

        function populateTrialSummary() {
            const summaryContent = document.getElementById('trialSummary');
            const formattedDate = new Date(trialData.date).toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const [hour, minute] = trialData.timeSlot.split(':');
            const displayTime = formatTime(parseInt(hour), parseInt(minute));
            
            summaryContent.innerHTML = `
                <div class="summary-item">
                    <h4>Customer</h4>
                    <p>${trialData.name}</p>
                </div>
                <div class="summary-item">
                    <h4>Address</h4>
                    <p>${trialData.address.nickname} - ${trialData.address.plot}, ${trialData.address.street}, ${trialData.address.area}, Trichy</p>
                </div>
                <div class="summary-item">
                    <h4>Car</h4>
                    <p>${trialData.car.nickname} (${trialData.car.brand} ${trialData.car.model})</p>
                </div>
                <div class="summary-item">
                    <h4>Date & Time</h4>
                    <p>${formattedDate} at ${displayTime}</p>
                </div>
                <div class="summary-item">
                    <h4>Service Plan</h4>
                    <p>5-Day Premium Waterless Car Cleaning Trial - ₹150</p>
                </div>
            `;
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const phone = document.getElementById('loginPhone').value;
            const pin = document.getElementById('loginPin').value;
            const loginBtn = document.getElementById('loginBtn');

            if (!validatePhoneNumber(phone) || !validatePinNumber(pin)) {
                showToast('Please enter valid phone number and PIN', 'error');
                return;
            }

            loginBtn.innerHTML = '<span class="loading"></span> Logging in...';
            loginBtn.disabled = true;

            try {
                const response = await fetch(`https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec?action=checkUser&phone=${phone}&pin=${pin}`);
                const result = await response.json();

                if (result.success) {
                    const sessionData = {
                        userId: result.userId,
                        name: result.name,
                        defaultCar: result.defaultCar,
                        defaultAddress: result.defaultAddress
                    };
                    
                    localStorage.setItem('clenzzoSession', JSON.stringify(sessionData));
                    showToast('Login successful!', 'success');
                    setTimeout(() => showHomeScreen(sessionData), 1000);
                } else {
                    showToast('Invalid phone number or PIN', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }

            loginBtn.innerHTML = 'Login';
            loginBtn.disabled = false;
        }

        function showHomeScreen(userData) {
            const greeting = document.getElementById('homeGreeting');
            greeting.innerHTML = `
                <h2>Vanakkam Trichy, ${userData.name}!</h2>
                <p>Your ${userData.defaultCar} at ${userData.defaultAddress} is ready for service.</p>
            `;
            
            // Load recent bookings
            loadRecentBookings(userData.userId);
            
            showScreen('homeScreen');
            
            // Add entrance animation
            const homeScreen = document.getElementById('homeScreen');
            addBounceAnimation(homeScreen);
        }

        function startTrialBooking() {
            const session = JSON.parse(localStorage.getItem('clenzzoSession'));
            if (session) {
                // Pre-fill name from session
                document.getElementById('trialName').value = session.name;
                
                // Load user's saved addresses and cars
                loadUserData(session.userId);
                
                // Reset trial data
                trialData = {};
                currentTrialStep = 1;
                selectedTimeSlot = null;
                
                // Show trial booking screen
                showScreen('trialBookingScreen');
                updateTrialProgress();
                
                // Setup date picker with enhanced features
                setupDatePicker('trialDate');
                
                // Generate time slots when date changes
                document.getElementById('trialDate').addEventListener('change', generateTimeSlots);
                
                // Initial time slots generation
                setTimeout(generateTimeSlots, 100);
                
                // Add entrance animation
                const trialScreen = document.getElementById('trialBookingScreen');
                addBounceAnimation(trialScreen);
            }
        }

        async function loadUserData(userId) {
            try {
                const response = await fetch(`https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec?action=getUserData&userId=${userId}`);
                const result = await response.json();
                
                if (result.success) {
                    userAddresses = result.addresses || [];
                    userCars = result.cars || [];
                    
                    // Populate address dropdown
                    const addressSelect = document.getElementById('trialAddress');
                    addressSelect.innerHTML = '<option value="">Select saved address</option>';
                    userAddresses.forEach(address => {
                        addressSelect.innerHTML += `<option value="${address.id}">${address.nickname}</option>`;
                    });
                    
                    // Populate car dropdown
                    const carSelect = document.getElementById('trialCar');
                    carSelect.innerHTML = '<option value="">Select saved car</option>';
                    userCars.forEach(car => {
                        carSelect.innerHTML += `<option value="${car.id}">${car.nickname}</option>`;
                    });
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function generateTimeSlots() {
            const timeSlotsContainer = document.getElementById('timeSlots');
            timeSlotsContainer.innerHTML = '';
            
            const selectedDate = document.getElementById('trialDate').value;
            const today = new Date();
            const isToday = selectedDate === today.toISOString().split('T')[0];
            const currentHour = today.getHours();
            const currentMinute = today.getMinutes();
            
            // Generate slots from 7:00 AM to 7:00 PM (half-hour intervals)
            for (let hour = 7; hour <= 19; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    if (hour === 19 && minute > 0) break; // Stop at 7:00 PM
                    
                    const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const displayTime = formatTime(hour, minute);
                    
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = displayTime;
                    
                    // Disable past time slots if selected date is today
                    const isPastSlot = isToday && (hour < currentHour || (hour === currentHour && minute <= currentMinute));
                    
                    if (isPastSlot) {
                        timeSlot.classList.add('disabled');
                        timeSlot.title = 'This time slot has passed';
                    } else {
                        timeSlot.onclick = () => selectTimeSlot(timeString, timeSlot);
                    }
                    
                    timeSlotsContainer.appendChild(timeSlot);
                }
            }
        }

        function formatTime(hour, minute) {
            const period = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
            return `${displayHour}:${minute.toString().padStart(2, '0')} ${period}`;
        }

        function selectTimeSlot(timeString, element) {
            // Remove previous selection
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Select current slot
            element.classList.add('selected');
            selectedTimeSlot = timeString;
        }

        function showComingSoon(feature) {
            showToast(`${feature} coming soon!`, 'success');
        }

        function backToHome() {
            showScreen('homeScreen');
        }

        function nextStep(step) {
            if (!validateCurrentStep()) {
                const currentStepElement = document.getElementById(`step${currentStep}`);
                addShakeAnimation(currentStepElement);
                return;
            }
            
            // Store current step data
            storeStepData();
            
            // Update step indicators
            updateStepIndicators(step);
            
            // Animate step transition
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const nextStepElement = document.getElementById(`step${step}`);
            
            // Slide out current step
            currentStepElement.style.transform = 'translateX(-100%)';
            currentStepElement.style.opacity = '0';
            
            setTimeout(() => {
                currentStepElement.classList.add('hidden');
                currentStep = step;
                
                // Slide in next step
                nextStepElement.classList.remove('hidden');
                nextStepElement.style.transform = 'translateX(100%)';
                nextStepElement.style.opacity = '0';
                
                setTimeout(() => {
                    nextStepElement.style.transform = 'translateX(0)';
                    nextStepElement.style.opacity = '1';
                    addBounceAnimation(nextStepElement);
                }, 50);
                
                // Update progress
                updateProgress();
                
                // Special handling for review step
                if (step === 6) {
                    populateReview();
                }
            }, 300);
        }

        function prevStep(step) {
            // Update step indicators
            updateStepIndicators(step);
            
            // Animate step transition
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const prevStepElement = document.getElementById(`step${step}`);
            
            // Slide out current step
            currentStepElement.style.transform = 'translateX(100%)';
            currentStepElement.style.opacity = '0';
            
            setTimeout(() => {
                currentStepElement.classList.add('hidden');
                currentStep = step;
                
                // Slide in previous step
                prevStepElement.classList.remove('hidden');
                prevStepElement.style.transform = 'translateX(-100%)';
                prevStepElement.style.opacity = '0';
                
                setTimeout(() => {
                    prevStepElement.style.transform = 'translateX(0)';
                    prevStepElement.style.opacity = '1';
                }, 50);
                
                updateProgress();
            }, 300);
        }

        function updateStepIndicators(targetStep) {
            const dots = document.querySelectorAll('#stepIndicator .step-dot');
            dots.forEach((dot, index) => {
                const stepNumber = index + 1;
                dot.classList.remove('active', 'completed');
                
                if (stepNumber < targetStep) {
                    dot.classList.add('completed');
                } else if (stepNumber === targetStep) {
                    dot.classList.add('active');
                }
            });
        }

        function validateCurrentStep() {
            let isValid = true;
            let firstErrorField = null;

            switch(currentStep) {
                case 1:
                    const nameInput = document.getElementById('userName');
                    if (!validateField(nameInput, 'name') || !nameInput.value.trim()) {
                        isValid = false;
                        firstErrorField = nameInput;
                    }
                    break;
                case 2:
                    const phoneInput = document.getElementById('userPhone');
                    if (!validateField(phoneInput, 'phone') || !phoneInput.value.trim()) {
                        isValid = false;
                        firstErrorField = phoneInput;
                    }
                    break;
                case 3:
                    const pinInput = document.getElementById('userPin');
                    if (!validateField(pinInput, 'pin') || !pinInput.value.trim()) {
                        isValid = false;
                        firstErrorField = pinInput;
                    }
                    break;
                case 4:
                    const addressFields = [
                        { id: 'addressNickname', rule: 'name' },
                        { id: 'plot', required: true },
                        { id: 'street', required: true },
                        { id: 'area', required: true },
                        { id: 'landmark', required: true },
                        { id: 'pincode', rule: 'pincode' }
                    ];
                    
                    for (let field of addressFields) {
                        const input = document.getElementById(field.id);
                        if (field.rule) {
                            if (!validateField(input, field.rule) || !input.value.trim()) {
                                isValid = false;
                                if (!firstErrorField) firstErrorField = input;
                            }
                        } else if (field.required && !input.value.trim()) {
                            const formGroup = input.closest('.form-group');
                            const errorElement = formGroup.querySelector('.error-message');
                            formGroup.classList.add('error');
                            showError(errorElement, 'This field is required');
                            isValid = false;
                            if (!firstErrorField) firstErrorField = input;
                        }
                    }
                    break;
                case 5:
                    const carFields = [
                        { id: 'carNickname', rule: 'name' },
                        { id: 'carType', required: true },
                        { id: 'carBrand', required: true },
                        { id: 'carModel', required: true },
                        { id: 'plateNumber', rule: 'plateNumber' }
                    ];
                    
                    for (let field of carFields) {
                        const input = document.getElementById(field.id);
                        if (field.rule) {
                            if (!validateField(input, field.rule) || !input.value.trim()) {
                                isValid = false;
                                if (!firstErrorField) firstErrorField = input;
                            }
                        } else if (field.required && !input.value.trim()) {
                            const formGroup = input.closest('.form-group');
                            const errorElement = formGroup.querySelector('.error-message');
                            formGroup.classList.add('error');
                            showError(errorElement, 'Please select an option');
                            isValid = false;
                            if (!firstErrorField) firstErrorField = input;
                        }
                    }
                    break;
            }

            if (!isValid && firstErrorField) {
                firstErrorField.focus();
                firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            return isValid;
        }

        function storeStepData() {
            switch(currentStep) {
                case 1:
                    userData.name = document.getElementById('userName').value;
                    break;
                case 2:
                    userData.phone = document.getElementById('userPhone').value;
                    break;
                case 3:
                    userData.pin = document.getElementById('userPin').value;
                    break;
                case 4:
                    userData.address = {
                        nickname: document.getElementById('addressNickname').value,
                        plot: document.getElementById('plot').value,
                        street: document.getElementById('street').value,
                        area: document.getElementById('area').value,
                        landmark: document.getElementById('landmark').value,
                        pincode: document.getElementById('pincode').value,
                        city: 'Trichy'
                    };
                    break;
                case 5:
                    userData.car = {
                        nickname: document.getElementById('carNickname').value,
                        type: document.getElementById('carType').value,
                        brand: document.getElementById('carBrand').value,
                        model: document.getElementById('carModel').value,
                        plateNumber: document.getElementById('plateNumber').value
                    };
                    break;
            }
        }

        function updateProgress() {
            const progress = (currentStep / 7) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Step ${currentStep} of 7`;
        }

        function populateReview() {
            const reviewContent = document.getElementById('reviewContent');
            reviewContent.innerHTML = `
                <div class="review-item">
                    <h4>Personal Details</h4>
                    <p>${userData.name} • ${userData.phone}</p>
                </div>
                <div class="review-item">
                    <h4>Address (${userData.address.nickname})</h4>
                    <p>${userData.address.plot}, ${userData.address.street}, ${userData.address.area}, ${userData.address.landmark}, ${userData.address.city} - ${userData.address.pincode}</p>
                </div>
                <div class="review-item">
                    <h4>Car (${userData.car.nickname})</h4>
                    <p>${userData.car.brand} ${userData.car.model} (${userData.car.type}) • ${userData.car.plateNumber}</p>
                </div>
            `;
        }

        async function submitSignup() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'registerUser',
                        userData: userData
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Account created successfully!', 'success');
                    setTimeout(() => {
                        showScreen('loginScreen');
                        resetSignup();
                    }, 2000);
                } else {
                    showToast(result.message || 'Registration failed', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }

            submitBtn.disabled = false;
        }

        function resetSignup() {
            currentStep = 1;
            userData = {};
            
            // Hide all steps except first
            for (let i = 2; i <= 7; i++) {
                document.getElementById(`step${i}`).classList.add('hidden');
            }
            document.getElementById('step1').classList.remove('hidden');
            
            // Reset progress
            updateProgress();
            
            // Clear all form fields
            document.querySelectorAll('#signupScreen input, #signupScreen select').forEach(field => {
                field.value = '';
            });
        }

        function updateCarBrands() {
            const carType = document.getElementById('carType').value;
            const brandSelect = document.getElementById('carBrand');
            const modelSelect = document.getElementById('carModel');
            
            modelSelect.innerHTML = '<option value="">Select car model</option>';
            modelSelect.disabled = true;
            
            lazyLoadCarModels(carType, brandSelect, modelSelect);
        }

        function updateCarModels() {
            const carType = document.getElementById('carType').value;
            const carBrand = document.getElementById('carBrand').value;
            const modelSelect = document.getElementById('carModel');
            
            if (!carType || !carBrand || !carData[carType][carBrand]) {
                modelSelect.innerHTML = '<option value="">Select car model</option>';
                modelSelect.disabled = true;
                return;
            }

            // Progressive loading for models
            modelSelect.innerHTML = '<option value="">Loading models...</option>';
            modelSelect.disabled = true;
            
            setTimeout(() => {
                modelSelect.innerHTML = '<option value="">Select car model</option>';
                carData[carType][carBrand].forEach(model => {
                    modelSelect.innerHTML += `<option value="${model}">${model}</option>`;
                });
                modelSelect.disabled = false;
                addBounceAnimation(modelSelect);
            }, 200);
        }

        function showToast(message, type = 'error') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            
            // Remove existing classes
            toast.className = 'toast';
            
            // Add appropriate type class
            if (type === 'success') {
                toast.classList.add('success');
            } else if (type === 'warning') {
                toast.classList.add('warning');
            }
            
            toast.classList.add('show');
            
            // Auto-hide after duration based on type
            const duration = type === 'success' ? 4000 : type === 'warning' ? 5000 : 3000;
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Enhanced session management
        function updateSession(userData) {
            const existingSession = JSON.parse(localStorage.getItem('clenzzoSession') || '{}');
            const updatedSession = { ...existingSession, ...userData };
            localStorage.setItem('clenzzoSession', JSON.stringify(updatedSession));
        }

        // Progressive loading for car data
        function lazyLoadCarModels(carType, brandSelect, modelSelect) {
            if (!carType || !carData[carType]) {
                brandSelect.disabled = true;
                modelSelect.disabled = true;
                return;
            }

            // Simulate loading delay for better UX
            brandSelect.innerHTML = '<option value="">Loading brands...</option>';
            brandSelect.disabled = true;
            
            setTimeout(() => {
                brandSelect.innerHTML = '<option value="">Select car brand</option>';
                Object.keys(carData[carType]).forEach(brand => {
                    brandSelect.innerHTML += `<option value="${brand}">${brand}</option>`;
                });
                brandSelect.disabled = false;
                addBounceAnimation(brandSelect);
            }, 300);
        }

        // Enhanced date picker setup
        function setupDatePicker(inputId) {
            const dateInput = document.getElementById(inputId);
            if (!dateInput) return;

            const today = new Date();
            const minDate = new Date(today.getFullYear(), 9, 1); // October 1st
            const maxDate = new Date(today.getFullYear() + 1, 11, 31); // End of next year

            dateInput.min = minDate.toISOString().split('T')[0];
            dateInput.max = maxDate.toISOString().split('T')[0];
            
            // Set default to tomorrow if today is past October 1st
            if (today >= minDate) {
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                dateInput.value = tomorrow.toISOString().split('T')[0];
            } else {
                dateInput.value = minDate.toISOString().split('T')[0];
            }
        }

        async function confirmTrialBooking() {
            const confirmBtn = document.getElementById('confirmTrialBtn');
            const originalText = confirmBtn.innerHTML;
            
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<span class="loading"></span> Confirming...';
            confirmBtn.classList.add('pulse');
            
            // Add visual feedback
            addBounceAnimation(confirmBtn);

            try {
                const session = JSON.parse(localStorage.getItem('clenzzoSession'));
                const bookingData = {
                    action: 'submitBooking',
                    name: trialData.name,
                    phone: session.phone || '',
                    addressNickname: trialData.address.nickname,
                    fullAddress: `${trialData.address.plot}, ${trialData.address.street}, ${trialData.address.area}, ${trialData.address.landmark}, Trichy - ${trialData.address.pincode}`,
                    carNickname: trialData.car.nickname,
                    carType: trialData.car.type,
                    carBrand: trialData.car.brand,
                    carModel: trialData.car.model,
                    plateNumber: trialData.car.plateNumber,
                    date: trialData.date,
                    timeSlot: trialData.timeSlot,
                    planName: '5-Day Premium Waterless Car Cleaning Trial',
                    amount: 150
                };

                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();

                if (result.success) {
                    confirmBtn.classList.remove('pulse');
                    confirmBtn.classList.add('success');
                    confirmBtn.innerHTML = '✓ Booking Confirmed!';
                    
                    showToast('🎉 Trial booking confirmed successfully!', 'success');
                    
                    // Redirect to WhatsApp after 2 seconds
                    setTimeout(() => {
                        const formattedDate = new Date(trialData.date).toLocaleDateString('en-IN', {
                            day: 'numeric',
                            month: 'short'
                        });
                        
                        const [hour, minute] = trialData.timeSlot.split(':');
                        const displayTime = formatTime(parseInt(hour), parseInt(minute));
                        
                        const whatsappMessage = `Hi Clenzzo, I'd like to confirm my trial booking:
- Name: ${trialData.name}
- Car: ${trialData.car.nickname} (${trialData.car.brand} ${trialData.car.model})
- Address: ${trialData.address.nickname}, Trichy
- Date: ${formattedDate}
- Time: ${displayTime}
Plan: 5 Days Premium Waterless Car Cleaning – ₹150`;
                        
                        const whatsappUrl = `https://wa.me/918122213141?text=${encodeURIComponent(whatsappMessage)}`;
                        window.open(whatsappUrl, '_blank');
                        
                        // Return to home screen with success message
                        showScreen('homeScreen');
                        setTimeout(() => {
                            showToast('Check WhatsApp to complete your booking!', 'warning');
                        }, 500);
                    }, 2000);
                } else {
                    throw new Error(result.message || 'Booking failed');
                }
            } catch (error) {
                confirmBtn.classList.remove('pulse');
                addShakeAnimation(confirmBtn);
                showToast('Connection error. Please try again.', 'error');
                
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            }
        }

        function showAddNewAddress() {
            document.getElementById('addAddressModal').classList.add('show');
        }

        function closeAddressModal() {
            document.getElementById('addAddressModal').classList.remove('show');
            // Clear form
            document.querySelectorAll('#addAddressModal input').forEach(input => input.value = '');
        }

        function saveNewAddress() {
            const nickname = document.getElementById('newAddressNickname').value;
            const plot = document.getElementById('newPlot').value;
            const street = document.getElementById('newStreet').value;
            const area = document.getElementById('newArea').value;
            const landmark = document.getElementById('newLandmark').value;
            const pincode = document.getElementById('newPincode').value;

            if (!nickname || !plot || !street || !area || !landmark || !pincode) {
                showToast('Please fill all address fields', 'error');
                return;
            }

            if (!pincode.startsWith('62') || pincode.length !== 6) {
                showToast('Pincode must start with 62 and be 6 digits', 'error');
                return;
            }

            const newAddress = {
                id: Date.now(),
                nickname,
                plot,
                street,
                area,
                landmark,
                pincode,
                city: 'Trichy'
            };

            userAddresses.push(newAddress);
            
            // Update dropdown
            const addressSelect = document.getElementById('trialAddress');
            addressSelect.innerHTML += `<option value="${newAddress.id}">${newAddress.nickname}</option>`;
            addressSelect.value = newAddress.id;

            closeAddressModal();
            showToast('Address added successfully!', 'success');
        }

        function showAddNewCar() {
            document.getElementById('addCarModal').classList.add('show');
            
            // Setup car type change handler for modal
            document.getElementById('newCarType').addEventListener('change', updateNewCarBrands);
            document.getElementById('newCarBrand').addEventListener('change', updateNewCarModels);
        }

        function closeCarModal() {
            document.getElementById('addCarModal').classList.remove('show');
            // Clear form
            document.querySelectorAll('#addCarModal input, #addCarModal select').forEach(field => field.value = '');
            document.getElementById('newCarBrand').disabled = true;
            document.getElementById('newCarModel').disabled = true;
        }

        function updateNewCarBrands() {
            const carType = document.getElementById('newCarType').value;
            const brandSelect = document.getElementById('newCarBrand');
            const modelSelect = document.getElementById('newCarModel');
            
            brandSelect.innerHTML = '<option value="">Select car brand</option>';
            modelSelect.innerHTML = '<option value="">Select car model</option>';
            modelSelect.disabled = true;
            
            if (carType && carData[carType]) {
                Object.keys(carData[carType]).forEach(brand => {
                    brandSelect.innerHTML += `<option value="${brand}">${brand}</option>`;
                });
                brandSelect.disabled = false;
            } else {
                brandSelect.disabled = true;
            }
        }

        function updateNewCarModels() {
            const carType = document.getElementById('newCarType').value;
            const carBrand = document.getElementById('newCarBrand').value;
            const modelSelect = document.getElementById('newCarModel');
            
            modelSelect.innerHTML = '<option value="">Select car model</option>';
            
            if (carType && carBrand && carData[carType][carBrand]) {
                carData[carType][carBrand].forEach(model => {
                    modelSelect.innerHTML += `<option value="${model}">${model}</option>`;
                });
                modelSelect.disabled = false;
            } else {
                modelSelect.disabled = true;
            }
        }

        function saveNewCar() {
            const nickname = document.getElementById('newCarNickname').value;
            const type = document.getElementById('newCarType').value;
            const brand = document.getElementById('newCarBrand').value;
            const model = document.getElementById('newCarModel').value;
            const plateNumber = document.getElementById('newPlateNumber').value;

            if (!nickname || !type || !brand || !model || !plateNumber) {
                showToast('Please fill all car details', 'error');
                return;
            }

            const newCar = {
                id: Date.now(),
                nickname,
                type,
                brand,
                model,
                plateNumber: plateNumber.toUpperCase()
            };

            userCars.push(newCar);
            
            // Update dropdown
            const carSelect = document.getElementById('trialCar');
            carSelect.innerHTML += `<option value="${newCar.id}">${newCar.nickname}</option>`;
            carSelect.value = newCar.id;

            closeCarModal();
            showToast('Car added successfully!', 'success');
        }

        function bookService(serviceType) {
            showToast(`${serviceType} service booking coming soon!`, 'success');
        }

        function startOneTimeBooking() {
            const session = JSON.parse(localStorage.getItem('clenzzoSession'));
            if (session) {
                // Pre-fill name and phone from session
                document.getElementById('oneTimeName').value = session.name;
                document.getElementById('oneTimePhone').value = session.phone || '';
                
                // Load user's saved addresses and cars
                loadUserDataOneTime(session.userId);
                
                // Reset one-time data
                oneTimeData = {};
                currentOneTimeStep = 1;
                selectedOneTimeSlot = null;
                appliedPromo = null;
                baseAmount = 600;
                finalAmount = 600;
                
                // Show one-time booking screen
                showScreen('oneTimeBookingScreen');
                updateOneTimeProgress();
                
                // Set minimum date to October 1st
                const dateInput = document.getElementById('oneTimeDate');
                const today = new Date();
                const minDate = new Date(today.getFullYear(), 9, 1); // October 1st
                dateInput.min = minDate.toISOString().split('T')[0];
                
                // Set default date
                if (today >= minDate) {
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    dateInput.value = tomorrow.toISOString().split('T')[0];
                } else {
                    dateInput.value = minDate.toISOString().split('T')[0];
                }
                
                // Generate time slots when date changes
                dateInput.addEventListener('change', generateOneTimeSlots);
                
                // Generate initial time slots
                generateOneTimeSlots();
            }
        }

        async function loadUserDataOneTime(userId) {
            try {
                const response = await fetch(`https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec?action=getUserData&userId=${userId}`);
                const result = await response.json();
                
                if (result.success) {
                    userAddresses = result.addresses || [];
                    userCars = result.cars || [];
                    
                    // Populate address dropdown
                    const addressSelect = document.getElementById('oneTimeAddress');
                    addressSelect.innerHTML = '<option value="">Select saved address</option>';
                    userAddresses.forEach(address => {
                        addressSelect.innerHTML += `<option value="${address.id}">${address.nickname}</option>`;
                    });
                    
                    // Populate car dropdown
                    const carSelect = document.getElementById('oneTimeCar');
                    carSelect.innerHTML = '<option value="">Select saved car</option>';
                    userCars.forEach(car => {
                        carSelect.innerHTML += `<option value="${car.id}">${car.nickname}</option>`;
                    });
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function nextOneTimeStep(step) {
            if (!validateCurrentOneTimeStep()) return;
            
            // Store current step data
            storeOneTimeStepData();
            
            // Hide current step
            document.getElementById(`oneTimeStep${currentOneTimeStep}`).classList.add('hidden');
            
            // Show next step
            currentOneTimeStep = step;
            document.getElementById(`oneTimeStep${currentOneTimeStep}`).classList.remove('hidden');
            
            // Update progress
            updateOneTimeProgress();
            
            // Special handling for summary step
            if (step === 11) {
                populateOneTimeSummary();
            }
        }

        function prevOneTimeStep(step) {
            document.getElementById(`oneTimeStep${currentOneTimeStep}`).classList.add('hidden');
            currentOneTimeStep = step;
            document.getElementById(`oneTimeStep${currentOneTimeStep}`).classList.remove('hidden');
            updateOneTimeProgress();
        }

        function validateCurrentOneTimeStep() {
            let isValid = true;
            let firstErrorField = null;

            switch(currentOneTimeStep) {
                case 1:
                    const nameInput = document.getElementById('oneTimeName');
                    if (!validateField(nameInput, 'name') || !nameInput.value.trim()) {
                        isValid = false;
                        firstErrorField = nameInput;
                    }
                    break;
                case 2:
                    const phoneInput = document.getElementById('oneTimePhone');
                    if (!validateField(phoneInput, 'phone') || !phoneInput.value.trim()) {
                        isValid = false;
                        firstErrorField = phoneInput;
                    }
                    break;
                case 3:
                    const address = document.getElementById('oneTimeAddress').value;
                    if (!address) {
                        showToast('Please select an address', 'error');
                        isValid = false;
                    }
                    break;
                case 4:
                    const car = document.getElementById('oneTimeCar').value;
                    if (!car) {
                        showToast('Please select a car', 'error');
                        isValid = false;
                    }
                    break;
                case 6:
                    const dateInput = document.getElementById('oneTimeDate');
                    if (!validateDateField({ target: dateInput }) || !dateInput.value) {
                        isValid = false;
                        firstErrorField = dateInput;
                    }
                    break;
                case 7:
                    if (!selectedOneTimeSlot) {
                        showToast('Please select a time slot', 'error');
                        isValid = false;
                    }
                    break;
                case 10:
                    const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
                    if (!paymentMethod) {
                        showToast('Please select a payment method', 'error');
                        isValid = false;
                    }
                    if (paymentMethod && paymentMethod.value === 'qr') {
                        showQRModal();
                    }
                    break;
            }

            if (!isValid && firstErrorField) {
                firstErrorField.focus();
                firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                addShakeAnimation(firstErrorField.closest('.form-group') || firstErrorField);
            }

            return isValid;
        }

        function storeOneTimeStepData() {
            switch(currentOneTimeStep) {
                case 1:
                    oneTimeData.name = document.getElementById('oneTimeName').value;
                    break;
                case 2:
                    oneTimeData.phone = document.getElementById('oneTimePhone').value;
                    break;
                case 3:
                    const addressId = document.getElementById('oneTimeAddress').value;
                    const selectedAddress = userAddresses.find(addr => addr.id == addressId);
                    oneTimeData.address = selectedAddress;
                    break;
                case 4:
                    const carId = document.getElementById('oneTimeCar').value;
                    const selectedCar = userCars.find(car => car.id == carId);
                    oneTimeData.car = selectedCar;
                    break;
                case 5:
                    oneTimeData.serviceType = 'Premium Waterless Car Deep Cleaning';
                    oneTimeData.baseAmount = baseAmount;
                    break;
                case 6:
                    oneTimeData.date = document.getElementById('oneTimeDate').value;
                    break;
                case 7:
                    oneTimeData.timeSlot = selectedOneTimeSlot;
                    break;
                case 8:
                    oneTimeData.promoCode = appliedPromo;
                    oneTimeData.finalAmount = finalAmount;
                    break;
                case 10:
                    const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
                    oneTimeData.paymentMethod = paymentMethod ? paymentMethod.value : 'cash';
                    break;
            }
        }

        function updateOneTimeProgress() {
            const progress = (currentOneTimeStep / 12) * 100;
            document.getElementById('oneTimeProgressFill').style.width = progress + '%';
            document.getElementById('oneTimeProgressText').textContent = `Step ${currentOneTimeStep} of 12`;
        }

        function generateOneTimeSlots() {
            const timeSlotsContainer = document.getElementById('oneTimeSlots');
            timeSlotsContainer.innerHTML = '';
            
            const selectedDate = document.getElementById('oneTimeDate').value;
            const today = new Date();
            const isToday = selectedDate === today.toISOString().split('T')[0];
            const currentHour = today.getHours();
            const currentMinute = today.getMinutes();
            
            // Generate slots from 7:00 AM to 7:00 PM (half-hour intervals)
            for (let hour = 7; hour <= 19; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    if (hour === 19 && minute > 0) break; // Stop at 7:00 PM
                    
                    const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const displayTime = formatTime(hour, minute);
                    
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = displayTime;
                    
                    // Disable past time slots if selected date is today
                    const isPastSlot = isToday && (hour < currentHour || (hour === currentHour && minute <= currentMinute));
                    
                    if (isPastSlot) {
                        timeSlot.classList.add('disabled');
                        timeSlot.title = 'This time slot has passed';
                    } else {
                        timeSlot.onclick = () => selectOneTimeSlot(timeString, timeSlot);
                    }
                    
                    timeSlotsContainer.appendChild(timeSlot);
                }
            }
        }

        function selectOneTimeSlot(timeString, element) {
            // Remove previous selection
            document.querySelectorAll('#oneTimeSlots .time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Select current slot
            element.classList.add('selected');
            selectedOneTimeSlot = timeString;
        }

        function applyPromoCode() {
            const promoInput = document.getElementById('oneTimePromo');
            const promoCode = promoInput.value.toLowerCase().trim();
            const promoMessage = document.getElementById('promoMessage');
            
            if (!promoCode) {
                showPromoMessage('Please enter a promo code', 'error');
                addShakeAnimation(promoInput);
                return;
            }
            
            const promoRule = PromoRules[promoCode];
            if (promoRule) {
                appliedPromo = promoCode;
                const discount = Math.round(baseAmount * promoRule.discount);
                finalAmount = baseAmount - discount;
                
                showPromoMessage(`Promo code applied! ${promoRule.description}`, 'success');
                addBounceAnimation(promoMessage);
                
                // Update amount display
                document.getElementById('promoRow').classList.remove('hidden');
                document.getElementById('promoDiscount').textContent = `-₹${discount}`;
                document.getElementById('totalAmount').textContent = `₹${finalAmount}`;
                
                // Add success animation to total amount
                const totalElement = document.getElementById('totalAmount');
                totalElement.style.color = '#2ed573';
                setTimeout(() => {
                    totalElement.style.color = '';
                }, 2000);
            } else {
                showPromoMessage('Invalid promo code', 'error');
                addShakeAnimation(promoInput);
                appliedPromo = null;
                finalAmount = baseAmount;
                
                // Hide promo row
                document.getElementById('promoRow').classList.add('hidden');
                document.getElementById('totalAmount').textContent = `₹${baseAmount}`;
            }
        }

        async function loadRecentBookings(userId) {
            try {
                const response = await fetch(`https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec?action=getRecentBookings&userId=${userId}&limit=2`);
                const result = await response.json();
                
                if (result.success && result.bookings && result.bookings.length > 0) {
                    const recentBookingsSection = document.getElementById('recentBookings');
                    const bookingsList = document.getElementById('recentBookingsList');
                    
                    bookingsList.innerHTML = '';
                    result.bookings.forEach(booking => {
                        const bookingItem = document.createElement('div');
                        bookingItem.className = 'booking-item';
                        
                        const bookingDate = new Date(booking.date).toLocaleDateString('en-IN', {
                            day: 'numeric',
                            month: 'short'
                        });
                        
                        bookingItem.innerHTML = `
                            <div class="booking-date">${bookingDate} • ${booking.timeSlot}</div>
                            <div class="booking-service">${booking.serviceType || booking.planName} - ₹${booking.amount}</div>
                        `;
                        
                        bookingsList.appendChild(bookingItem);
                    });
                    
                    recentBookingsSection.style.display = 'block';
                    addBounceAnimation(recentBookingsSection);
                }
            } catch (error) {
                console.error('Error loading recent bookings:', error);
            }
        }

        function showPromoMessage(message, type) {
            const promoMessage = document.getElementById('promoMessage');
            promoMessage.textContent = message;
            promoMessage.className = `promo-message ${type}`;
            promoMessage.classList.remove('hidden');
            
            setTimeout(() => {
                promoMessage.classList.add('hidden');
            }, 3000);
        }

        function showQRModal() {
            document.getElementById('qrModal').classList.add('show');
        }

        function closeQRModal() {
            document.getElementById('qrModal').classList.remove('show');
        }

        function populateOneTimeSummary() {
            const summaryContent = document.getElementById('oneTimeSummary');
            const formattedDate = new Date(oneTimeData.date).toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const [hour, minute] = oneTimeData.timeSlot.split(':');
            const displayTime = formatTime(parseInt(hour), parseInt(minute));
            
            const paymentMethodText = {
                'cash': 'Cash (Pay after service)',
                'qr': 'UPI/Digital Payment',
                'card': 'Credit/Debit Card'
            };
            
            let promoSection = '';
            if (oneTimeData.promoCode) {
                promoSection = `
                    <div class="summary-item">
                        <h4>Promo Code Applied</h4>
                        <p>${oneTimeData.promoCode.toUpperCase()} - 25% discount</p>
                    </div>
                `;
            }
            
            summaryContent.innerHTML = `
                <div class="summary-item">
                    <h4>Customer</h4>
                    <p>${oneTimeData.name}</p>
                </div>
                <div class="summary-item">
                    <h4>Phone</h4>
                    <p>${oneTimeData.phone}</p>
                </div>
                <div class="summary-item">
                    <h4>Address</h4>
                    <p>${oneTimeData.address.nickname} - ${oneTimeData.address.plot}, ${oneTimeData.address.street}, ${oneTimeData.address.area}, Trichy</p>
                </div>
                <div class="summary-item">
                    <h4>Car</h4>
                    <p>${oneTimeData.car.nickname} (${oneTimeData.car.brand} ${oneTimeData.car.model}) - ${oneTimeData.car.type}</p>
                </div>
                <div class="summary-item">
                    <h4>Service</h4>
                    <p>${oneTimeData.serviceType}</p>
                </div>
                <div class="summary-item">
                    <h4>Date & Time</h4>
                    <p>${formattedDate} at ${displayTime}</p>
                </div>
                ${promoSection}
                <div class="summary-item">
                    <h4>Final Amount</h4>
                    <p><strong>₹${oneTimeData.finalAmount}</strong></p>
                </div>
                <div class="summary-item">
                    <h4>Payment Method</h4>
                    <p>${paymentMethodText[oneTimeData.paymentMethod]}</p>
                </div>
            `;
        }

        async function confirmOneTimeBooking() {
            const confirmBtn = document.getElementById('confirmOneTimeBtn');
            confirmBtn.disabled = true;

            try {
                const bookingData = {
                    action: 'submitBooking',
                    name: oneTimeData.name,
                    phone: oneTimeData.phone,
                    addressNickname: oneTimeData.address.nickname,
                    fullAddress: `${oneTimeData.address.plot}, ${oneTimeData.address.street}, ${oneTimeData.address.area}, ${oneTimeData.address.landmark}, Trichy - ${oneTimeData.address.pincode}`,
                    carNickname: oneTimeData.car.nickname,
                    carType: oneTimeData.car.type,
                    carBrand: oneTimeData.car.brand,
                    carModel: oneTimeData.car.model,
                    plateNumber: oneTimeData.car.plateNumber,
                    serviceType: oneTimeData.serviceType,
                    baseAmount: oneTimeData.baseAmount,
                    promoCode: oneTimeData.promoCode || '',
                    finalAmount: oneTimeData.finalAmount,
                    date: oneTimeData.date,
                    timeSlot: oneTimeData.timeSlot,
                    paymentMethod: oneTimeData.paymentMethod
                };

                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Booking confirmed!', 'success');
                    
                    // Redirect to WhatsApp after 2 seconds
                    setTimeout(() => {
                        const formattedDate = new Date(oneTimeData.date).toLocaleDateString('en-IN', {
                            day: 'numeric',
                            month: 'short'
                        });
                        
                        const [hour, minute] = oneTimeData.timeSlot.split(':');
                        const displayTime = formatTime(parseInt(hour), parseInt(minute));
                        
                        let promoText = '';
                        if (oneTimeData.promoCode) {
                            promoText = `\n- Promo Code: ${oneTimeData.promoCode}`;
                        }
                        
                        const whatsappMessage = `Hi Clenzzo, I'd like to confirm my booking:
- Name: ${oneTimeData.name}
- Phone: ${oneTimeData.phone}
- Car: ${oneTimeData.car.nickname} (${oneTimeData.car.brand} ${oneTimeData.car.model}) – ${oneTimeData.car.type}
- Address: ${oneTimeData.address.nickname} – Trichy
- Service: ${oneTimeData.serviceType} – ₹${oneTimeData.baseAmount}
- Date: ${formattedDate}
- Time: ${displayTime}${promoText}
- Final Price: ₹${oneTimeData.finalAmount}
- Payment: ${oneTimeData.paymentMethod === 'cash' ? 'Cash' : oneTimeData.paymentMethod === 'qr' ? 'UPI' : 'Card'}`;
                        
                        const whatsappUrl = `https://wa.me/918122213141?text=${encodeURIComponent(whatsappMessage)}`;
                        window.open(whatsappUrl, '_blank');
                        
                        // Return to home screen
                        showScreen('homeScreen');
                    }, 2000);
                } else {
                    showToast(result.message || 'Booking failed', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }

            confirmBtn.disabled = false;
        }

        function showAddNewAddressOneTime() {
            document.getElementById('addAddressModal').classList.add('show');
        }

        function showAddNewCarOneTime() {
            document.getElementById('addCarModal').classList.add('show');
            
            // Setup car type change handler for modal
            document.getElementById('newCarType').addEventListener('change', updateNewCarBrands);
            document.getElementById('newCarBrand').addEventListener('change', updateNewCarModels);
        }

        function startSubscriptionBooking() {
            const session = JSON.parse(localStorage.getItem('clenzzoSession'));
            if (session) {
                // Pre-fill name and phone from session
                document.getElementById('subscriptionName').value = session.name;
                document.getElementById('subscriptionPhone').value = session.phone || '';
                
                // Load user's saved addresses and cars
                loadUserDataSubscription(session.userId);
                
                // Reset subscription data
                subscriptionData = {};
                currentSubscriptionStep = 1;
                selectedSubscriptionSlot = null;
                selectedPlan = null;
                appliedSubscriptionPromo = null;
                subscriptionBaseAmount = 0;
                subscriptionFinalAmount = 0;
                
                // Show subscription booking screen
                showScreen('subscriptionBookingScreen');
                updateSubscriptionProgress();
                
                // Set minimum date to October 1st
                const dateInput = document.getElementById('subscriptionDate');
                const today = new Date();
                const minDate = new Date(today.getFullYear(), 9, 1); // October 1st
                dateInput.min = minDate.toISOString().split('T')[0];
                
                // Generate time slots
                generateSubscriptionSlots();
            }
        }

        async function loadUserDataSubscription(userId) {
            try {
                const response = await fetch(`https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec?action=getUserData&userId=${userId}`);
                const result = await response.json();
                
                if (result.success) {
                    userAddresses = result.addresses || [];
                    userCars = result.cars || [];
                    
                    // Populate address dropdown
                    const addressSelect = document.getElementById('subscriptionAddress');
                    addressSelect.innerHTML = '<option value="">Select saved address</option>';
                    userAddresses.forEach(address => {
                        addressSelect.innerHTML += `<option value="${address.id}">${address.nickname}</option>`;
                    });
                    
                    // Populate car dropdown
                    const carSelect = document.getElementById('subscriptionCar');
                    carSelect.innerHTML = '<option value="">Select saved car</option>';
                    userCars.forEach(car => {
                        carSelect.innerHTML += `<option value="${car.id}">${car.nickname}</option>`;
                    });
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function nextSubscriptionStep(step) {
            if (!validateCurrentSubscriptionStep()) return;
            
            // Store current step data
            storeSubscriptionStepData();
            
            // Hide current step
            document.getElementById(`subscriptionStep${currentSubscriptionStep}`).classList.add('hidden');
            
            // Show next step
            currentSubscriptionStep = step;
            document.getElementById(`subscriptionStep${currentSubscriptionStep}`).classList.remove('hidden');
            
            // Update progress
            updateSubscriptionProgress();
            
            // Special handling for amount and summary steps
            if (step === 9) {
                updateSubscriptionAmountDisplay();
            } else if (step === 11) {
                populateSubscriptionSummary();
            }
        }

        function prevSubscriptionStep(step) {
            document.getElementById(`subscriptionStep${currentSubscriptionStep}`).classList.add('hidden');
            currentSubscriptionStep = step;
            document.getElementById(`subscriptionStep${currentSubscriptionStep}`).classList.remove('hidden');
            updateSubscriptionProgress();
        }

        function validateCurrentSubscriptionStep() {
            let isValid = true;
            let firstErrorField = null;

            switch(currentSubscriptionStep) {
                case 1:
                    const nameInput = document.getElementById('subscriptionName');
                    if (!validateField(nameInput, 'name') || !nameInput.value.trim()) {
                        isValid = false;
                        firstErrorField = nameInput;
                    }
                    break;
                case 2:
                    const phoneInput = document.getElementById('subscriptionPhone');
                    if (!validateField(phoneInput, 'phone') || !phoneInput.value.trim()) {
                        isValid = false;
                        firstErrorField = phoneInput;
                    }
                    break;
                case 3:
                    const address = document.getElementById('subscriptionAddress').value;
                    if (!address) {
                        showToast('Please select an address', 'error');
                        isValid = false;
                    }
                    break;
                case 4:
                    const car = document.getElementById('subscriptionCar').value;
                    if (!car) {
                        showToast('Please select a car', 'error');
                        isValid = false;
                    }
                    break;
                case 5:
                    if (!selectedPlan) {
                        showToast('Please select a subscription plan', 'error');
                        isValid = false;
                    }
                    break;
                case 6:
                    const dateInput = document.getElementById('subscriptionDate');
                    if (!validateDateField({ target: dateInput }) || !dateInput.value) {
                        isValid = false;
                        firstErrorField = dateInput;
                    }
                    break;
                case 7:
                    if (!selectedSubscriptionSlot) {
                        showToast('Please select a preferred time slot', 'error');
                        isValid = false;
                    }
                    break;
                case 10:
                    const paymentMethod = document.querySelector('input[name="subscriptionPaymentMethod"]:checked');
                    if (!paymentMethod) {
                        showToast('Please select a payment method', 'error');
                        isValid = false;
                    }
                    if (paymentMethod && paymentMethod.value === 'qr') {
                        showQRModal();
                    }
                    break;
            }

            if (!isValid && firstErrorField) {
                firstErrorField.focus();
                firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                addShakeAnimation(firstErrorField.closest('.form-group') || firstErrorField);
            }

            return isValid;
        }

        function storeSubscriptionStepData() {
            switch(currentSubscriptionStep) {
                case 1:
                    subscriptionData.name = document.getElementById('subscriptionName').value;
                    break;
                case 2:
                    subscriptionData.phone = document.getElementById('subscriptionPhone').value;
                    break;
                case 3:
                    const addressId = document.getElementById('subscriptionAddress').value;
                    const selectedAddress = userAddresses.find(addr => addr.id == addressId);
                    subscriptionData.address = selectedAddress;
                    break;
                case 4:
                    const carId = document.getElementById('subscriptionCar').value;
                    const selectedCar = userCars.find(car => car.id == carId);
                    subscriptionData.car = selectedCar;
                    break;
                case 5:
                    subscriptionData.plan = selectedPlan;
                    subscriptionData.baseAmount = subscriptionBaseAmount;
                    break;
                case 6:
                    subscriptionData.startDate = document.getElementById('subscriptionDate').value;
                    break;
                case 7:
                    subscriptionData.timeSlot = selectedSubscriptionSlot;
                    break;
                case 8:
                    subscriptionData.promoCode = appliedSubscriptionPromo;
                    subscriptionData.finalAmount = subscriptionFinalAmount;
                    break;
                case 10:
                    const paymentMethod = document.querySelector('input[name="subscriptionPaymentMethod"]:checked');
                    subscriptionData.paymentMethod = paymentMethod ? paymentMethod.value : 'cash';
                    break;
            }
        }

        function updateSubscriptionProgress() {
            const progress = (currentSubscriptionStep / 12) * 100;
            document.getElementById('subscriptionProgressFill').style.width = progress + '%';
            document.getElementById('subscriptionProgressText').textContent = `Step ${currentSubscriptionStep} of 12`;
        }

        function generateSubscriptionSlots() {
            const timeSlotsContainer = document.getElementById('subscriptionSlots');
            timeSlotsContainer.innerHTML = '';
            
            // Generate slots from 5:00 AM to 11:00 AM (1-hour intervals)
            for (let hour = 5; hour <= 10; hour++) {
                const startTime = `${hour.toString().padStart(2, '0')}:00`;
                const endTime = `${(hour + 1).toString().padStart(2, '0')}:00`;
                const timeString = `${startTime}-${endTime}`;
                const displayTime = formatSubscriptionTime(hour);
                
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = displayTime;
                timeSlot.onclick = () => selectSubscriptionSlot(timeString, timeSlot);
                
                timeSlotsContainer.appendChild(timeSlot);
            }
        }

        function formatSubscriptionTime(hour) {
            const startPeriod = hour >= 12 ? 'PM' : 'AM';
            const endPeriod = (hour + 1) >= 12 ? 'PM' : 'AM';
            const startDisplayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
            const endDisplayHour = (hour + 1) > 12 ? (hour + 1) - 12 : ((hour + 1) === 0 ? 12 : (hour + 1));
            return `${startDisplayHour}–${endDisplayHour} ${endPeriod}`;
        }

        function selectSubscriptionSlot(timeString, element) {
            // Remove previous selection
            document.querySelectorAll('#subscriptionSlots .time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Select current slot
            element.classList.add('selected');
            selectedSubscriptionSlot = timeString;
        }

        function selectPlan(planId, amount, element) {
            // Remove previous selection
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select current plan
            element.classList.add('selected');
            selectedPlan = {
                id: planId,
                amount: amount,
                name: element.querySelector('h3').textContent
            };
            subscriptionBaseAmount = amount;
            subscriptionFinalAmount = amount;
        }

        function applySubscriptionPromoCode() {
            const promoCode = document.getElementById('subscriptionPromo').value.toLowerCase().trim();
            const promoMessage = document.getElementById('subscriptionPromoMessage');
            
            if (!promoCode) {
                showSubscriptionPromoMessage('Please enter a promo code', 'error');
                return;
            }
            
            if (promoCode === 'launch25') {
                appliedSubscriptionPromo = promoCode;
                const discount = Math.round(subscriptionBaseAmount * 0.25);
                subscriptionFinalAmount = subscriptionBaseAmount - discount;
                
                showSubscriptionPromoMessage('Promo code applied! 25% discount', 'success');
                
                // Update amount display if on amount step
                if (currentSubscriptionStep === 9) {
                    updateSubscriptionAmountDisplay();
                }
            } else {
                showSubscriptionPromoMessage('Invalid promo code', 'error');
                appliedSubscriptionPromo = null;
                subscriptionFinalAmount = subscriptionBaseAmount;
                
                // Update amount display if on amount step
                if (currentSubscriptionStep === 9) {
                    updateSubscriptionAmountDisplay();
                }
            }
        }

        function showSubscriptionPromoMessage(message, type) {
            const promoMessage = document.getElementById('subscriptionPromoMessage');
            promoMessage.textContent = message;
            promoMessage.className = `promo-message ${type}`;
            promoMessage.classList.remove('hidden');
            
            setTimeout(() => {
                promoMessage.classList.add('hidden');
            }, 3000);
        }

        function updateSubscriptionAmountDisplay() {
            document.getElementById('subscriptionPlanText').textContent = `${selectedPlan.name} Plan:`;
            document.getElementById('subscriptionPlanAmount').textContent = `₹${subscriptionBaseAmount.toLocaleString()}`;
            
            if (appliedSubscriptionPromo) {
                const discount = subscriptionBaseAmount - subscriptionFinalAmount;
                document.getElementById('subscriptionPromoRow').classList.remove('hidden');
                document.getElementById('subscriptionPromoDiscount').textContent = `-₹${discount.toLocaleString()}`;
            } else {
                document.getElementById('subscriptionPromoRow').classList.add('hidden');
            }
            
            document.getElementById('subscriptionTotalAmount').textContent = `₹${subscriptionFinalAmount.toLocaleString()}`;
        }

        function populateSubscriptionSummary() {
            const summaryContent = document.getElementById('subscriptionSummary');
            const formattedDate = new Date(subscriptionData.startDate).toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const paymentMethodText = {
                'cash': 'Cash (Monthly after service)',
                'qr': 'UPI/Digital Payment',
                'card': 'Credit/Debit Card'
            };
            
            let promoSection = '';
            if (subscriptionData.promoCode) {
                promoSection = `
                    <div class="summary-item">
                        <h4>Promo Code Applied</h4>
                        <p>${subscriptionData.promoCode.toUpperCase()} - 25% discount</p>
                    </div>
                `;
            }
            
            summaryContent.innerHTML = `
                <div class="summary-item">
                    <h4>Customer</h4>
                    <p>${subscriptionData.name}</p>
                </div>
                <div class="summary-item">
                    <h4>Phone</h4>
                    <p>${subscriptionData.phone}</p>
                </div>
                <div class="summary-item">
                    <h4>Address</h4>
                    <p>${subscriptionData.address.nickname} - ${subscriptionData.address.plot}, ${subscriptionData.address.street}, ${subscriptionData.address.area}, Trichy</p>
                </div>
                <div class="summary-item">
                    <h4>Car</h4>
                    <p>${subscriptionData.car.nickname} (${subscriptionData.car.brand} ${subscriptionData.car.model}) - ${subscriptionData.car.type}</p>
                </div>
                <div class="summary-item">
                    <h4>Selected Plan</h4>
                    <p>${subscriptionData.plan.name} - ₹${subscriptionData.baseAmount.toLocaleString()}</p>
                </div>
                <div class="summary-item">
                    <h4>Start Date</h4>
                    <p>${formattedDate}</p>
                </div>
                <div class="summary-item">
                    <h4>Preferred Time Slot</h4>
                    <p>${subscriptionData.timeSlot}</p>
                </div>
                ${promoSection}
                <div class="summary-item">
                    <h4>Final Amount</h4>
                    <p><strong>₹${subscriptionData.finalAmount.toLocaleString()}</strong></p>
                </div>
                <div class="summary-item">
                    <h4>Payment Method</h4>
                    <p>${paymentMethodText[subscriptionData.paymentMethod]}</p>
                </div>
            `;
        }

        async function confirmSubscriptionBooking() {
            const confirmBtn = document.getElementById('confirmSubscriptionBtn');
            confirmBtn.disabled = true;

            try {
                const bookingData = {
                    action: 'submitSubscription',
                    name: subscriptionData.name,
                    phone: subscriptionData.phone,
                    addressNickname: subscriptionData.address.nickname,
                    fullAddress: `${subscriptionData.address.plot}, ${subscriptionData.address.street}, ${subscriptionData.address.area}, ${subscriptionData.address.landmark}, Trichy - ${subscriptionData.address.pincode}`,
                    carNickname: subscriptionData.car.nickname,
                    carType: subscriptionData.car.type,
                    carBrand: subscriptionData.car.brand,
                    carModel: subscriptionData.car.model,
                    plateNumber: subscriptionData.car.plateNumber,
                    planName: subscriptionData.plan.name,
                    planAmount: subscriptionData.baseAmount,
                    promoCode: subscriptionData.promoCode || '',
                    finalAmount: subscriptionData.finalAmount,
                    startDate: subscriptionData.startDate,
                    timeSlot: subscriptionData.timeSlot,
                    paymentMethod: subscriptionData.paymentMethod
                };

                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Subscription confirmed!', 'success');
                    
                    // Redirect to WhatsApp after 2 seconds
                    setTimeout(() => {
                        const formattedDate = new Date(subscriptionData.startDate).toLocaleDateString('en-IN', {
                            day: 'numeric',
                            month: 'short'
                        });
                        
                        let promoText = '';
                        if (subscriptionData.promoCode) {
                            promoText = `\n- Promo Code: ${subscriptionData.promoCode}`;
                        }
                        
                        const whatsappMessage = `Hi Clenzzo, I'd like to confirm my subscription:
- Name: ${subscriptionData.name}
- Phone: ${subscriptionData.phone}
- Car: ${subscriptionData.car.nickname} (${subscriptionData.car.brand} ${subscriptionData.car.model}) – ${subscriptionData.car.type}
- Address: ${subscriptionData.address.nickname} – Trichy
- Plan: ${subscriptionData.plan.name} – ₹${subscriptionData.baseAmount.toLocaleString()}
- Start Date: ${formattedDate}
- Time Slot: ${subscriptionData.timeSlot}${promoText}
- Final Price: ₹${subscriptionData.finalAmount.toLocaleString()}
- Payment: ${subscriptionData.paymentMethod === 'cash' ? 'Cash' : subscriptionData.paymentMethod === 'qr' ? 'QR' : 'Card'}`;
                        
                        const whatsappUrl = `https://wa.me/918122213141?text=${encodeURIComponent(whatsappMessage)}`;
                        window.open(whatsappUrl, '_blank');
                        
                        // Return to home screen
                        showScreen('homeScreen');
                    }, 2000);
                } else {
                    showToast(result.message || 'Subscription failed', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }

            confirmBtn.disabled = false;
        }

        function showAddNewAddressSubscription() {
            document.getElementById('addAddressModal').classList.add('show');
        }

        function showAddNewCarSubscription() {
            document.getElementById('addCarModal').classList.add('show');
            
            // Setup car type change handler for modal
            document.getElementById('newCarType').addEventListener('change', updateNewCarBrands);
            document.getElementById('newCarBrand').addEventListener('change', updateNewCarModels);
        }

        function logout() {
            localStorage.removeItem('clenzzoSession');
            showScreen('loginScreen');
            showToast('Logged out successfully', 'success');
        }

        // Profile Page Functions
        let profileUserCars = [];
        let profileUserAddresses = [];
        let currentEditingCar = null;
        let currentEditingAddress = null;

        function showProfile() {
            const session = JSON.parse(localStorage.getItem('clenzzoSession'));
            if (session) {
                // Set greeting and basic info
                document.getElementById('profileGreeting').textContent = `Hello, ${session.name} 👋`;
                document.getElementById('profileName').textContent = session.name;
                document.getElementById('profilePhone').textContent = session.phone || 'Not provided';
                
                // Load user data
                loadProfileData(session.userId);
                
                showScreen('profileScreen');
            }
        }

        async function loadProfileData(userId) {
            try {
                const response = await fetch(`https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec?action=getProfileData&userId=${userId}`);
                const result = await response.json();
                
                if (result.success) {
                    profileUserCars = result.cars || [];
                    profileUserAddresses = result.addresses || [];
                    
                    // Update bookings count if available
                    if (result.bookingsCount !== undefined) {
                        document.getElementById('profileBookings').textContent = result.bookingsCount;
                    }
                    
                    // Populate cars and addresses
                    populateCarsList();
                    populateAddressesList();
                } else {
                    showToast('Error loading profile data', 'error');
                }
            } catch (error) {
                console.error('Error loading profile data:', error);
                showToast('Connection error', 'error');
                
                // Show empty states
                populateCarsList();
                populateAddressesList();
            }
        }

        function populateCarsList() {
            const carsList = document.getElementById('carsList');
            
            if (profileUserCars.length === 0) {
                carsList.innerHTML = `
                    <div class="empty-state">
                        <h4>No cars saved yet</h4>
                        <p>Add your first car to get started with bookings</p>
                    </div>
                `;
                return;
            }
            
            carsList.innerHTML = '';
            profileUserCars.forEach(car => {
                const carCard = document.createElement('div');
                carCard.className = 'item-card';
                carCard.innerHTML = `
                    <div class="item-header">
                        <h4 class="item-title">🚗 ${car.nickname}</h4>
                        <div class="item-actions">
                            <button class="action-btn edit" onclick="editCar(${car.id})">✏️</button>
                            <button class="action-btn delete" onclick="deleteCar(${car.id})">🗑️</button>
                        </div>
                    </div>
                    <div class="item-details">
                        ${car.brand} ${car.model} (${car.type})
                    </div>
                    <div class="item-meta">
                        Plate: ${car.plateNumber}
                    </div>
                `;
                carsList.appendChild(carCard);
            });
        }

        function populateAddressesList() {
            const addressesList = document.getElementById('addressesList');
            
            if (profileUserAddresses.length === 0) {
                addressesList.innerHTML = `
                    <div class="empty-state">
                        <h4>No addresses saved yet</h4>
                        <p>Add your first address to get started with bookings</p>
                    </div>
                `;
                return;
            }
            
            addressesList.innerHTML = '';
            profileUserAddresses.forEach(address => {
                const addressCard = document.createElement('div');
                addressCard.className = 'item-card';
                addressCard.innerHTML = `
                    <div class="item-header">
                        <h4 class="item-title">🏠 ${address.nickname}</h4>
                        <div class="item-actions">
                            <button class="action-btn edit" onclick="editAddress(${address.id})">✏️</button>
                            <button class="action-btn delete" onclick="deleteAddress(${address.id})">🗑️</button>
                        </div>
                    </div>
                    <div class="item-details">
                        ${address.plot}, ${address.street}, ${address.area}
                    </div>
                    <div class="item-meta">
                        ${address.landmark}, Trichy - ${address.pincode}
                    </div>
                `;
                addressesList.appendChild(addressCard);
            });
        }

        // Add Car Form Functions
        function showAddCarForm() {
            document.getElementById('addCarFormModal').classList.add('show');
            
            // Setup car type change handler
            document.getElementById('profileCarType').addEventListener('change', updateProfileCarBrands);
            document.getElementById('profileCarBrand').addEventListener('change', updateProfileCarModels);
            
            // Clear form
            document.querySelectorAll('#addCarFormModal input, #addCarFormModal select').forEach(field => {
                if (!field.disabled) field.value = '';
            });
            document.getElementById('profileCarBrand').disabled = true;
            document.getElementById('profileCarModel').disabled = true;
        }

        function closeAddCarForm() {
            document.getElementById('addCarFormModal').classList.remove('show');
        }

        function updateProfileCarBrands() {
            const carType = document.getElementById('profileCarType').value;
            const brandSelect = document.getElementById('profileCarBrand');
            const modelSelect = document.getElementById('profileCarModel');
            
            brandSelect.innerHTML = '<option value="">Select car brand</option>';
            modelSelect.innerHTML = '<option value="">Select car model</option>';
            modelSelect.disabled = true;
            
            if (carType && carData[carType]) {
                Object.keys(carData[carType]).forEach(brand => {
                    brandSelect.innerHTML += `<option value="${brand}">${brand}</option>`;
                });
                brandSelect.disabled = false;
            } else {
                brandSelect.disabled = true;
            }
        }

        function updateProfileCarModels() {
            const carType = document.getElementById('profileCarType').value;
            const carBrand = document.getElementById('profileCarBrand').value;
            const modelSelect = document.getElementById('profileCarModel');
            
            modelSelect.innerHTML = '<option value="">Select car model</option>';
            
            if (carType && carBrand && carData[carType][carBrand]) {
                carData[carType][carBrand].forEach(model => {
                    modelSelect.innerHTML += `<option value="${model}">${model}</option>`;
                });
                modelSelect.disabled = false;
            } else {
                modelSelect.disabled = true;
            }
        }

        async function saveProfileCar() {
            const nickname = document.getElementById('profileCarNickname').value;
            const type = document.getElementById('profileCarType').value;
            const brand = document.getElementById('profileCarBrand').value;
            const model = document.getElementById('profileCarModel').value;
            const plateNumber = document.getElementById('profilePlateNumber').value;

            if (!nickname || !type || !brand || !model || !plateNumber) {
                showToast('Please fill all car details', 'error');
                return;
            }

            try {
                const session = JSON.parse(localStorage.getItem('clenzzoSession'));
                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addCar',
                        userId: session.userId,
                        carData: {
                            nickname,
                            type,
                            brand,
                            model,
                            plateNumber: plateNumber.toUpperCase()
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Car added successfully!', 'success');
                    closeAddCarForm();
                    
                    // Add to local array and refresh display
                    const newCar = {
                        id: result.carId || Date.now(),
                        nickname,
                        type,
                        brand,
                        model,
                        plateNumber: plateNumber.toUpperCase()
                    };
                    profileUserCars.push(newCar);
                    populateCarsList();
                } else {
                    showToast(result.message || 'Failed to add car', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }
        }

        // Add Address Form Functions
        function showAddAddressForm() {
            document.getElementById('addAddressFormModal').classList.add('show');
            
            // Clear form
            document.querySelectorAll('#addAddressFormModal input:not([disabled])').forEach(field => {
                field.value = '';
            });
        }

        function closeAddAddressForm() {
            document.getElementById('addAddressFormModal').classList.remove('show');
        }

        async function saveProfileAddress() {
            const nickname = document.getElementById('profileAddressNickname').value;
            const plot = document.getElementById('profilePlot').value;
            const street = document.getElementById('profileStreet').value;
            const area = document.getElementById('profileArea').value;
            const landmark = document.getElementById('profileLandmark').value;
            const pincode = document.getElementById('profilePincode').value;

            if (!nickname || !plot || !street || !area || !landmark || !pincode) {
                showToast('Please fill all address fields', 'error');
                return;
            }

            if (!pincode.startsWith('62') || pincode.length !== 6) {
                showToast('Pincode must start with 62 and be 6 digits', 'error');
                return;
            }

            try {
                const session = JSON.parse(localStorage.getItem('clenzzoSession'));
                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addAddress',
                        userId: session.userId,
                        addressData: {
                            nickname,
                            plot,
                            street,
                            area,
                            landmark,
                            pincode,
                            city: 'Trichy'
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Address added successfully!', 'success');
                    closeAddAddressForm();
                    
                    // Add to local array and refresh display
                    const newAddress = {
                        id: result.addressId || Date.now(),
                        nickname,
                        plot,
                        street,
                        area,
                        landmark,
                        pincode,
                        city: 'Trichy'
                    };
                    profileUserAddresses.push(newAddress);
                    populateAddressesList();
                } else {
                    showToast(result.message || 'Failed to add address', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }
        }

        // Edit Car Functions
        function editCar(carId) {
            const car = profileUserCars.find(c => c.id == carId);
            if (!car) return;
            
            currentEditingCar = car;
            
            // Populate edit form
            document.getElementById('editCarNickname').value = car.nickname;
            document.getElementById('editPlateNumber').value = car.plateNumber;
            
            document.getElementById('editCarFormModal').classList.add('show');
        }

        function closeEditCarForm() {
            document.getElementById('editCarFormModal').classList.remove('show');
            currentEditingCar = null;
        }

        async function updateProfileCar() {
            if (!currentEditingCar) return;
            
            const nickname = document.getElementById('editCarNickname').value;
            const plateNumber = document.getElementById('editPlateNumber').value;

            if (!nickname || !plateNumber) {
                showToast('Please fill all fields', 'error');
                return;
            }

            try {
                const session = JSON.parse(localStorage.getItem('clenzzoSession'));
                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateCar',
                        userId: session.userId,
                        carId: currentEditingCar.id,
                        carData: {
                            nickname,
                            plateNumber: plateNumber.toUpperCase()
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Car updated successfully!', 'success');
                    closeEditCarForm();
                    
                    // Update local array and refresh display
                    const carIndex = profileUserCars.findIndex(c => c.id == currentEditingCar.id);
                    if (carIndex !== -1) {
                        profileUserCars[carIndex].nickname = nickname;
                        profileUserCars[carIndex].plateNumber = plateNumber.toUpperCase();
                        populateCarsList();
                    }
                } else {
                    showToast(result.message || 'Failed to update car', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }
        }

        // Edit Address Functions
        function editAddress(addressId) {
            const address = profileUserAddresses.find(a => a.id == addressId);
            if (!address) return;
            
            currentEditingAddress = address;
            
            // Populate edit form
            document.getElementById('editAddressNickname').value = address.nickname;
            document.getElementById('editPlot').value = address.plot;
            document.getElementById('editStreet').value = address.street;
            document.getElementById('editArea').value = address.area;
            document.getElementById('editLandmark').value = address.landmark;
            document.getElementById('editPincode').value = address.pincode;
            
            document.getElementById('editAddressFormModal').classList.add('show');
        }

        function closeEditAddressForm() {
            document.getElementById('editAddressFormModal').classList.remove('show');
            currentEditingAddress = null;
        }

        async function updateProfileAddress() {
            if (!currentEditingAddress) return;
            
            const nickname = document.getElementById('editAddressNickname').value;
            const plot = document.getElementById('editPlot').value;
            const street = document.getElementById('editStreet').value;
            const area = document.getElementById('editArea').value;
            const landmark = document.getElementById('editLandmark').value;
            const pincode = document.getElementById('editPincode').value;

            if (!nickname || !plot || !street || !area || !landmark || !pincode) {
                showToast('Please fill all address fields', 'error');
                return;
            }

            if (!pincode.startsWith('62') || pincode.length !== 6) {
                showToast('Pincode must start with 62 and be 6 digits', 'error');
                return;
            }

            try {
                const session = JSON.parse(localStorage.getItem('clenzzoSession'));
                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateAddress',
                        userId: session.userId,
                        addressId: currentEditingAddress.id,
                        addressData: {
                            nickname,
                            plot,
                            street,
                            area,
                            landmark,
                            pincode,
                            city: 'Trichy'
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Address updated successfully!', 'success');
                    closeEditAddressForm();
                    
                    // Update local array and refresh display
                    const addressIndex = profileUserAddresses.findIndex(a => a.id == currentEditingAddress.id);
                    if (addressIndex !== -1) {
                        profileUserAddresses[addressIndex] = {
                            ...profileUserAddresses[addressIndex],
                            nickname,
                            plot,
                            street,
                            area,
                            landmark,
                            pincode
                        };
                        populateAddressesList();
                    }
                } else {
                    showToast(result.message || 'Failed to update address', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }
        }

        // Delete Functions
        async function deleteCar(carId) {
            if (!confirm('Are you sure you want to delete this car?')) return;
            
            try {
                const session = JSON.parse(localStorage.getItem('clenzzoSession'));
                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'deleteCar',
                        userId: session.userId,
                        carId: carId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Car deleted successfully!', 'success');
                    
                    // Remove from local array and refresh display
                    profileUserCars = profileUserCars.filter(c => c.id != carId);
                    populateCarsList();
                } else {
                    showToast(result.message || 'Failed to delete car', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }
        }

        async function deleteAddress(addressId) {
            if (!confirm('Are you sure you want to delete this address?')) return;
            
            try {
                const session = JSON.parse(localStorage.getItem('clenzzoSession'));
                const response = await fetch('https://script.google.com/macros/s/AKfycbwlbQFYvhGUW7U8-u0vNAXewlYa6x6lCNtH0MlpoxE-m2_Xehf78-7esi1gBtqxV940/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'deleteAddress',
                        userId: session.userId,
                        addressId: addressId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Address deleted successfully!', 'success');
                    
                    // Remove from local array and refresh display
                    profileUserAddresses = profileUserAddresses.filter(a => a.id != addressId);
                    populateAddressesList();
                } else {
                    showToast(result.message || 'Failed to delete address', 'error');
                }
            } catch (error) {
                showToast('Connection error. Please try again.', 'error');
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e7d41262be7ea3',t:'MTc1Nzc2ODQzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
