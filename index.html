<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clenzzo - Premium Car Cleaning Service</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'montserrat': ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        'teal': '#00A89C',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-montserrat min-h-screen">
    <!-- Configuration Notice -->
    <div id="configNotice" class="bg-green-50 border-l-4 border-green-400 p-4 mb-4">
        <div class="max-w-md mx-auto">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-green-700">
                        <strong>‚úÖ Google Sheets Connected!</strong> Your app is now fully configured and ready to save data to the cloud.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="hidden min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow-sm p-4">
            <div class="max-w-md mx-auto flex items-center justify-between">
                <div class="flex items-center">
                    <img src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=375,fit=crop,q=95/dOqZx0gxjnC3l2xQ/blasset-6-2x-8-AMqDPMxZ9qUpzDpa.png" alt="Clenzzo Logo" class="h-6 w-auto object-contain" onerror="this.src=''; this.alt='Logo failed to load'; this.style.display='none';">
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="showProfile()" class="p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </button>
                    <button onclick="logout()" class="text-teal font-medium text-sm">Logout</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-md mx-auto p-4">
            <!-- User Info Section -->
            <div class="bg-gradient-to-r from-teal to-blue-500 rounded-2xl p-6 mb-6 text-white">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-xl font-bold mb-1" id="userGreeting">Hello, User!</h2>
                        <p class="text-blue-100 text-sm">Ready for your next car cleaning?</p>
                    </div>
                    <div class="text-right text-sm">
                        <div class="bg-white bg-opacity-20 rounded-lg p-3">
                            <div class="text-xs text-blue-100 mb-1">Default Car</div>
                            <div class="font-medium" id="defaultCarDisplay">Not set</div>
                            <div class="text-xs text-blue-100 mt-2 mb-1">Default Address</div>
                            <div class="font-medium text-xs" id="defaultAddressDisplay">Not set</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hero Section -->
            <div class="text-center mb-8">
                
                <!-- Service Cards -->
                <div class="space-y-4">
                    <!-- Trial Card -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 cursor-pointer hover:shadow-xl transition-all border-2 border-orange-200" onclick="startTrial()">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-left">
                                <h3 class="font-bold text-xl text-gray-800">Book Your Trial</h3>
                                <p class="text-gray-600">Daily car exterior cleaning for 5 days at your doorstep in 15 mins</p>
                            </div>
                            <div class="text-right">
                                <div class="text-lg text-gray-400 line-through">‚Çπ420</div>
                                <div class="text-2xl font-bold text-orange-500">‚Çπ100</div>
                                <div class="text-sm text-gray-500">for 7 days</div>
                            </div>
                        </div>
                        <div class="bg-orange-50 text-orange-700 text-center py-3 rounded-xl font-medium">
                            Try Now ‚Üí
                        </div>
                    </div>

                    <!-- Service Cards Grid -->
                    <div class="grid grid-cols-2 gap-3">
                        <!-- Book Service Card -->
                        <div class="bg-white rounded-2xl shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all" onclick="startBooking()">
                            <div class="text-center mb-3">
                                <h3 class="font-bold text-lg text-gray-800">Book Service</h3>
                                <p class="text-gray-600 text-sm">One-time cleaning</p>
                            </div>
                            <div class="text-center mb-3">
                                <div class="text-sm text-gray-400 line-through">‚Çπ600</div>
                                <div class="text-xl font-bold text-teal">‚Çπ450</div>
                                <div class="text-xs text-gray-500">per service</div>
                            </div>
                            <div class="bg-teal text-white text-center py-2 rounded-xl font-medium text-sm">
                                Book Now ‚Üí
                            </div>
                        </div>

                        <!-- Subscribe Plan Card -->
                        <div class="bg-white rounded-2xl shadow-lg p-4 cursor-pointer hover:shadow-xl transition-all" onclick="startSubscription()">
                            <div class="text-center mb-3">
                                <h3 class="font-bold text-lg text-gray-800">Subscribe Plan</h3>
                                <p class="text-gray-600 text-sm">Regular plans</p>
                            </div>
                            <div class="text-center mb-3">
                                <div class="text-sm text-gray-400 line-through">‚Çπ1,200+</div>
                                <div class="text-xl font-bold text-teal">‚Çπ900+</div>
                                <div class="text-xs text-gray-500">per month</div>
                            </div>
                            <div class="bg-teal text-white text-center py-2 rounded-xl font-medium text-sm">
                                Subscribe ‚Üí
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features -->
            <div class="bg-white rounded-2xl p-6 mb-6">
                <h3 class="font-bold text-lg mb-4 text-gray-800">Why Choose Clenzzo?</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-sm">‚úì</div>
                        <span class="ml-3 text-gray-700">Eco-friendly waterless technology</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-sm">‚úì</div>
                        <span class="ml-3 text-gray-700">Professional trained staff</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-sm">‚úì</div>
                        <span class="ml-3 text-gray-700">Doorstep service</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-sm">‚úì</div>
                        <span class="ml-3 text-gray-700">100% satisfaction guarantee</span>
                    </div>
                </div>
            </div>

            <!-- Quick WhatsApp Booking -->
            <div class="bg-green-50 border border-green-200 rounded-2xl p-6 mb-6">
                <div class="text-center mb-4">
                    <div class="text-2xl mb-2">üí¨</div>
                    <h3 class="font-bold text-lg text-gray-800">Quick WhatsApp Booking</h3>
                    <p class="text-gray-600 text-sm">Book instantly via WhatsApp chat</p>
                </div>
                <button onclick="bookViaWhatsApp()" class="w-full bg-green-500 text-white py-4 rounded-xl font-medium hover:bg-green-600 transition-colors flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                    </svg>
                    Book via WhatsApp
                </button>
            </div>

            <!-- Contact -->
            <div class="text-center text-gray-600">
                <p class="text-sm">Need help? Call us at</p>
                <a href="tel:+918122213141" class="text-teal font-semibold text-lg">+91 81222 13141</a>
            </div>
        </div>
    </div>

    <!-- Profile Management Page -->
    <div id="profilePage" class="hidden min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow-sm p-4">
            <div class="max-w-md mx-auto flex items-center justify-between">
                <button onclick="goHome()" class="text-teal font-medium text-sm">‚Üê Back to Home</button>
                <h1 class="text-lg font-semibold text-gray-800">Profile</h1>
                <div class="w-16"></div>
            </div>
        </div>

        <!-- Profile Content -->
        <div class="max-w-md mx-auto p-4">
            <!-- Personal Info -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                <h3 class="font-bold text-lg mb-4 text-gray-800">Personal Information</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                        <input type="text" id="profileName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" id="profilePhone" class="w-full p-3 border-2 border-gray-200 rounded-xl bg-gray-100" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">PIN</label>
                        <input type="password" id="profilePin" maxlength="4" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors text-center text-xl tracking-widest">
                    </div>
                </div>
                <button onclick="updatePersonalInfo()" class="w-full bg-teal text-white py-3 rounded-xl font-medium mt-4 hover:bg-opacity-90 transition-colors">
                    Update Personal Info
                </button>
            </div>

            <!-- Addresses Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-gray-800">Addresses</h3>
                    <button onclick="showAddAddressModal()" class="bg-teal text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-opacity-90 transition-colors">
                        + Add
                    </button>
                </div>
                <div id="addressesList" class="space-y-3">
                    <!-- Addresses will be populated here -->
                </div>
            </div>

            <!-- Cars Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-gray-800">Cars</h3>
                    <button onclick="showAddCarModal()" class="bg-teal text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-opacity-90 transition-colors">
                        + Add
                    </button>
                </div>
                <div id="carsList" class="space-y-3">
                    <!-- Cars will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Address Modal -->
    <div id="addAddressModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg text-gray-800">Add Address</h3>
                <button onclick="closeAddAddressModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nickname</label>
                    <input type="text" id="addressNickname" placeholder="e.g. Home, Office" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Plot/Building</label>
                    <input type="text" id="addressPlot" placeholder="Plot no / Building name" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Street</label>
                    <input type="text" id="addressStreet" placeholder="Street" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Area</label>
                    <input type="text" id="addressArea" placeholder="Area" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Locality (Optional)</label>
                    <input type="text" id="addressLocality" placeholder="Locality" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Landmark</label>
                    <input type="text" id="addressLandmark" placeholder="Landmark" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pincode</label>
                    <input type="text" id="addressPincode" placeholder="Pin code" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeAddAddressModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                    Cancel
                </button>
                <button onclick="saveAddress()" class="flex-1 bg-teal text-white py-3 rounded-xl font-medium hover:bg-opacity-90 transition-colors">
                    Save Address
                </button>
            </div>
        </div>
    </div>

    <!-- Add Car Modal -->
    <div id="addCarModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg text-gray-800">Add Car</h3>
                <button onclick="closeAddCarModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nickname</label>
                    <input type="text" id="carNickname" placeholder="e.g. My Car, Wife's Car" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Car Type</label>
                    <select id="carType" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        <option value="">Select car type</option>
                        <option value="Hatchback">Hatchback</option>
                        <option value="Sedan">Sedan</option>
                        <option value="SUV">SUV</option>
                        <option value="MPV">MPV</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Brand</label>
                    <select id="carBrand" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors" disabled>
                        <option value="">Select brand</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Model</label>
                    <select id="carModel" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors" disabled>
                        <option value="">Select model</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeAddCarModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                    Cancel
                </button>
                <button onclick="saveCar()" class="flex-1 bg-teal text-white py-3 rounded-xl font-medium hover:bg-opacity-90 transition-colors">
                    Save Car
                </button>
            </div>
        </div>
    </div>

    <!-- User Authentication Page -->
    <div id="authPage" class="min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow-sm p-4">
            <div class="max-w-md mx-auto flex items-center justify-center">
                <div class="flex items-center">
                    <img src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=375,fit=crop,q=95/dOqZx0gxjnC3l2xQ/blasset-6-2x-8-AMqDPMxZ9qUpzDpa.png" alt="Clenzzo Logo" class="h-6 w-auto object-contain" onerror="this.src=''; this.alt='Logo failed to load'; this.style.display='none';">
                </div>
            </div>
        </div>

        <!-- Auth Content -->
        <div class="max-w-md mx-auto p-4">
            <!-- Welcome Section -->
            <div class="text-center mb-6 mt-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Welcome to Clenzzo</h1>
                <p class="text-gray-600">Premium car cleaning at your doorstep</p>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg p-6 mt-4">
                <!-- Phone Number Entry -->
                <div id="phoneAuth" class="auth-content">
                    <h2 class="text-xl font-semibold text-black mb-6">Enter your phone number</h2>
                    <div class="flex gap-2 mb-4">
                        <div class="bg-gray-100 px-3 py-4 rounded-xl text-gray-700 font-medium">+91</div>
                        <input type="tel" id="authPhoneInput" placeholder="Enter 10-digit mobile number" 
                               class="flex-1 p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                    </div>
                    <div id="authPhoneError" class="text-red-500 text-sm mb-4 hidden" role="alert" aria-live="polite">
                        Please enter a valid 10-digit Indian mobile number.
                    </div>
                    <button id="checkUserBtn" class="w-full bg-gray-300 text-gray-500 py-4 rounded-xl font-medium cursor-not-allowed" disabled>
                        Continue
                    </button>
                </div>

                <!-- PIN Verification -->
                <div id="pinVerification" class="auth-content hidden">
                    <div class="text-center mb-6">
                        <h2 class="text-xl font-semibold text-black mb-2">Welcome back!</h2>
                        <p class="text-gray-600" id="welcomeMessage">Hi [Name], please enter your PIN</p>
                    </div>
                    <div class="mb-4">
                        <input type="password" id="pinInput" placeholder="Enter 4-digit PIN" maxlength="4"
                               class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors text-center text-2xl tracking-widest">
                    </div>
                    <div id="pinError" class="text-red-500 text-sm mb-4 hidden" role="alert" aria-live="polite">
                        Incorrect PIN. Please try again.
                    </div>
                    <div class="space-y-3">
                        <button id="verifyPinBtn" class="w-full bg-gray-300 text-gray-500 py-4 rounded-xl font-medium cursor-not-allowed" disabled>
                            Verify PIN
                        </button>
                        <button onclick="showRegistration()" class="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-medium">
                            Register as New User
                        </button>
                    </div>
                </div>

                <!-- Registration Form -->
                <div id="registrationForm" class="auth-content hidden">
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                        <div class="flex items-start">
                            <div class="text-blue-600 text-lg mr-3">‚ÑπÔ∏è</div>
                            <div>
                                <div class="font-medium text-blue-800">New User Detected</div>
                                <div class="text-sm text-blue-700 mt-1">This phone number is not registered. Please create your account to continue.</div>
                            </div>
                        </div>
                    </div>
                    <h2 class="text-xl font-semibold text-black mb-6">Create your account</h2>
                    <div class="space-y-4">
                        <!-- Personal Info -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Your name</label>
                            <input type="text" id="regNameInput" placeholder="e.g. S. Ramkumar" 
                                   class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Create 4-digit PIN</label>
                            <input type="password" id="regPinInput" placeholder="Enter 4-digit PIN" maxlength="4"
                                   class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors text-center text-2xl tracking-widest">
                            <p class="text-xs text-gray-500 mt-1">You'll use this PIN for future logins</p>
                        </div>

                        <!-- Address -->
                        <div class="border-t pt-4">
                            <h3 class="font-medium text-gray-800 mb-3">Address Details</h3>
                            <div class="space-y-3">
                                <input type="text" id="regPlotInput" placeholder="Plot no / Building name" 
                                       class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                                <input type="text" id="regStreetInput" placeholder="Street" 
                                       class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                                <input type="text" id="regAreaInput" placeholder="Area" 
                                       class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                                <input type="text" id="regLocalityInput" placeholder="Locality (optional)" 
                                       class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                                <input type="text" id="regLandmarkInput" placeholder="Landmark" 
                                       class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                                <input type="text" id="regPincodeInput" placeholder="Pin code" 
                                       class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                            </div>
                        </div>

                        <!-- Car Details -->
                        <div class="border-t pt-4">
                            <h3 class="font-medium text-gray-800 mb-3">Car Information</h3>
                            <div class="space-y-3">
                                <select id="regCarTypeSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                                    <option value="">Select car type</option>
                                    <option value="Hatchback">Hatchback</option>
                                    <option value="Sedan">Sedan</option>
                                    <option value="SUV">SUV</option>
                                    <option value="MPV">MPV</option>
                                </select>
                                <select id="regCarBrandSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors" disabled>
                                    <option value="">Select brand</option>
                                </select>
                                <select id="regCarModelSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors" disabled>
                                    <option value="">Select model</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="regError" class="text-red-500 text-sm mt-4 hidden" role="alert" aria-live="polite">
                        Please fill all required fields correctly.
                    </div>
                    
                    <div class="mt-6 space-y-3">
                        <button id="registerBtn" class="w-full bg-gray-300 text-gray-500 py-4 rounded-xl font-medium cursor-not-allowed" disabled>
                            Create Account
                        </button>
                        <button onclick="showPinVerification()" class="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-medium">
                            Already have an account? Login
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking/Subscription Flow -->
    <div id="flowPage" class="hidden">
        <!-- Progress Bar -->
        <div class="bg-white shadow-sm p-4">
            <div class="max-w-md mx-auto">
                <div class="flex items-center justify-between mb-4">
                    <button onclick="goHome()" class="text-teal font-medium text-sm">‚Üê Back to Home</button>
                    <span class="text-sm font-medium text-teal" id="flowType">Book Service</span>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-gray-600" id="stepText">Step 1 / 10</span>
                    <span class="text-sm font-medium text-teal" id="progressPercent">10%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-teal h-2 rounded-full transition-all duration-300" id="progressBar" style="width: 10%"></div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-md mx-auto p-4">
            <div class="bg-white rounded-2xl shadow-lg p-6 mt-4">
                <!-- Step 1: Name -->
                <div id="step1" class="step-content">
                    <h2 class="text-xl font-semibold text-black mb-6">Your name</h2>
                    <input type="text" id="nameInput" placeholder="e.g. S. Ramkumar" 
                           class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                    <div id="nameError" class="text-red-500 text-sm mt-2 hidden" role="alert" aria-live="polite">
                        Please enter your name using only letters.
                    </div>
                </div>

                <!-- Step 2: Phone -->
                <div id="step2" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6">Phone number</h2>
                    <div class="flex gap-2">
                        <div class="bg-gray-100 px-3 py-4 rounded-xl text-gray-700 font-medium">+91</div>
                        <input type="tel" id="phoneInput" placeholder="Enter 10-digit mobile number" 
                               class="flex-1 p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                    </div>
                    <div id="phoneError" class="text-red-500 text-sm mt-2 hidden" role="alert" aria-live="polite">
                        Please enter a valid 10-digit Indian mobile number.
                    </div>
                </div>

                <!-- Step 3: Address -->
                <div id="step3" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6">Address</h2>
                    <div id="savedAddressesSection" class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Saved Address</label>
                        <select id="savedAddressSelect" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                            <option value="">Choose from saved addresses or add new</option>
                        </select>
                    </div>
                    <div class="text-center mb-4">
                        <span class="text-gray-500 text-sm">OR</span>
                    </div>
                    <div class="space-y-4">
                        <input type="text" id="plotInput" placeholder="Plot no / Building name" 
                               class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        <input type="text" id="streetInput" placeholder="Street" 
                               class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        <input type="text" id="areaInput" placeholder="Area" 
                               class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        <input type="text" id="localityInput" placeholder="Locality (optional)" 
                               class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        <input type="text" id="landmarkInput" placeholder="Landmark" 
                               class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        <input type="text" id="pincodeInput" placeholder="Pin code" 
                               class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                        <div class="bg-gray-100 px-4 py-3 rounded-xl text-gray-700">
                            <span class="font-medium">City:</span> Trichy
                        </div>
                    </div>
                    <div id="addressError" class="text-red-500 text-sm mt-2 hidden" role="alert" aria-live="polite">
                        Unserviceable area ‚Äî we currently service only pin codes starting with 62.
                    </div>
                </div>

                <!-- Step 4: Car Selection -->
                <div id="step4" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6">Select Car</h2>
                    <div id="savedCarsSection" class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Saved Car</label>
                        <select id="savedCarSelect" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                            <option value="">Choose from saved cars or select new</option>
                        </select>
                    </div>
                    <div class="text-center mb-4">
                        <span class="text-gray-500 text-sm">OR</span>
                    </div>
                    <h3 class="text-lg font-medium text-gray-800 mb-4">Car Type</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="car-type-card p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer hover:border-teal transition-colors" data-type="Hatchback">
                            <div class="text-2xl mb-2">üöó</div>
                            <div class="font-medium">Hatchback</div>
                        </div>
                        <div class="car-type-card p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer hover:border-teal transition-colors" data-type="Sedan">
                            <div class="text-2xl mb-2">üöô</div>
                            <div class="font-medium">Sedan</div>
                        </div>
                        <div class="car-type-card p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer hover:border-teal transition-colors" data-type="SUV">
                            <div class="text-2xl mb-2">üöê</div>
                            <div class="font-medium">SUV</div>
                        </div>
                        <div class="car-type-card p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer hover:border-teal transition-colors" data-type="MPV">
                            <div class="text-2xl mb-2">üöå</div>
                            <div class="font-medium">MPV</div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Car Brand & Model -->
                <div id="step5" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6">Car brand & model</h2>
                    <div class="space-y-4">
                        <select id="brandSelect" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                            <option value="">Select brand</option>
                        </select>
                        <select id="modelSelect" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors" disabled>
                            <option value="">Select model</option>
                        </select>
                    </div>
                </div>

                <!-- Step 6: Service/Plan Selection -->
                <div id="step6" class="step-content hidden">
                    <!-- Book Service Content -->
                    <div id="bookServiceContent">
                        <h2 class="text-xl font-semibold text-black mb-6" id="serviceTitle">Choose your service</h2>
                        <div class="service-card p-6 border-2 border-teal bg-teal bg-opacity-5 rounded-xl" id="serviceCard">
                            <div class="flex items-center justify-between mb-3">
                                <div class="font-semibold text-lg" id="serviceName">Premium waterless car deep cleaning</div>
                                <div class="text-xl font-bold text-teal" id="servicePrice">‚Çπ600</div>
                            </div>
                            <div class="text-sm text-gray-600" id="serviceDescription">Premium waterless: deep clean, interior wipe, exterior waterless polish.</div>
                            <div class="mt-3">
                                <span class="inline-block w-4 h-4 bg-teal rounded-full text-white text-xs flex items-center justify-center">‚úì</span>
                            </div>
                        </div>
                    </div>

                    <!-- Subscribe Plan Content -->
                    <div id="subscribePlanContent" class="hidden">
                        <h2 class="text-xl font-semibold text-black mb-6">Choose your plan</h2>
                        <div class="space-y-4">
                            <div class="plan-card p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal transition-colors" data-plan="1" data-price="900">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="font-semibold text-lg">1-month cleaning plan</div>
                                    <div class="text-xl font-bold text-teal">‚Çπ900</div>
                                </div>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>‚Ä¢ Daily waterless cleaning</li>
                                    <li>‚Ä¢ Interior & exterior care</li>
                                    <li>‚Ä¢ 30 days coverage</li>
                                </ul>
                            </div>
                            
                            <div class="plan-card p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal transition-colors" data-plan="3" data-price="2700">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="font-semibold text-lg">3-month cleaning plan</div>
                                    <div class="text-xl font-bold text-teal">‚Çπ2,700</div>
                                </div>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>‚Ä¢ Daily waterless cleaning</li>
                                    <li>‚Ä¢ Interior & exterior care</li>
                                    <li>‚Ä¢ 90 days coverage</li>
                                    <li>‚Ä¢ Priority booking</li>
                                </ul>
                            </div>
                            
                            <div class="plan-card p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal transition-colors" data-plan="6" data-price="5400">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="font-semibold text-lg">6-month cleaning plan</div>
                                    <div class="text-xl font-bold text-teal">‚Çπ5,400</div>
                                </div>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>‚Ä¢ Daily waterless cleaning</li>
                                    <li>‚Ä¢ Interior & exterior care</li>
                                    <li>‚Ä¢ 180 days coverage</li>
                                    <li>‚Ä¢ Priority booking</li>
                                    <li>‚Ä¢ Free monthly deep clean</li>
                                </ul>
                            </div>
                            
                            <div class="plan-card p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal transition-colors" data-plan="12" data-price="10800">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="font-semibold text-lg">12-month cleaning plan</div>
                                    <div class="text-xl font-bold text-teal">‚Çπ10,800</div>
                                </div>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>‚Ä¢ Daily waterless cleaning</li>
                                    <li>‚Ä¢ Interior & exterior care</li>
                                    <li>‚Ä¢ 365 days coverage</li>
                                    <li>‚Ä¢ Priority booking</li>
                                    <li>‚Ä¢ Free monthly deep clean</li>
                                    <li>‚Ä¢ Best value plan</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 7: Date & Time -->
                <div id="step7" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6" id="step7Title">Date & Time</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" id="dateLabel">Select Date</label>
                            <input type="date" id="dateInput" min="2025-10-01" 
                                   class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-teal focus:outline-none transition-colors">
                            <div class="text-xs text-gray-500 mt-1" id="dateNote">Earliest booking: 1 Oct 2025</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" id="timeLabel">Select Time</label>
                            <div class="grid grid-cols-3 gap-2" id="timeSlots">
                                <!-- Time slots will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 8: Promo Code -->
                <div id="step8" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6">Promo code</h2>
                    <div id="promoSection">
                        <div class="promo-ticket bg-gradient-to-r from-teal to-teal border-2 border-dashed border-teal rounded-xl p-6 cursor-pointer hover:shadow-md transition-all" id="promoTicket">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-bold text-lg text-white">LAUNCH25</div>
                                    <div class="text-sm text-white" id="promoDescription">25% off on your first booking</div>
                                </div>
                                <button class="bg-teal text-white px-4 py-2 rounded-lg font-medium hover:bg-opacity-90 transition-colors">
                                    Apply
                                </button>
                            </div>
                        </div>
                        <div id="promoApplied" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-xl">
                            <div class="text-green-700 font-medium">‚úì Promo applied: launch25 ‚Äî 25% off</div>
                        </div>
                    </div>
                    <div id="noPromoSection" class="hidden">
                        <div class="bg-gray-50 rounded-xl p-6 text-center">
                            <div class="text-gray-600">No promo codes available for trial bookings</div>
                            <div class="text-sm text-gray-500 mt-2">Trial price is already discounted!</div>
                        </div>
                    </div>
                </div>

                <!-- Step 9: Estimated Amount -->
                <div id="step9" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6">Estimated amount</h2>
                    <div class="bg-gray-50 rounded-xl p-6">
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span id="serviceName">Service</span>
                                <span id="servicePrice">‚Çπ600</span>
                            </div>
                            <div class="flex justify-between text-green-600" id="discountRow">
                                <span>Promo (launch25)</span>
                                <span id="discountAmount">-‚Çπ150</span>
                            </div>
                            <hr class="border-gray-300">
                            <div class="flex justify-between font-bold text-lg">
                                <span>Total</span>
                                <span class="text-teal" id="finalAmount">‚Çπ450</span>
                            </div>
                        </div>
                        <div class="text-sm text-gray-600 mt-3" id="amountDescription">Estimated amount: ‚Çπ450 (after launch25 discount)</div>
                    </div>
                </div>

                <!-- Step 10: Payment Option -->
                <div id="step10" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6">Payment option</h2>
                    <div class="space-y-3">
                        <div class="payment-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal transition-colors" data-payment="cash">
                            <div class="flex items-center">
                                <div class="w-5 h-5 border-2 border-gray-300 rounded-full mr-3 payment-radio"></div>
                                <div>
                                    <div class="font-medium">Cash</div>
                                    <div class="text-sm text-gray-600">Pay cash to our service executive</div>
                                </div>
                            </div>
                        </div>
                        <div class="payment-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal transition-colors" data-payment="qr">
                            <div class="flex items-center">
                                <div class="w-5 h-5 border-2 border-gray-300 rounded-full mr-3 payment-radio"></div>
                                <div>
                                    <div class="font-medium">Scan QR</div>
                                    <div class="text-sm text-gray-600">Pay via UPI/QR code</div>
                                </div>
                            </div>
                        </div>
                        <div class="payment-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal transition-colors" data-payment="card">
                            <div class="flex items-center">
                                <div class="w-5 h-5 border-2 border-gray-300 rounded-full mr-3 payment-radio"></div>
                                <div>
                                    <div class="font-medium">Card</div>
                                    <div class="text-sm text-gray-600">Credit/Debit card payment</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="cardNote" class="hidden mt-4 p-3 bg-blue-50 border border-blue-200 rounded-xl text-sm text-blue-700">
                        You will be redirected to card payment gateway.
                    </div>
                </div>

                <!-- Summary Screen -->
                <div id="summary" class="step-content hidden">
                    <h2 class="text-xl font-semibold text-black mb-6" id="summaryTitle">Booking Summary</h2>
                    <div class="space-y-4" id="summaryContent">
                        <!-- Personal Details -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <h3 class="font-semibold text-gray-800 mb-3">Personal Details</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Name:</span>
                                    <span class="font-medium" id="summaryName">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Phone:</span>
                                    <span class="font-medium" id="summaryPhone">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Address:</span>
                                    <span class="font-medium text-right max-w-48" id="summaryAddress">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Car Details -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <h3 class="font-semibold text-gray-800 mb-3">Car Details</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Type:</span>
                                    <span class="font-medium" id="summaryCarType">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Brand:</span>
                                    <span class="font-medium" id="summaryCarBrand">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Model:</span>
                                    <span class="font-medium" id="summaryCarModel">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Service Details -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <h3 class="font-semibold text-gray-800 mb-3">Service Details</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Service:</span>
                                    <span class="font-medium" id="summaryServiceType">-</span>
                                </div>
                                <div class="flex justify-between" id="summaryPlanRow">
                                    <span class="text-gray-600">Duration:</span>
                                    <span class="font-medium" id="summaryPlanDuration">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Date:</span>
                                    <span class="font-medium" id="summaryDate">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Time:</span>
                                    <span class="font-medium" id="summaryTime">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Details -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <h3 class="font-semibold text-gray-800 mb-3">Payment Details</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Base Amount:</span>
                                    <span class="font-medium" id="summaryBaseAmount">-</span>
                                </div>
                                <div class="flex justify-between text-green-600" id="summaryDiscountRow">
                                    <span>Discount:</span>
                                    <span class="font-medium" id="summaryDiscount">-</span>
                                </div>
                                <hr class="border-gray-300">
                                <div class="flex justify-between font-semibold text-lg">
                                    <span>Total Amount:</span>
                                    <span class="text-teal" id="summaryTotal">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Payment Method:</span>
                                    <span class="font-medium capitalize" id="summaryPayment">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Thank You Screen -->
                <div id="thankYou" class="step-content hidden text-center">
                    <div class="text-4xl mb-4">üéâ</div>
                    <h2 class="text-xl font-semibold text-black mb-4" id="thankYouTitle">Thank you for choosing Clenzzo!</h2>
                    <div class="bg-gray-50 rounded-xl p-6 text-left">
                        <p class="text-gray-700" id="thankYouMessage">
                            Hello <span id="customerName"></span>, thanks for choosing Clenzzo as your cleaning partner. We will reach out ASAP. For more details feel free to call us at +91 8122213141.
                        </p>
                    </div>
                    <div id="submissionStatus" class="mt-4 p-3 rounded-xl">
                        <!-- Status will be updated by JavaScript -->
                    </div>
                    <button onclick="goHome()" class="mt-6 bg-teal text-white py-3 px-6 rounded-xl font-medium hover:bg-opacity-90 transition-colors">
                        Back to Home
                    </button>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex gap-3 mt-6" id="navigationButtons">
                <button id="backBtn" class="flex-1 bg-gray-200 text-gray-700 py-4 rounded-xl font-medium hover:bg-gray-300 transition-colors hidden">
                    Back
                </button>
                <button id="nextBtn" class="flex-1 bg-gray-300 text-gray-500 py-4 rounded-xl font-medium cursor-not-allowed" disabled>
                    Next
                </button>
            </div>
        </div>
    </div>

    <script>
        // üîß GOOGLE SHEETS CONFIGURATION
        // Replace these values with your actual Google Sheets setup
        const GOOGLE_SHEETS_CONFIG = {
            apiKey: 'AIzaSyDgxw1FpGTh-pg1Gdje2cMYVlXbMN4yCNE', // Get from Google Cloud Console
            spreadsheetId: '18rDoLbtURizuENdqyR0jBwM2v2j25bxsrPByKE5m_o0', // From your Google Sheets URL
            
            // Sheet ranges for different data types
            bookingsRange: 'Bookings!A:P',        // One-time service bookings
            subscriptionsRange: 'Subscriptions!A:P', // Subscription plan bookings  
            trialsRange: 'Trials!A:P',            // Trial service bookings
            usersRange: 'Users!A:M',              // User registration data
            
            // API endpoints
            baseUrl: 'https://sheets.googleapis.com/v4/spreadsheets'
        };

        // Global Variables
        let currentStep = 1;
        let totalSteps = 10;
        let isSubscriptionFlow = false;
        let isTrialFlow = false;
        let currentUser = null;
        let pendingFlowType = null;
        let formData = {
            promoApplied: false,
            planPrice: 600,
            planMonths: 0
        };

        // User Database with Persistent Storage
        let userDatabase = {};

        // Load user data from localStorage on startup
        function loadUserDatabase() {
            const stored = localStorage.getItem('clenzzoUsers');
            if (stored) {
                userDatabase = JSON.parse(stored);
            } else {
                // Initialize with default test users
                userDatabase = {
                    '9876543210': {
                        name: 'S. Ramkumar',
                        pin: '1234',
                        phone: '9876543210',
                        addresses: [
                            {
                                id: 'addr1',
                                nickname: 'Home',
                                plot: '123 Sunshine Apartments',
                                street: 'Anna Nagar Main Road',
                                area: 'Anna Nagar',
                                locality: 'West',
                                landmark: 'Near City Center Mall',
                                pincode: '620001',
                                isDefault: true
                            }
                        ],
                        cars: [
                            {
                                id: 'car1',
                                nickname: 'My Car',
                                type: 'Sedan',
                                brand: 'Maruti Suzuki',
                                model: 'Dzire',
                                isDefault: true
                            }
                        ],
                        // Legacy support
                        address: {
                            plot: '123 Sunshine Apartments',
                            street: 'Anna Nagar Main Road',
                            area: 'Anna Nagar',
                            locality: 'West',
                            landmark: 'Near City Center Mall',
                            pincode: '620001'
                        },
                        car: {
                            type: 'Sedan',
                            brand: 'Maruti Suzuki',
                            model: 'Dzire'
                        }
                    },
                    '8765432109': {
                        name: 'Priya Sharma',
                        pin: '5678',
                        phone: '8765432109',
                        addresses: [
                            {
                                id: 'addr2',
                                nickname: 'Home',
                                plot: '45 Green Valley',
                                street: 'Bharathidasan Road',
                                area: 'Cantonment',
                                locality: '',
                                landmark: 'Opposite Government Hospital',
                                pincode: '620002',
                                isDefault: true
                            }
                        ],
                        cars: [
                            {
                                id: 'car2',
                                nickname: 'My Car',
                                type: 'Hatchback',
                                brand: 'Hyundai',
                                model: 'i20',
                                isDefault: true
                            }
                        ],
                        // Legacy support
                        address: {
                            plot: '45 Green Valley',
                            street: 'Bharathidasan Road',
                            area: 'Cantonment',
                            locality: '',
                            landmark: 'Opposite Government Hospital',
                            pincode: '620002'
                        },
                        car: {
                            type: 'Hatchback',
                            brand: 'Hyundai',
                            model: 'i20'
                        }
                    }
                };
                saveUserDatabase();
            }
        }

        // Save user database to localStorage
        function saveUserDatabase() {
            localStorage.setItem('clenzzoUsers', JSON.stringify(userDatabase));
        }

        // üìä GOOGLE SHEETS INTEGRATION FUNCTIONS

        // Check if user exists in Google Sheets
        async function checkUserInGoogleSheets(phone) {
            try {
                if (GOOGLE_SHEETS_CONFIG.apiKey === 'YOUR_GOOGLE_API_KEY_HERE') {
                    return null; // Fallback to local database
                }

                const response = await fetch(`${GOOGLE_SHEETS_CONFIG.baseUrl}/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.usersRange}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`);
                
                if (response.ok) {
                    const data = await response.json();
                    const rows = data.values || [];
                    
                    // Find user by phone number (assuming phone is in column C, index 2)
                    for (let i = 1; i < rows.length; i++) { // Skip header row
                        if (rows[i][2] === phone) {
                            return {
                                name: rows[i][1],
                                phone: rows[i][2], 
                                pin: rows[i][3],
                                address: {
                                    plot: rows[i][4],
                                    street: rows[i][5],
                                    area: rows[i][6],
                                    locality: rows[i][7] || '',
                                    landmark: rows[i][8],
                                    pincode: rows[i][9]
                                },
                                car: {
                                    type: rows[i][10],
                                    brand: rows[i][11],
                                    model: rows[i][12]
                                }
                            };
                        }
                    }
                }
                return null; // User not found
            } catch (error) {
                console.log('‚ö†Ô∏è Error checking user in Google Sheets:', error);
                return null;
            }
        }

        // Save booking data to appropriate Google Sheets tab
        async function submitToGoogleSheets(data) {
            try {
                // Check if API is configured
                if (GOOGLE_SHEETS_CONFIG.apiKey === 'YOUR_GOOGLE_API_KEY_HERE') {
                    console.log('‚ö†Ô∏è Google Sheets API not configured. Data saved locally only.');
                    return false;
                }

                // Determine which sheet to use based on service type
                let sheetRange;
                if (data.serviceType === 'Trial') {
                    sheetRange = GOOGLE_SHEETS_CONFIG.trialsRange;
                } else if (data.serviceType === 'Subscription') {
                    sheetRange = GOOGLE_SHEETS_CONFIG.subscriptionsRange;
                } else {
                    sheetRange = GOOGLE_SHEETS_CONFIG.bookingsRange;
                }

                // Prepare comprehensive row data
                const rowData = [
                    data.timestamp,           // A: Timestamp
                    data.name,               // B: Customer Name
                    data.phone,              // C: Phone Number
                    data.address,            // D: Full Address
                    data.carType,            // E: Car Type
                    data.carBrand,           // F: Car Brand
                    data.carModel,           // G: Car Model
                    data.serviceType,        // H: Service Type (Trial/Subscription/One-time)
                    data.planDuration,       // I: Plan Duration
                    data.date,               // J: Service Date
                    data.time,               // K: Service Time
                    data.baseAmount || data.amount, // L: Base Amount
                    data.discount || 0,      // M: Discount Amount
                    data.amount,             // N: Final Amount
                    data.paymentMethod,      // O: Payment Method
                    data.promoApplied        // P: Promo Applied (Yes/No)
                ];

                // Google Sheets API call
                const response = await fetch(`${GOOGLE_SHEETS_CONFIG.baseUrl}/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${sheetRange}:append?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        values: [rowData]
                    })
                });

                if (response.ok) {
                    console.log(`‚úÖ ${data.serviceType} data successfully saved to Google Sheets`);
                    return true;
                } else {
                    console.error('‚ùå Failed to save to Google Sheets:', response.statusText);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Error saving to Google Sheets:', error);
                return false;
            }
        }

        // Save user data to Google Sheets
        async function saveUserToGoogleSheets(userData) {
            try {
                // Check if API is configured
                if (GOOGLE_SHEETS_CONFIG.apiKey === 'YOUR_GOOGLE_API_KEY_HERE') {
                    return false;
                }

                const userRowData = [
                    new Date().toISOString(),    // A: Registration Timestamp
                    userData.name,               // B: Name
                    userData.phone,              // C: Phone
                    userData.pin,                // D: PIN
                    userData.address.plot,       // E: Plot/Building
                    userData.address.street,     // F: Street
                    userData.address.area,       // G: Area
                    userData.address.locality,   // H: Locality
                    userData.address.landmark,   // I: Landmark
                    userData.address.pincode,    // J: Pincode
                    userData.car.type,           // K: Car Type
                    userData.car.brand,          // L: Car Brand
                    userData.car.model           // M: Car Model
                ];

                const response = await fetch(`${GOOGLE_SHEETS_CONFIG.baseUrl}/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.usersRange}:append?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        values: [userRowData]
                    })
                });

                if (response.ok) {
                    console.log('‚úÖ User data saved to Google Sheets');
                    return true;
                } else {
                    console.log('‚ö†Ô∏è Could not save user data to Google Sheets');
                    return false;
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Error saving user data to Google Sheets:', error);
                return false;
            }
        }

        // Update user data in Google Sheets
        async function updateUserInGoogleSheets(userData) {
            try {
                // Check if API is configured
                if (GOOGLE_SHEETS_CONFIG.apiKey === 'YOUR_GOOGLE_API_KEY_HERE') {
                    return false;
                }

                // First, find the user's row in the sheet
                const response = await fetch(`${GOOGLE_SHEETS_CONFIG.baseUrl}/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.usersRange}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`);
                
                if (response.ok) {
                    const data = await response.json();
                    const rows = data.values || [];
                    
                    // Find user by phone number (column C, index 2)
                    let userRowIndex = -1;
                    for (let i = 1; i < rows.length; i++) { // Skip header row
                        if (rows[i][2] === userData.phone) {
                            userRowIndex = i + 1; // Google Sheets uses 1-based indexing
                            break;
                        }
                    }
                    
                    if (userRowIndex > 0) {
                        // Update existing user row
                        const updatedRowData = [
                            rows[userRowIndex - 1][0], // Keep original timestamp
                            userData.name,               // B: Name
                            userData.phone,              // C: Phone
                            userData.pin,                // D: PIN
                            userData.address.plot,       // E: Plot/Building
                            userData.address.street,     // F: Street
                            userData.address.area,       // G: Area
                            userData.address.locality,   // H: Locality
                            userData.address.landmark,   // I: Landmark
                            userData.address.pincode,    // J: Pincode
                            userData.car.type,           // K: Car Type
                            userData.car.brand,          // L: Car Brand
                            userData.car.model           // M: Car Model
                        ];

                        const updateResponse = await fetch(`${GOOGLE_SHEETS_CONFIG.baseUrl}/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/Users!A${userRowIndex}:M${userRowIndex}?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                values: [updatedRowData]
                            })
                        });

                        if (updateResponse.ok) {
                            console.log('‚úÖ User data updated in Google Sheets');
                            return true;
                        }
                    }
                }
                
                return false;
            } catch (error) {
                console.log('‚ö†Ô∏è Error updating user data in Google Sheets:', error);
                return false;
            }
        }

        // Car Data
        const carData = {
            Hatchback: {
                'Maruti Suzuki': ['Alto 800', 'Alto K10', 'S-Presso', 'WagonR', 'Swift', 'Baleno', 'Celerio', 'Ignis'],
                'Hyundai': ['Grand i10 Nios', 'i10', 'i20', 'Elite i20', 'Santro'],
                'Tata': ['Tiago', 'Altroz', 'Bolt', 'Indica', 'Vista'],
                'Honda': ['Brio', 'Jazz', 'WR-V'],
                'Ford': ['Figo', 'Freestyle'],
                'Nissan': ['Micra', 'Go'],
                'Renault': ['Kwid', 'Pulse'],
                'Volkswagen': ['Polo']
            },
            Sedan: {
                'Maruti Suzuki': ['Dzire', 'Ciaz', 'SX4'],
                'Hyundai': ['Verna', 'Aura', 'Xcent', 'Elantra'],
                'Honda': ['Amaze', 'City', 'Civic'],
                'Tata': ['Tigor', 'Zest', 'Indigo'],
                'Toyota': ['Yaris', 'Etios', 'Camry', 'Corolla Altis'],
                'Volkswagen': ['Vento', 'Passat', 'Jetta'],
                'Skoda': ['Rapid', 'Octavia', 'Superb'],
                'Ford': ['Aspire', 'Fiesta'],
                'Nissan': ['Sunny', 'Teana']
            },
            SUV: {
                'Tata': ['Nexon', 'Harrier', 'Safari', 'Hexa'],
                'Hyundai': ['Venue', 'Creta', 'Alcazar', 'Tucson', 'Santa Fe'],
                'Maruti Suzuki': ['Vitara Brezza', 'S-Cross', 'Grand Vitara'],
                'Mahindra': ['XUV300', 'XUV500', 'XUV700', 'Scorpio', 'Thar', 'Bolero'],
                'Kia': ['Sonet', 'Seltos', 'Carens'],
                'Honda': ['WR-V', 'CR-V'],
                'Toyota': ['Urban Cruiser', 'Fortuner', 'Land Cruiser'],
                'Ford': ['EcoSport', 'Endeavour'],
                'Renault': ['Duster', 'Captur', 'Kiger'],
                'Nissan': ['Terrano', 'Kicks', 'Magnite'],
                'Jeep': ['Compass', 'Wrangler', 'Grand Cherokee'],
                'MG': ['Hector', 'ZS EV', 'Astor']
            },
            MPV: {
                'Maruti Suzuki': ['Ertiga', 'XL6', 'Eeco'],
                'Toyota': ['Innova Crysta', 'Innova', 'Vellfire'],
                'Mahindra': ['Marazzo', 'Xylo', 'Bolero Neo'],
                'Renault': ['Lodgy', 'Triber'],
                'Honda': ['BR-V', 'Mobilio'],
                'Kia': ['Carnival', 'Carens']
            }
        };

        // Time Slots
        const bookingTimeSlots = [
            '7:00 AM', '7:30 AM', '8:00 AM', '8:30 AM', '9:00 AM', '9:30 AM',
            '10:00 AM', '10:30 AM', '11:00 AM', '11:30 AM', '12:00 PM', '12:30 PM',
            '1:00 PM', '1:30 PM', '2:00 PM', '2:30 PM', '3:00 PM', '3:30 PM',
            '4:00 PM', '4:30 PM', '5:00 PM', '5:30 PM', '6:00 PM', '6:30 PM', '7:00 PM'
        ];

        const subscriptionTimeSlots = [
            '5:00-6:00 AM', '6:00-7:00 AM', '7:00-8:00 AM', 
            '8:00-9:00 AM', '9:00-10:00 AM', '10:00-11:00 AM'
        ];

        // Validation Functions
        function validatePhone(phone) {
            return /^[6-9]\d{9}$/.test(phone);
        }

        function validateName(name) {
            return /^[a-zA-Z\s.]+$/.test(name) && name.trim().length > 0;
        }

        function validatePincode(pincode) {
            return /^62\d{4}$/.test(pincode);
        }

        function validatePin(pin) {
            return /^\d{4}$/.test(pin);
        }

        // Page Navigation Functions
        function showPage(pageId) {
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('flowPage').classList.add('hidden');
            document.getElementById('profilePage').classList.add('hidden');
            
            document.getElementById(pageId).classList.remove('hidden');
        }

        function goHome() {
            showPage('homePage');
            resetFlow();
            
            if (currentUser) {
                updateHomePageUserInfo();
            }
        }

        function showProfile() {
            showPage('profilePage');
            loadProfileData();
        }

        function updateHomePageUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('userGreeting').textContent = `Hello, ${currentUser.name}!`;
            
            // Update default car display
            const defaultCar = getDefaultCar();
            if (defaultCar) {
                document.getElementById('defaultCarDisplay').textContent = `${defaultCar.nickname} (${defaultCar.brand} ${defaultCar.model})`;
            } else {
                document.getElementById('defaultCarDisplay').textContent = 'Not set';
            }
            
            // Update default address display
            const defaultAddress = getDefaultAddress();
            if (defaultAddress) {
                document.getElementById('defaultAddressDisplay').textContent = `${defaultAddress.nickname} (${defaultAddress.area})`;
            } else {
                document.getElementById('defaultAddressDisplay').textContent = 'Not set';
            }
        }

        function getDefaultCar() {
            if (!currentUser) return null;
            if (currentUser.cars && currentUser.cars.length > 0) {
                return currentUser.cars.find(car => car.isDefault) || currentUser.cars[0];
            }
            return currentUser.car ? { nickname: 'My Car', ...currentUser.car, isDefault: true } : null;
        }

        function getDefaultAddress() {
            if (!currentUser) return null;
            if (currentUser.addresses && currentUser.addresses.length > 0) {
                return currentUser.addresses.find(addr => addr.isDefault) || currentUser.addresses[0];
            }
            return currentUser.address ? { nickname: 'Home', ...currentUser.address, isDefault: true } : null;
        }

        function loadProfileData() {
            if (!currentUser) return;
            
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profilePhone').value = currentUser.phone;
            document.getElementById('profilePin').value = currentUser.pin;
            
            loadAddressesList();
            loadCarsList();
        }

        function loadAddressesList() {
            const addressesList = document.getElementById('addressesList');
            addressesList.innerHTML = '';
            
            if (!currentUser.addresses || currentUser.addresses.length === 0) {
                addressesList.innerHTML = '<div class="text-gray-500 text-center py-4">No addresses added yet</div>';
                return;
            }
            
            currentUser.addresses.forEach(address => {
                const addressCard = document.createElement('div');
                addressCard.className = `p-4 border-2 rounded-xl ${address.isDefault ? 'border-teal bg-teal bg-opacity-5' : 'border-gray-200'}`;
                addressCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-medium text-gray-800">${address.nickname} ${address.isDefault ? '(Default)' : ''}</div>
                            <div class="text-sm text-gray-600 mt-1">${address.plot}, ${address.area}, ${address.pincode}</div>
                        </div>
                        <div class="flex gap-2 ml-3">
                            ${!address.isDefault ? `<button onclick="setDefaultAddress('${address.id}')" class="text-teal text-sm font-medium">Set Default</button>` : ''}
                            <button onclick="deleteAddress('${address.id}')" class="text-red-500 text-sm font-medium">Delete</button>
                        </div>
                    </div>
                `;
                addressesList.appendChild(addressCard);
            });
        }

        function loadCarsList() {
            const carsList = document.getElementById('carsList');
            carsList.innerHTML = '';
            
            if (!currentUser.cars || currentUser.cars.length === 0) {
                carsList.innerHTML = '<div class="text-gray-500 text-center py-4">No cars added yet</div>';
                return;
            }
            
            currentUser.cars.forEach(car => {
                const carCard = document.createElement('div');
                carCard.className = `p-4 border-2 rounded-xl ${car.isDefault ? 'border-teal bg-teal bg-opacity-5' : 'border-gray-200'}`;
                carCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-medium text-gray-800">${car.nickname} ${car.isDefault ? '(Default)' : ''}</div>
                            <div class="text-sm text-gray-600 mt-1">${car.type} - ${car.brand} ${car.model}</div>
                        </div>
                        <div class="flex gap-2 ml-3">
                            ${!car.isDefault ? `<button onclick="setDefaultCar('${car.id}')" class="text-teal text-sm font-medium">Set Default</button>` : ''}
                            <button onclick="deleteCar('${car.id}')" class="text-red-500 text-sm font-medium">Delete</button>
                        </div>
                    </div>
                `;
                carsList.appendChild(carCard);
            });
        }

        function logout() {
            currentUser = null;
            pendingFlowType = null;
            resetFlow();
            showAuthPage();
        }

        // Authentication Functions
        function showAuthPage() {
            showPage('authPage');
            showPhoneAuth();
        }

        function showPhoneAuth() {
            document.querySelectorAll('.auth-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('phoneAuth').classList.remove('hidden');
            
            document.getElementById('authPhoneInput').value = '';
            document.getElementById('authPhoneError').classList.add('hidden');
            updateCheckUserButton();
        }

        function showPinVerification() {
            document.querySelectorAll('.auth-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('pinVerification').classList.remove('hidden');
            
            document.getElementById('pinInput').value = '';
            document.getElementById('pinError').classList.add('hidden');
            updateVerifyPinButton();
        }

        function showRegistration() {
            document.querySelectorAll('.auth-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('registrationForm').classList.remove('hidden');
            
            // Clear all fields
            document.getElementById('regNameInput').value = '';
            document.getElementById('regPinInput').value = '';
            document.getElementById('regPlotInput').value = '';
            document.getElementById('regStreetInput').value = '';
            document.getElementById('regAreaInput').value = '';
            document.getElementById('regLocalityInput').value = '';
            document.getElementById('regLandmarkInput').value = '';
            document.getElementById('regPincodeInput').value = '';
            document.getElementById('regCarTypeSelect').value = '';
            document.getElementById('regCarBrandInput').value = '';
            document.getElementById('regCarModelInput').value = '';
            
            document.getElementById('regError').classList.add('hidden');
            updateRegisterButton();
        }

        async function checkUser() {
            const phone = document.getElementById('authPhoneInput').value.trim();
            
            if (!validatePhone(phone)) {
                document.getElementById('authPhoneError').classList.remove('hidden');
                return;
            }
            
            document.getElementById('authPhoneError').classList.add('hidden');
            
            // Show loading state
            const checkBtn = document.getElementById('checkUserBtn');
            const originalText = checkBtn.textContent;
            checkBtn.textContent = 'Checking...';
            checkBtn.disabled = true;
            
            try {
                // First check Google Sheets for user
                let foundUser = await checkUserInGoogleSheets(phone);
                
                // If not found in Google Sheets, check local database
                if (!foundUser && userDatabase[phone]) {
                    foundUser = userDatabase[phone];
                }
                
                if (foundUser) {
                    currentUser = foundUser;
                    // Sync to local database if found in Google Sheets
                    if (!userDatabase[phone]) {
                        userDatabase[phone] = foundUser;
                        saveUserDatabase();
                    }
                    document.getElementById('welcomeMessage').textContent = `Hi ${currentUser.name}, please enter your PIN`;
                    showPinVerification();
                } else {
                    showRegistration();
                }
            } catch (error) {
                console.error('Error checking user:', error);
                // Fallback to local database only
                if (userDatabase[phone]) {
                    currentUser = userDatabase[phone];
                    document.getElementById('welcomeMessage').textContent = `Hi ${currentUser.name}, please enter your PIN`;
                    showPinVerification();
                } else {
                    showRegistration();
                }
            } finally {
                // Restore button state
                checkBtn.textContent = originalText;
                checkBtn.disabled = false;
                updateCheckUserButton();
            }
        }

        function verifyPin() {
            const enteredPin = document.getElementById('pinInput').value;
            
            if (currentUser && currentUser.pin === enteredPin) {
                document.getElementById('pinError').classList.add('hidden');
                proceedAfterAuth();
            } else {
                document.getElementById('pinError').classList.remove('hidden');
                document.getElementById('pinInput').value = '';
                updateVerifyPinButton();
            }
        }

        async function registerUser() {
            const phone = document.getElementById('authPhoneInput').value.trim();
            const name = document.getElementById('regNameInput').value.trim();
            const pin = document.getElementById('regPinInput').value.trim();
            const plot = document.getElementById('regPlotInput').value.trim();
            const street = document.getElementById('regStreetInput').value.trim();
            const area = document.getElementById('regAreaInput').value.trim();
            const locality = document.getElementById('regLocalityInput').value.trim();
            const landmark = document.getElementById('regLandmarkInput').value.trim();
            const pincode = document.getElementById('regPincodeInput').value.trim();
            const carType = document.getElementById('regCarTypeSelect').value;
            const carBrand = document.getElementById('regCarBrandSelect').value;
            const carModel = document.getElementById('regCarModelSelect').value;

            // Validate all required fields
            if (!validateName(name) || !validatePin(pin) || !plot || !street || 
                !area || !landmark || !validatePincode(pincode) || 
                !carType || !carBrand || !carModel) {
                document.getElementById('regError').textContent = 'Please fill all required fields correctly.';
                document.getElementById('regError').classList.remove('hidden');
                return;
            }

            document.getElementById('regError').classList.add('hidden');

            // Create new user with new structure
            const newUser = {
                name: name,
                pin: pin,
                phone: phone,
                addresses: [
                    {
                        id: 'addr_' + Date.now(),
                        nickname: 'Home',
                        plot: plot,
                        street: street,
                        area: area,
                        locality: locality,
                        landmark: landmark,
                        pincode: pincode,
                        isDefault: true
                    }
                ],
                cars: [
                    {
                        id: 'car_' + Date.now(),
                        nickname: 'My Car',
                        type: carType,
                        brand: carBrand,
                        model: carModel,
                        isDefault: true
                    }
                ],
                // Legacy support
                address: {
                    plot: plot,
                    street: street,
                    area: area,
                    locality: locality,
                    landmark: landmark,
                    pincode: pincode
                },
                car: {
                    type: carType,
                    brand: carBrand,
                    model: carModel
                }
            };

            // Save to local database
            userDatabase[phone] = newUser;
            saveUserDatabase();
            currentUser = newUser;

            // Save to Google Sheets
            await saveUserToGoogleSheets(newUser);

            console.log('User registered successfully:', newUser);
            proceedAfterAuth();
        }

        // Profile Management Functions
        async function updatePersonalInfo() {
            const name = document.getElementById('profileName').value.trim();
            const pin = document.getElementById('profilePin').value.trim();
            
            if (!validateName(name) || !validatePin(pin)) {
                alert('Please enter valid name and PIN');
                return;
            }
            
            // Show loading state
            const originalText = 'Update Personal Info';
            const updateBtn = event.target;
            updateBtn.textContent = 'Updating...';
            updateBtn.disabled = true;
            
            try {
                currentUser.name = name;
                currentUser.pin = pin;
                userDatabase[currentUser.phone] = currentUser;
                saveUserDatabase();
                
                // Try to update in Google Sheets
                await updateUserInGoogleSheets(currentUser);
                
                alert('Personal information updated successfully!');
                updateHomePageUserInfo();
            } catch (error) {
                console.error('Error updating personal info:', error);
                alert('Information updated locally. Cloud sync may have failed.');
            } finally {
                // Restore button state
                updateBtn.textContent = originalText;
                updateBtn.disabled = false;
            }
        }

        // Address Management
        function showAddAddressModal() {
            document.getElementById('addAddressModal').classList.remove('hidden');
            clearAddressForm();
        }

        function closeAddAddressModal() {
            document.getElementById('addAddressModal').classList.add('hidden');
        }

        function clearAddressForm() {
            document.getElementById('addressNickname').value = '';
            document.getElementById('addressPlot').value = '';
            document.getElementById('addressStreet').value = '';
            document.getElementById('addressArea').value = '';
            document.getElementById('addressLocality').value = '';
            document.getElementById('addressLandmark').value = '';
            document.getElementById('addressPincode').value = '';
        }

        function saveAddress() {
            const nickname = document.getElementById('addressNickname').value.trim();
            const plot = document.getElementById('addressPlot').value.trim();
            const street = document.getElementById('addressStreet').value.trim();
            const area = document.getElementById('addressArea').value.trim();
            const locality = document.getElementById('addressLocality').value.trim();
            const landmark = document.getElementById('addressLandmark').value.trim();
            const pincode = document.getElementById('addressPincode').value.trim();
            
            if (!nickname || !plot || !street || !area || !landmark || !validatePincode(pincode)) {
                alert('Please fill all required fields correctly');
                return;
            }
            
            if (!currentUser.addresses) {
                currentUser.addresses = [];
            }
            
            const newAddress = {
                id: 'addr_' + Date.now(),
                nickname: nickname,
                plot: plot,
                street: street,
                area: area,
                locality: locality,
                landmark: landmark,
                pincode: pincode,
                isDefault: currentUser.addresses.length === 0
            };
            
            currentUser.addresses.push(newAddress);
            userDatabase[currentUser.phone] = currentUser;
            saveUserDatabase();
            
            closeAddAddressModal();
            loadAddressesList();
            updateHomePageUserInfo();
        }

        function setDefaultAddress(addressId) {
            if (!currentUser.addresses) return;
            
            currentUser.addresses.forEach(addr => {
                addr.isDefault = addr.id === addressId;
            });
            
            userDatabase[currentUser.phone] = currentUser;
            saveUserDatabase();
            loadAddressesList();
            updateHomePageUserInfo();
        }

        function deleteAddress(addressId) {
            if (!currentUser.addresses) return;
            
            const addressToDelete = currentUser.addresses.find(addr => addr.id === addressId);
            if (addressToDelete && addressToDelete.isDefault && currentUser.addresses.length > 1) {
                alert('Cannot delete default address. Please set another address as default first.');
                return;
            }
            
            currentUser.addresses = currentUser.addresses.filter(addr => addr.id !== addressId);
            
            // If we deleted the last address, clear the array
            if (currentUser.addresses.length === 0) {
                currentUser.addresses = [];
            } else if (addressToDelete && addressToDelete.isDefault) {
                // If we deleted the default address, make the first one default
                currentUser.addresses[0].isDefault = true;
            }
            
            userDatabase[currentUser.phone] = currentUser;
            saveUserDatabase();
            loadAddressesList();
            updateHomePageUserInfo();
        }

        // Car Management
        function showAddCarModal() {
            document.getElementById('addCarModal').classList.remove('hidden');
            clearCarForm();
            setupCarModalDropdowns();
        }

        function closeAddCarModal() {
            document.getElementById('addCarModal').classList.add('hidden');
        }

        function clearCarForm() {
            document.getElementById('carNickname').value = '';
            document.getElementById('carType').value = '';
            document.getElementById('carBrand').value = '';
            document.getElementById('carModel').value = '';
            document.getElementById('carBrand').disabled = true;
            document.getElementById('carModel').disabled = true;
        }

        function setupCarModalDropdowns() {
            const carTypeSelect = document.getElementById('carType');
            const carBrandSelect = document.getElementById('carBrand');
            const carModelSelect = document.getElementById('carModel');
            
            carTypeSelect.addEventListener('change', function() {
                updateModalCarBrands();
            });
            
            carBrandSelect.addEventListener('change', function() {
                updateModalCarModels();
            });
        }

        function updateModalCarBrands() {
            const carType = document.getElementById('carType').value;
            const carBrandSelect = document.getElementById('carBrand');
            const carModelSelect = document.getElementById('carModel');
            
            carBrandSelect.innerHTML = '<option value="">Select brand</option>';
            carModelSelect.innerHTML = '<option value="">Select model</option>';
            carModelSelect.disabled = true;
            
            if (carType && carData[carType]) {
                Object.keys(carData[carType]).forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    carBrandSelect.appendChild(option);
                });
                carBrandSelect.disabled = false;
            } else {
                carBrandSelect.disabled = true;
            }
        }

        function updateModalCarModels() {
            const carType = document.getElementById('carType').value;
            const carBrand = document.getElementById('carBrand').value;
            const carModelSelect = document.getElementById('carModel');
            
            carModelSelect.innerHTML = '<option value="">Select model</option>';
            
            if (carType && carBrand && carData[carType] && carData[carType][carBrand]) {
                carData[carType][carBrand].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    carModelSelect.appendChild(option);
                });
                carModelSelect.disabled = false;
            } else {
                carModelSelect.disabled = true;
            }
        }

        function saveCar() {
            const nickname = document.getElementById('carNickname').value.trim();
            const type = document.getElementById('carType').value;
            const brand = document.getElementById('carBrand').value;
            const model = document.getElementById('carModel').value;
            
            if (!nickname || !type || !brand || !model) {
                alert('Please fill all required fields');
                return;
            }
            
            if (!currentUser.cars) {
                currentUser.cars = [];
            }
            
            const newCar = {
                id: 'car_' + Date.now(),
                nickname: nickname,
                type: type,
                brand: brand,
                model: model,
                isDefault: currentUser.cars.length === 0
            };
            
            currentUser.cars.push(newCar);
            userDatabase[currentUser.phone] = currentUser;
            saveUserDatabase();
            
            closeAddCarModal();
            loadCarsList();
            updateHomePageUserInfo();
        }

        function setDefaultCar(carId) {
            if (!currentUser.cars) return;
            
            currentUser.cars.forEach(car => {
                car.isDefault = car.id === carId;
            });
            
            userDatabase[currentUser.phone] = currentUser;
            saveUserDatabase();
            loadCarsList();
            updateHomePageUserInfo();
        }

        function deleteCar(carId) {
            if (!currentUser.cars) return;
            
            const carToDelete = currentUser.cars.find(car => car.id === carId);
            if (carToDelete && carToDelete.isDefault && currentUser.cars.length > 1) {
                alert('Cannot delete default car. Please set another car as default first.');
                return;
            }
            
            currentUser.cars = currentUser.cars.filter(car => car.id !== carId);
            
            // If we deleted the last car, clear the array
            if (currentUser.cars.length === 0) {
                currentUser.cars = [];
            } else if (carToDelete && carToDelete.isDefault) {
                // If we deleted the default car, make the first one default
                currentUser.cars[0].isDefault = true;
            }
            
            userDatabase[currentUser.phone] = currentUser;
            saveUserDatabase();
            loadCarsList();
            updateHomePageUserInfo();
        }

        function proceedAfterAuth() {
            if (pendingFlowType) {
                if (pendingFlowType === 'trial') {
                    startTrialFlow();
                } else if (pendingFlowType === 'booking') {
                    startBookingFlow();
                } else if (pendingFlowType === 'subscription') {
                    startSubscriptionFlow();
                }
                pendingFlowType = null;
            } else {
                goHome();
            }
        }

        // Flow Start Functions
        function startTrial() {
            if (!currentUser) {
                pendingFlowType = 'trial';
                showAuthPage();
                return;
            }
            startTrialFlow();
        }

        function startBooking() {
            if (!currentUser) {
                pendingFlowType = 'booking';
                showAuthPage();
                return;
            }
            startBookingFlow();
        }

        function startSubscription() {
            if (!currentUser) {
                pendingFlowType = 'subscription';
                showAuthPage();
                return;
            }
            startSubscriptionFlow();
        }

        function startTrialFlow() {
            isTrialFlow = true;
            isSubscriptionFlow = false;
            formData.planPrice = 100;
            formData.planMonths = 0;
            document.getElementById('flowType').textContent = 'Book Trial';
            
            showPage('flowPage');
            prefillFormWithUserData();
        }

        function startBookingFlow() {
            isTrialFlow = false;
            isSubscriptionFlow = false;
            formData.planPrice = 600;
            formData.planMonths = 0;
            document.getElementById('flowType').textContent = 'Book Service';
            
            showPage('flowPage');
            prefillFormWithUserData();
        }

        function startSubscriptionFlow() {
            isTrialFlow = false;
            isSubscriptionFlow = true;
            formData.planPrice = 900;
            formData.planMonths = 1;
            document.getElementById('flowType').textContent = 'Subscribe Plan';
            
            showPage('flowPage');
            prefillFormWithUserData();
        }

        function prefillFormWithUserData() {
            if (!currentUser) return;

            console.log('Pre-filling form with user data:', currentUser);

            // Get default address and car
            const defaultAddress = getDefaultAddress();
            const defaultCar = getDefaultCar();

            // Store in formData
            formData.name = currentUser.name;
            formData.phone = currentUser.phone;
            
            if (defaultAddress) {
                formData.address = {
                    plot: defaultAddress.plot,
                    street: defaultAddress.street,
                    area: defaultAddress.area,
                    locality: defaultAddress.locality || '',
                    landmark: defaultAddress.landmark,
                    pincode: defaultAddress.pincode
                };
            }
            
            if (defaultCar) {
                formData.selectedCarType = defaultCar.type;
                formData.selectedBrand = defaultCar.brand;
                formData.selectedModel = defaultCar.model;
            }

            // Fill form fields immediately
            document.getElementById('nameInput').value = currentUser.name;
            document.getElementById('phoneInput').value = currentUser.phone;
            
            if (defaultAddress) {
                document.getElementById('plotInput').value = defaultAddress.plot;
                document.getElementById('streetInput').value = defaultAddress.street;
                document.getElementById('areaInput').value = defaultAddress.area;
                document.getElementById('localityInput').value = defaultAddress.locality || '';
                document.getElementById('landmarkInput').value = defaultAddress.landmark;
                document.getElementById('pincodeInput').value = defaultAddress.pincode;
            }

            // Populate saved addresses and cars dropdowns
            populateSavedAddresses();
            populateSavedCars();

            updateNextButton();

            setTimeout(() => {
                if (defaultCar) {
                    document.querySelectorAll('.car-type-card').forEach(card => {
                        card.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                        card.classList.add('border-gray-200');
                        
                        if (card.dataset.type === defaultCar.type) {
                            card.classList.remove('border-gray-200');
                            card.classList.add('border-teal', 'bg-teal', 'bg-opacity-5');
                        }
                    });

                    updateCarBrands();

                    setTimeout(() => {
                        const brandSelect = document.getElementById('brandSelect');
                        brandSelect.value = defaultCar.brand;
                        formData.selectedBrand = defaultCar.brand;
                        
                        updateCarModels();
                        
                        setTimeout(() => {
                            const modelSelect = document.getElementById('modelSelect');
                            modelSelect.value = defaultCar.model;
                            formData.selectedModel = defaultCar.model;
                        }, 100);
                    }, 100);
                }
            }, 200);
        }

        function populateSavedAddresses() {
            const savedAddressSelect = document.getElementById('savedAddressSelect');
            savedAddressSelect.innerHTML = '<option value="">Choose from saved addresses or add new</option>';
            
            if (currentUser.addresses && currentUser.addresses.length > 0) {
                currentUser.addresses.forEach(address => {
                    const option = document.createElement('option');
                    option.value = address.id;
                    option.textContent = `${address.nickname} - ${address.area}, ${address.pincode}`;
                    if (address.isDefault) {
                        option.selected = true;
                    }
                    savedAddressSelect.appendChild(option);
                });
            }
        }

        function populateSavedCars() {
            const savedCarSelect = document.getElementById('savedCarSelect');
            savedCarSelect.innerHTML = '<option value="">Choose from saved cars or select new</option>';
            
            if (currentUser.cars && currentUser.cars.length > 0) {
                currentUser.cars.forEach(car => {
                    const option = document.createElement('option');
                    option.value = car.id;
                    option.textContent = `${car.nickname} - ${car.brand} ${car.model}`;
                    if (car.isDefault) {
                        option.selected = true;
                    }
                    savedCarSelect.appendChild(option);
                });
            }
        }

        function selectSavedAddress(addressId) {
            if (!addressId) {
                // Clear form fields
                document.getElementById('plotInput').value = '';
                document.getElementById('streetInput').value = '';
                document.getElementById('areaInput').value = '';
                document.getElementById('localityInput').value = '';
                document.getElementById('landmarkInput').value = '';
                document.getElementById('pincodeInput').value = '';
                formData.address = null;
                updateNextButton();
                return;
            }
            
            const address = currentUser.addresses.find(addr => addr.id === addressId);
            if (address) {
                document.getElementById('plotInput').value = address.plot;
                document.getElementById('streetInput').value = address.street;
                document.getElementById('areaInput').value = address.area;
                document.getElementById('localityInput').value = address.locality || '';
                document.getElementById('landmarkInput').value = address.landmark;
                document.getElementById('pincodeInput').value = address.pincode;
                
                formData.address = {
                    plot: address.plot,
                    street: address.street,
                    area: address.area,
                    locality: address.locality || '',
                    landmark: address.landmark,
                    pincode: address.pincode
                };
                
                updateNextButton();
            }
        }

        function selectSavedCar(carId) {
            if (!carId) {
                // Clear selections
                document.querySelectorAll('.car-type-card').forEach(card => {
                    card.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                    card.classList.add('border-gray-200');
                });
                formData.selectedCarType = undefined;
                formData.selectedBrand = '';
                formData.selectedModel = '';
                updateCarBrands();
                updateNextButton();
                return;
            }
            
            const car = currentUser.cars.find(c => c.id === carId);
            if (car) {
                // Select car type visually
                document.querySelectorAll('.car-type-card').forEach(card => {
                    card.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                    card.classList.add('border-gray-200');
                    
                    if (card.dataset.type === car.type) {
                        card.classList.remove('border-gray-200');
                        card.classList.add('border-teal', 'bg-teal', 'bg-opacity-5');
                    }
                });
                
                formData.selectedCarType = car.type;
                formData.selectedBrand = car.brand;
                formData.selectedModel = car.model;
                
                updateCarBrands();
                
                setTimeout(() => {
                    const brandSelect = document.getElementById('brandSelect');
                    brandSelect.value = car.brand;
                    
                    updateCarModels();
                    
                    setTimeout(() => {
                        const modelSelect = document.getElementById('modelSelect');
                        modelSelect.value = car.model;
                        // Force next button update after car selection
                        setTimeout(() => {
                            updateNextButton();
                        }, 50);
                    }, 100);
                }, 100);
            }
        }

        // Button Update Functions
        function updateCheckUserButton() {
            const phone = document.getElementById('authPhoneInput').value;
            const btn = document.getElementById('checkUserBtn');
            
            if (validatePhone(phone)) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.add('bg-teal', 'text-white', 'cursor-pointer');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.remove('bg-teal', 'text-white', 'cursor-pointer');
            }
        }

        function updateVerifyPinButton() {
            const pin = document.getElementById('pinInput').value;
            const btn = document.getElementById('verifyPinBtn');
            
            if (validatePin(pin)) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.add('bg-teal', 'text-white', 'cursor-pointer');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.remove('bg-teal', 'text-white', 'cursor-pointer');
            }
        }

        function updateRegisterButton() {
            const name = document.getElementById('regNameInput').value.trim();
            const pin = document.getElementById('regPinInput').value.trim();
            const plot = document.getElementById('regPlotInput').value.trim();
            const street = document.getElementById('regStreetInput').value.trim();
            const area = document.getElementById('regAreaInput').value.trim();
            const landmark = document.getElementById('regLandmarkInput').value.trim();
            const pincode = document.getElementById('regPincodeInput').value.trim();
            const carType = document.getElementById('regCarTypeSelect').value;
            const carBrand = document.getElementById('regCarBrandSelect').value;
            const carModel = document.getElementById('regCarModelSelect').value;
            
            const btn = document.getElementById('registerBtn');
            
            const isValid = validateName(name) && validatePin(pin) && 
                           plot && street && area && 
                           landmark && validatePincode(pincode) &&
                           carType && carBrand && carModel;
            
            if (isValid) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.add('bg-teal', 'text-white', 'cursor-pointer');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.remove('bg-teal', 'text-white', 'cursor-pointer');
            }
        }

        function updateRegCarBrands() {
            const carType = document.getElementById('regCarTypeSelect').value;
            const brandSelect = document.getElementById('regCarBrandSelect');
            const modelSelect = document.getElementById('regCarModelSelect');
            
            brandSelect.innerHTML = '<option value="">Select brand</option>';
            modelSelect.innerHTML = '<option value="">Select model</option>';
            modelSelect.disabled = true;
            
            if (carType && carData[carType]) {
                Object.keys(carData[carType]).forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    brandSelect.appendChild(option);
                });
                brandSelect.disabled = false;
            } else {
                brandSelect.disabled = true;
            }
        }

        function updateRegCarModels() {
            const carType = document.getElementById('regCarTypeSelect').value;
            const carBrand = document.getElementById('regCarBrandSelect').value;
            const modelSelect = document.getElementById('regCarModelSelect');
            
            modelSelect.innerHTML = '<option value="">Select model</option>';
            
            if (carType && carBrand && carData[carType] && carData[carType][carBrand]) {
                carData[carType][carBrand].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
                modelSelect.disabled = false;
            } else {
                modelSelect.disabled = true;
            }
        }

        function updateNextButton() {
            const nextBtn = document.getElementById('nextBtn');
            if (!nextBtn) return;
            
            let isValid = false;

            switch(currentStep) {
                case 1:
                    isValid = validateName(document.getElementById('nameInput').value);
                    break;
                case 2:
                    isValid = validatePhone(document.getElementById('phoneInput').value);
                    break;
                case 3:
                    const plot = document.getElementById('plotInput').value.trim();
                    const street = document.getElementById('streetInput').value.trim();
                    const area = document.getElementById('areaInput').value.trim();
                    const landmark = document.getElementById('landmarkInput').value.trim();
                    const pincode = document.getElementById('pincodeInput').value.trim();
                    isValid = plot && street && area && landmark && validatePincode(pincode);
                    break;
                case 4:
                    // Check if car type is selected (either from dropdown or visual selection)
                    const savedCarValue = document.getElementById('savedCarSelect')?.value;
                    isValid = formData.selectedCarType !== undefined || savedCarValue;
                    break;
                case 5:
                    isValid = formData.selectedBrand && formData.selectedModel;
                    break;
                case 6:
                    if (isSubscriptionFlow) {
                        // Check if a plan is selected
                        isValid = formData.planMonths > 0;
                    } else {
                        isValid = true; // Service is pre-selected
                    }
                    break;
                case 7:
                    isValid = formData.selectedDate && formData.selectedTime;
                    break;
                case 8:
                    isValid = true;
                    break;
                case 9:
                    isValid = true;
                    break;
                case 10:
                    isValid = formData.selectedPayment !== undefined;
                    break;
            }

            if (isValid) {
                nextBtn.disabled = false;
                nextBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                nextBtn.classList.add('bg-teal', 'text-white', 'cursor-pointer');
                
                // Update button text based on current step
                if (currentStep === 10) {
                    nextBtn.textContent = 'Review Booking';
                } else if (currentStep === 11) {
                    nextBtn.textContent = 'Complete Booking';
                } else {
                    nextBtn.textContent = 'Next';
                }
            } else {
                nextBtn.disabled = true;
                nextBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                nextBtn.classList.remove('bg-teal', 'text-white', 'cursor-pointer');
                nextBtn.textContent = 'Next';
            }
        }

        // Car Selection Functions
        function updateCarBrands() {
            const brandSelect = document.getElementById('brandSelect');
            const modelSelect = document.getElementById('modelSelect');
            
            brandSelect.innerHTML = '<option value="">Select brand</option>';
            modelSelect.innerHTML = '<option value="">Select model</option>';
            modelSelect.disabled = true;
            
            if (formData.selectedCarType && carData[formData.selectedCarType]) {
                Object.keys(carData[formData.selectedCarType]).forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    brandSelect.appendChild(option);
                });
            }
        }

        function updateCarModels() {
            const brandSelect = document.getElementById('brandSelect');
            const modelSelect = document.getElementById('modelSelect');
            const selectedBrand = brandSelect.value;
            
            modelSelect.innerHTML = '<option value="">Select model</option>';
            
            if (selectedBrand && formData.selectedCarType && carData[formData.selectedCarType][selectedBrand]) {
                carData[formData.selectedCarType][selectedBrand].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
                modelSelect.disabled = false;
            } else {
                modelSelect.disabled = true;
            }
            
            formData.selectedBrand = selectedBrand;
            formData.selectedModel = '';
            updateNextButton();
        }

        // Selection Functions
        function selectCarType(type, element) {
            document.querySelectorAll('.car-type-card').forEach(card => {
                card.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                card.classList.add('border-gray-200');
            });
            
            element.classList.remove('border-gray-200');
            element.classList.add('border-teal', 'bg-teal', 'bg-opacity-5');
            
            formData.selectedCarType = type;
            updateCarBrands();
            updateNextButton();
        }

        function selectPlan(months, price, element) {
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                card.classList.add('border-gray-200');
            });
            
            element.classList.remove('border-gray-200');
            element.classList.add('border-teal', 'bg-teal', 'bg-opacity-5');
            
            formData.planMonths = months;
            formData.planPrice = price;
            updateNextButton();
        }

        function selectTimeSlot(time, element) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('border-teal', 'bg-teal', 'text-white');
                slot.classList.add('border-gray-200');
            });
            
            element.classList.remove('border-gray-200');
            element.classList.add('border-teal', 'bg-teal', 'text-white');
            
            formData.selectedTime = time;
            updateNextButton();
        }

        function selectPayment(payment, element) {
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                option.classList.add('border-gray-200');
                option.querySelector('.payment-radio').classList.remove('bg-teal', 'border-teal');
                option.querySelector('.payment-radio').classList.add('border-gray-300');
            });
            
            element.classList.remove('border-gray-200');
            element.classList.add('border-teal', 'bg-teal', 'bg-opacity-5');
            element.querySelector('.payment-radio').classList.remove('border-gray-300');
            element.querySelector('.payment-radio').classList.add('bg-teal', 'border-teal');
            
            formData.selectedPayment = payment;
            
            const cardNote = document.getElementById('cardNote');
            if (payment === 'card') {
                cardNote.classList.remove('hidden');
            } else {
                cardNote.classList.add('hidden');
            }
            
            updateNextButton();
        }

        function applyPromo() {
            if (!isTrialFlow) {
                formData.promoApplied = true;
                document.getElementById('promoTicket').classList.add('hidden');
                document.getElementById('promoApplied').classList.remove('hidden');
            }
        }

        // Step Navigation
        function nextStep() {
            if (currentStep <= totalSteps) {
                if (!validateCurrentStep()) return;
                
                // Hide current step or summary
                if (currentStep === 11) {
                    document.getElementById('summary').classList.add('hidden');
                    completeBooking();
                    return;
                } else {
                    document.getElementById(`step${currentStep}`).classList.add('hidden');
                }
                
                currentStep++;
                
                if (currentStep === 11) {
                    // Show summary instead of step11
                    document.getElementById('summary').classList.remove('hidden');
                    totalSteps = 11; // Update total steps to include summary
                } else {
                    document.getElementById(`step${currentStep}`).classList.remove('hidden');
                }
                
                updateProgress();
                updateNavigationButtons();
                handleSpecialSteps();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                if (currentStep === 11) {
                    // Hide summary and show step 10
                    document.getElementById('summary').classList.add('hidden');
                    totalSteps = 10; // Reset total steps
                } else {
                    document.getElementById(`step${currentStep}`).classList.add('hidden');
                }
                
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.remove('hidden');
                
                updateProgress();
                updateNavigationButtons();
            }
        }

        function validateCurrentStep() {
            const errorElements = {
                1: 'nameError',
                2: 'phoneError',
                3: 'addressError'
            };

            if (errorElements[currentStep]) {
                document.getElementById(errorElements[currentStep]).classList.add('hidden');
            }

            switch(currentStep) {
                case 1:
                    const name = document.getElementById('nameInput').value;
                    if (!validateName(name)) {
                        document.getElementById('nameError').classList.remove('hidden');
                        return false;
                    }
                    formData.name = name;
                    break;
                    
                case 2:
                    const phone = document.getElementById('phoneInput').value;
                    if (!validatePhone(phone)) {
                        document.getElementById('phoneError').classList.remove('hidden');
                        return false;
                    }
                    formData.phone = phone;
                    break;
                    
                case 3:
                    const plot = document.getElementById('plotInput').value.trim();
                    const street = document.getElementById('streetInput').value.trim();
                    const area = document.getElementById('areaInput').value.trim();
                    const landmark = document.getElementById('landmarkInput').value.trim();
                    const pincode = document.getElementById('pincodeInput').value.trim();
                    
                    if (!plot || !street || !area || !landmark) {
                        document.getElementById('addressError').textContent = 'Please fill all required address fields.';
                        document.getElementById('addressError').classList.remove('hidden');
                        return false;
                    }
                    
                    if (!validatePincode(pincode)) {
                        document.getElementById('addressError').classList.remove('hidden');
                        return false;
                    }
                    
                    formData.address = {
                        plot: plot,
                        street: street,
                        area: area,
                        locality: document.getElementById('localityInput').value.trim(),
                        landmark: landmark,
                        pincode: pincode
                    };
                    break;
                    
                case 4:
                    if (!formData.selectedCarType) {
                        return false;
                    }
                    break;
                    
                case 5:
                    if (!formData.selectedBrand || !formData.selectedModel) {
                        return false;
                    }
                    break;
                    
                case 7:
                    if (!formData.selectedDate || !formData.selectedTime) {
                        return false;
                    }
                    break;
                    
                case 10:
                    if (!formData.selectedPayment) {
                        return false;
                    }
                    break;
            }
            
            return true;
        }

        function handleSpecialSteps() {
            switch(currentStep) {
                case 6:
                    setupServiceSelection();
                    break;
                case 7:
                    setupDateTimeSelection();
                    break;
                case 8:
                    setupPromoSection();
                    break;
                case 9:
                    calculateAmount();
                    break;
                case 11:
                    populateSummary();
                    break;
            }
        }

        function setupServiceSelection() {
            if (isSubscriptionFlow) {
                document.getElementById('bookServiceContent').classList.add('hidden');
                document.getElementById('subscribePlanContent').classList.remove('hidden');
            } else {
                document.getElementById('bookServiceContent').classList.remove('hidden');
                document.getElementById('subscribePlanContent').classList.add('hidden');
                
                if (isTrialFlow) {
                    document.getElementById('serviceTitle').textContent = 'Your trial service';
                    document.getElementById('serviceName').textContent = 'Trial waterless car cleaning';
                    document.getElementById('servicePrice').textContent = '‚Çπ100';
                    document.getElementById('serviceDescription').textContent = 'Daily car exterior cleaning for 7 days at your doorstep.';
                }
            }
        }

        function setupDateTimeSelection() {
            const timeSlots = document.getElementById('timeSlots');
            const slots = isSubscriptionFlow ? subscriptionTimeSlots : bookingTimeSlots;
            
            if (isSubscriptionFlow) {
                document.getElementById('step7Title').textContent = 'Start Date & Time';
                document.getElementById('dateLabel').textContent = 'Select Start Date';
                document.getElementById('timeLabel').textContent = 'Select Time Slot';
                document.getElementById('dateNote').textContent = 'Plan will start from selected date';
            }
            
            timeSlots.innerHTML = '';
            slots.forEach(slot => {
                const button = document.createElement('button');
                button.className = 'time-slot p-3 border-2 border-gray-200 rounded-xl text-sm font-medium hover:border-teal transition-colors';
                button.textContent = slot;
                button.onclick = () => selectTimeSlot(slot, button);
                timeSlots.appendChild(button);
            });
        }

        function setupPromoSection() {
            if (isTrialFlow) {
                document.getElementById('promoSection').classList.add('hidden');
                document.getElementById('noPromoSection').classList.remove('hidden');
            } else {
                document.getElementById('promoSection').classList.remove('hidden');
                document.getElementById('noPromoSection').classList.add('hidden');
            }
        }

        function calculateAmount() {
            let basePrice = formData.planPrice;
            let discount = 0;
            let finalAmount = basePrice;
            
            if (formData.promoApplied && !isTrialFlow) {
                discount = Math.round(basePrice * 0.25);
                finalAmount = basePrice - discount;
            }
            
            const serviceNameEl = document.querySelector('#step9 #serviceName');
            const servicePriceEl = document.querySelector('#step9 #servicePrice');
            const discountRow = document.getElementById('discountRow');
            const discountAmount = document.getElementById('discountAmount');
            const finalAmountEl = document.getElementById('finalAmount');
            const amountDescription = document.getElementById('amountDescription');
            
            if (isTrialFlow) {
                serviceNameEl.textContent = 'Trial Service (7 days)';
                servicePriceEl.textContent = '‚Çπ100';
                discountRow.classList.add('hidden');
                finalAmountEl.textContent = '‚Çπ100';
                amountDescription.textContent = 'Trial amount: ‚Çπ100 (special offer price)';
            } else if (isSubscriptionFlow) {
                serviceNameEl.textContent = `${formData.planMonths}-month plan`;
                servicePriceEl.textContent = `‚Çπ${basePrice}`;
                if (formData.promoApplied) {
                    discountRow.classList.remove('hidden');
                    discountAmount.textContent = `-‚Çπ${discount}`;
                    finalAmountEl.textContent = `‚Çπ${finalAmount}`;
                    amountDescription.textContent = `Plan amount: ‚Çπ${finalAmount} (after launch25 discount)`;
                } else {
                    discountRow.classList.add('hidden');
                    finalAmountEl.textContent = `‚Çπ${finalAmount}`;
                    amountDescription.textContent = `Plan amount: ‚Çπ${finalAmount}`;
                }
            } else {
                serviceNameEl.textContent = 'Premium Cleaning Service';
                servicePriceEl.textContent = '‚Çπ600';
                if (formData.promoApplied) {
                    discountRow.classList.remove('hidden');
                    discountAmount.textContent = `-‚Çπ${discount}`;
                    finalAmountEl.textContent = `‚Çπ${finalAmount}`;
                    amountDescription.textContent = `Service amount: ‚Çπ${finalAmount} (after launch25 discount)`;
                } else {
                    discountRow.classList.add('hidden');
                    finalAmountEl.textContent = `‚Çπ${finalAmount}`;
                    amountDescription.textContent = `Service amount: ‚Çπ${finalAmount}`;
                }
            }
            
            formData.finalAmount = finalAmount;
            formData.discount = discount;
        }

        function populateSummary() {
            // Personal Details
            document.getElementById('summaryName').textContent = formData.name;
            document.getElementById('summaryPhone').textContent = formData.phone;
            document.getElementById('summaryAddress').textContent = 
                `${formData.address.plot}, ${formData.address.street}, ${formData.address.area}, ${formData.address.landmark}, ${formData.address.pincode}`;

            // Car Details
            document.getElementById('summaryCarType').textContent = formData.selectedCarType;
            document.getElementById('summaryCarBrand').textContent = formData.selectedBrand;
            document.getElementById('summaryCarModel').textContent = formData.selectedModel;

            // Service Details
            let serviceType = '';
            if (isTrialFlow) {
                serviceType = 'Trial Service (7 days)';
                document.getElementById('summaryPlanRow').classList.add('hidden');
            } else if (isSubscriptionFlow) {
                serviceType = `${formData.planMonths}-month Subscription Plan`;
                document.getElementById('summaryPlanRow').classList.remove('hidden');
                document.getElementById('summaryPlanDuration').textContent = `${formData.planMonths} month(s)`;
            } else {
                serviceType = 'One-time Premium Cleaning';
                document.getElementById('summaryPlanRow').classList.add('hidden');
            }
            
            document.getElementById('summaryServiceType').textContent = serviceType;
            document.getElementById('summaryDate').textContent = formData.selectedDate;
            document.getElementById('summaryTime').textContent = formData.selectedTime;

            // Payment Details
            document.getElementById('summaryBaseAmount').textContent = `‚Çπ${formData.planPrice}`;
            
            if (formData.promoApplied && !isTrialFlow) {
                document.getElementById('summaryDiscountRow').classList.remove('hidden');
                document.getElementById('summaryDiscount').textContent = `-‚Çπ${formData.discount}`;
            } else {
                document.getElementById('summaryDiscountRow').classList.add('hidden');
            }
            
            document.getElementById('summaryTotal').textContent = `‚Çπ${formData.finalAmount}`;
            document.getElementById('summaryPayment').textContent = formData.selectedPayment;
        }

        function updateProgress() {
            const progressPercent = Math.round((currentStep / totalSteps) * 100);
            document.getElementById('stepText').textContent = `Step ${currentStep} / ${totalSteps}`;
            document.getElementById('progressPercent').textContent = `${progressPercent}%`;
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
        }

        function updateNavigationButtons() {
            const backBtn = document.getElementById('backBtn');
            
            if (currentStep > 1) {
                backBtn.classList.remove('hidden');
            } else {
                backBtn.classList.add('hidden');
            }
            
            updateNextButton();
        }

        async function completeBooking() {
            document.getElementById('summary').classList.add('hidden');
            document.getElementById('navigationButtons').classList.add('hidden');
            document.getElementById('thankYou').classList.remove('hidden');
            document.getElementById('customerName').textContent = formData.name;
            
            await submitToGoogleForms();
        }

        async function submitToGoogleForms() {
            const submissionData = {
                name: formData.name,
                phone: formData.phone,
                address: `${formData.address.plot}, ${formData.address.street}, ${formData.address.area}, ${formData.address.locality}, ${formData.address.landmark}, ${formData.address.pincode}`,
                carType: formData.selectedCarType,
                carBrand: formData.selectedBrand,
                carModel: formData.selectedModel,
                serviceType: isTrialFlow ? 'Trial' : (isSubscriptionFlow ? 'Subscription' : 'One-time Service'),
                planDuration: formData.planMonths ? `${formData.planMonths} month(s)` : 'N/A',
                date: formData.selectedDate,
                time: formData.selectedTime,
                baseAmount: formData.planPrice,
                discount: formData.discount || 0,
                amount: formData.finalAmount,
                paymentMethod: formData.selectedPayment,
                promoApplied: formData.promoApplied ? 'Yes' : 'No',
                timestamp: new Date().toISOString()
            };
            
            console.log('Booking submitted:', submissionData);
            
            // Save to Google Sheets
            const sheetsSaved = await submitToGoogleSheets(submissionData);
            
            // Update status display with enhanced feedback
            const statusDiv = document.getElementById('submissionStatus');
            if (sheetsSaved) {
                statusDiv.className = 'mt-4 p-3 rounded-xl bg-green-50 border border-green-200';
                statusDiv.innerHTML = `
                    <div class="text-green-700 font-medium">‚úÖ Booking confirmed and saved to database!</div>
                    <div class="text-green-600 text-sm mt-1">Booking ID: CLZ${Date.now().toString().slice(-6)}</div>
                `;
            } else {
                statusDiv.className = 'mt-4 p-3 rounded-xl bg-yellow-50 border border-yellow-200';
                statusDiv.innerHTML = '<div class="text-yellow-700 font-medium">‚ö†Ô∏è Booking submitted locally. Configure Google Sheets for cloud storage.</div>';
            }
            
            // Add WhatsApp summary button
            const whatsappSummary = generateWhatsAppSummary(submissionData);
            const whatsappBtn = document.createElement('button');
            whatsappBtn.className = 'mt-3 w-full bg-green-500 text-white py-3 px-4 rounded-xl font-medium hover:bg-green-600 transition-colors flex items-center justify-center';
            whatsappBtn.innerHTML = `
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                </svg>
                Send Booking Details via WhatsApp
            `;
            whatsappBtn.onclick = () => {
                const whatsappNumber = '918122213141';
                const encodedMessage = encodeURIComponent(whatsappSummary);
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
            };
            
            statusDiv.appendChild(whatsappBtn);
            
            // Send automatic WhatsApp notification to business
            sendWhatsAppMessage(submissionData);
        }
        
        function sendWhatsAppMessage(data) {
            const message = `üöó *New Clenzzo Booking*
            
*Customer Details:*
Name: ${data.name}
Phone: ${data.phone}

*Address:*
${data.address}

*Car Details:*
Type: ${data.carType}
Brand: ${data.carBrand}
Model: ${data.carModel}

*Service Details:*
Type: ${data.serviceType}
${data.planDuration !== 'N/A' ? `Duration: ${data.planDuration}` : ''}
Date: ${data.date}
Time: ${data.time}
Amount: ‚Çπ${data.amount}
Payment: ${data.paymentMethod}
Promo Applied: ${data.promoApplied}

*Timestamp:* ${new Date(data.timestamp).toLocaleString('en-IN')}`;

            const whatsappNumber = '918122213141';
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
            
            setTimeout(() => {
                window.open(whatsappUrl, '_blank');
            }, 2000);
        }

        function bookViaWhatsApp() {
            const userName = currentUser ? currentUser.name : 'Customer';
            const userPhone = currentUser ? currentUser.phone : '';
            const userAddress = currentUser ? `${currentUser.address.plot}, ${currentUser.address.area}, ${currentUser.address.pincode}` : '';
            const userCar = currentUser ? `${currentUser.car.type} - ${currentUser.car.brand} ${currentUser.car.model}` : '';
            
            const message = `üöó *Clenzzo Service Inquiry*

*Customer Details:*
${userName !== 'Customer' ? `Name: ${userName}` : 'Name: [Please provide]'}
${userPhone ? `Phone: ${userPhone}` : 'Phone: [Please provide]'}
${userAddress ? `Address: ${userAddress}` : 'Address: [Please provide]'}
${userCar ? `Car: ${userCar}` : 'Car: [Please provide car details]'}

*Service Interest:*
‚ñ° Trial Service (‚Çπ100 for 7 days)
‚ñ° One-time Premium Cleaning (‚Çπ450)
‚ñ° Monthly Subscription (‚Çπ900+)
‚ñ° 3-month Plan (‚Çπ2,700)
‚ñ° 6-month Plan (‚Çπ5,400)
‚ñ° 12-month Plan (‚Çπ10,800)

*Preferred Date & Time:*
Date: [Please specify]
Time: [Please specify]

*Additional Requirements:*
[Any special requests or questions]

Please help me book the selected service. Thank you! üôè`;

            const whatsappNumber = '918122213141';
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // Generate detailed WhatsApp summary for completed bookings
        function generateWhatsAppSummary(data) {
            const serviceEmoji = data.serviceType === 'Trial' ? 'üéØ' : 
                               data.serviceType === 'Subscription' ? 'üìÖ' : 'üöó';
            
            const message = `${serviceEmoji} *Clenzzo Booking Summary*

*Customer Information:*
üë§ Name: ${data.name}
üì± Phone: ${data.phone}
üìç Address: ${data.address}

*Vehicle Details:*
üöô Type: ${data.carType}
üè∑Ô∏è Brand: ${data.carBrand}
üöó Model: ${data.carModel}

*Service Details:*
${serviceEmoji} Service: ${data.serviceType}
${data.planDuration !== 'N/A' ? `‚è±Ô∏è Duration: ${data.planDuration}` : ''}
üìÖ Date: ${data.date}
üïê Time: ${data.time}

*Payment Information:*
üí∞ Base Amount: ‚Çπ${data.baseAmount || data.amount}
${data.discount > 0 ? `üéüÔ∏è Discount: -‚Çπ${data.discount}` : ''}
üí≥ Total Amount: ‚Çπ${data.amount}
üíµ Payment Method: ${data.paymentMethod}
${data.promoApplied === 'Yes' ? 'üéÅ Promo Applied: LAUNCH25' : ''}

*Booking Details:*
üìù Booking ID: CLZ${Date.now().toString().slice(-6)}
‚è∞ Booked At: ${new Date(data.timestamp).toLocaleString('en-IN')}

---
*Next Steps:*
‚úÖ Booking confirmed
üìû We'll call you 30 mins before service
üöó Our team will arrive at scheduled time
üíØ 100% satisfaction guaranteed

Thank you for choosing Clenzzo! üôè`;

            return message;
        }

        function resetFlow() {
            currentStep = 1;
            totalSteps = 10;
            isSubscriptionFlow = false;
            isTrialFlow = false;
            formData = {
                promoApplied: false,
                planPrice: 600,
                planMonths: 0
            };
            
            // Clear form selections but don't clear user data
            document.querySelectorAll('.car-type-card').forEach(card => {
                card.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                card.classList.add('border-gray-200');
            });
            
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                card.classList.add('border-gray-200');
            });
            
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('border-teal', 'bg-teal', 'bg-opacity-5');
                option.classList.add('border-gray-200');
                option.querySelector('.payment-radio').classList.remove('bg-teal', 'border-teal');
                option.querySelector('.payment-radio').classList.add('border-gray-300');
            });
            
            document.querySelectorAll('.step-content').forEach(step => step.classList.add('hidden'));
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('navigationButtons').classList.remove('hidden');
            document.getElementById('thankYou').classList.add('hidden');
            
            updateProgress();
            updateNavigationButtons();
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load user database from localStorage
            loadUserDatabase();
            
            // Hide config notice after 10 seconds
            setTimeout(() => {
                const notice = document.getElementById('configNotice');
                if (notice) {
                    notice.style.display = 'none';
                }
            }, 10000);
            
            showAuthPage();
            
            // Auth page listeners
            document.getElementById('authPhoneInput').addEventListener('input', function() {
                updateCheckUserButton();
                document.getElementById('authPhoneError').classList.add('hidden');
            });

            document.getElementById('checkUserBtn').addEventListener('click', checkUser);

            document.getElementById('pinInput').addEventListener('input', function() {
                updateVerifyPinButton();
                document.getElementById('pinError').classList.add('hidden');
            });

            document.getElementById('verifyPinBtn').addEventListener('click', verifyPin);

            // Registration listeners
            const regInputs = ['regNameInput', 'regPinInput', 'regPlotInput', 'regStreetInput', 
                              'regAreaInput', 'regLandmarkInput', 'regPincodeInput'];
            
            regInputs.forEach(inputId => {
                document.getElementById(inputId).addEventListener('input', updateRegisterButton);
            });
            
            document.getElementById('regCarTypeSelect').addEventListener('change', function() {
                updateRegCarBrands();
                updateRegisterButton();
            });
            
            document.getElementById('regCarBrandSelect').addEventListener('change', function() {
                updateRegCarModels();
                updateRegisterButton();
            });
            
            document.getElementById('regCarModelSelect').addEventListener('change', updateRegisterButton);
            document.getElementById('registerBtn').addEventListener('click', registerUser);

            // Flow page listeners
            document.getElementById('nameInput').addEventListener('input', updateNextButton);
            document.getElementById('phoneInput').addEventListener('input', updateNextButton);
            
            ['plotInput', 'streetInput', 'areaInput', 'landmarkInput', 'pincodeInput'].forEach(inputId => {
                document.getElementById(inputId).addEventListener('input', updateNextButton);
            });

            document.querySelectorAll('.car-type-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectCarType(this.dataset.type, this);
                });
            });

            document.getElementById('brandSelect').addEventListener('change', updateCarModels);
            document.getElementById('modelSelect').addEventListener('change', function() {
                formData.selectedModel = this.value;
                updateNextButton();
            });

            document.querySelectorAll('.plan-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectPlan(parseInt(this.dataset.plan), parseInt(this.dataset.price), this);
                });
            });

            document.getElementById('savedAddressSelect').addEventListener('change', function() {
                selectSavedAddress(this.value);
            });

            document.getElementById('savedCarSelect').addEventListener('change', function() {
                selectSavedCar(this.value);
            });

            document.getElementById('dateInput').addEventListener('change', function() {
                formData.selectedDate = this.value;
                updateNextButton();
            });

            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectPayment(this.dataset.payment, this);
                });
            });

            document.getElementById('promoTicket').addEventListener('click', applyPromo);

            document.getElementById('nextBtn').addEventListener('click', nextStep);
            document.getElementById('backBtn').addEventListener('click', prevStep);

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').min = today;
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97da043a05aec1c2',t:'MTc1NzYyMzYwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
